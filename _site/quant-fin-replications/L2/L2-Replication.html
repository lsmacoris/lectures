<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lucas S. Macoris (FGV-EAESP)">

<title>Collecting, Organizing, and Manipulating Financial Data - Replication – Lucas S. Macoris</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-87FLN5SXEJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-87FLN5SXEJ', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Lucas S. Macoris</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://lsmacoris.github.io/"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../fin-mgmt.html"> 
<span class="menu-text">Financial Management</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../fin-strat.html"> 
<span class="menu-text">Financial Strategy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../quant-fin.html"> 
<span class="menu-text">Quantitative Finance</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lsmacoris"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:lucasmacoris@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/lucas-macoris-390a47160/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://drive.google.com/file/d/184m-BDeB-31SSyEuzqINco2UzqRFXhma/view?usp=drive_link"> <i class="bi bi-file-pdf" role="img" aria-label="CV">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Collecting, Organizing, and Manipulating Financial Data - Replication</h1>
</div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lucas S. Macoris (FGV-EAESP) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="about-this-document" class="level2">
<h2 class="anchored" data-anchor-id="about-this-document">About this Document</h2>
<p>This file replicates the codes that have been discussed in the live-session lectures of the Practical Applications in Quantitative Finance course. To ensure you can run the codes without issues, please install and load all required packages beforehand. It is always a good practice to replicate this Quarto document and experiment by making edits to the parameters. At the end of this report, you will find a suggestion on how to tweak this report — try doing some changes on your own!</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Attention
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this lecture, we will be working with daily stock price data from the <em>Magnificent Seven</em> (<em>AAPL</em>, <em>GOOG</em>, <em>MSFT</em>, <em>NVDA</em>, <em>TSLA</em>, <em>AMZN</em>, and <em>META</em>). I have already downloaded the data for you using the <code>tidyquant</code> package, which allows us to pull stock price data from multiple securities in a convenient format. You can hit the <em>Download</em> button to get a grasp on how the data looks like or download it directly on <em>eClass®</em> - file name: <code>M7.csv</code>. Before you start, make sure to follow the instructions from our previous replication to set up your working directory correctly.</p>
</div>
</div>
</section>
<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">Loading packages</h2>
<p>As we get started, we will be loading all packages referred in our official <a href="https://lsmacoris.github.io/lectures/quant-fin.html">website</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Package names</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>,<span class="st">"tidyquant"</span>,<span class="st">"tidymodels"</span>, <span class="st">"glue"</span>,<span class="st">"scales"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages not yet installed</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>installed_packages <span class="ot">&lt;-</span> packages <span class="sc">%in%</span> <span class="fu">rownames</span>(<span class="fu">installed.packages</span>())</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(installed_packages <span class="sc">==</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(packages[<span class="sc">!</span>installed_packages])</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Load all packages</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">lapply</span>(packages, library, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you could easily get around this by installing and loading all necessary packages using a more simple syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Install if not already available - I have commented these lines so that R does not attempt to install it everytime</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages('tidyverse')</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages('tidyquant')</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages('glue')</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages('scales')</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#install.packages('ggthemes')</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Load</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidyquant)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(tidymodels)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(glue)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(scales)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggthemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-dplyr-the-data-manipulation-package-in-the-tidyverse" class="level2">
<h2 class="anchored" data-anchor-id="using-dplyr-the-data-manipulation-package-in-the-tidyverse">Using <code>dplyr</code>, the data manipulation package in the <code>tidyverse</code></h2>
<p>The <code>dplyr</code> package is one of the core packages in the <code>tidyverse</code> and is designed for efficient and readable data manipulation. It provides a set of functions (also called “verbs”) that make working with data frames (or tibbles) intuitive and expressive. Key Features:</p>
<ol type="1">
<li>Filter rows: <code>filter()</code></li>
<li>Select columns: <code>select()</code></li>
<li>Mutate (create new columns): <code>mutate()</code></li>
<li>Summarize data: <code>summarize()</code></li>
<li>Group operations: <code>group_by()</code></li>
<li>Join tables: <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join()</code></li>
</ol>
<p>To get started with our exercises, we will refer to the <code>M7.csv</code> file that has been provided. After setting the current directory of the file, we load the data using the <code>read.csv()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">'M7.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  symbol       date    open    high     low   close    volume adjusted
1   AAPL 2020-01-02 74.0600 75.1500 73.7975 75.0875 135480400 72.79604
2   AAPL 2020-01-03 74.2875 75.1450 74.1250 74.3575 146322800 72.08828
3   AAPL 2020-01-06 73.4475 74.9900 73.1875 74.9500 118387200 72.66272
4   AAPL 2020-01-07 74.9600 75.2250 74.3700 74.5975 108872000 72.32098
5   AAPL 2020-01-08 74.2900 76.1100 74.2900 75.7975 132079200 73.48434
6   AAPL 2020-01-09 76.8100 77.6075 76.5500 77.4075 170108400 75.04523</code></pre>
</div>
</div>
</section>
<section id="the-mutate-function" class="level2">
<h2 class="anchored" data-anchor-id="the-mutate-function">1. The <code>mutate()</code> function</h2>
<p>The <code>mutate()</code> function adds new variables that are functions of existing variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(.data, <span class="co">#The object you are performing the calculations </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">new_variable_1 =</span> var1 <span class="sc">*</span> <span class="dv">2</span>, <span class="co">#Can use basic operations...</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">new_variable_2 =</span> <span class="fu">median</span>(var2), <span class="co">#Or predefined functions)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">variable_3 =</span> <span class="fu">as.character</span>(var3) <span class="co">#And can be used to modify existing variables)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>It sequentially creates the columns you asked for and place them to the right of your <code>data.frame</code> (or <code>tibble</code>)</li>
<li>You can use any function, predefined or custom, and apply it to <code>mutate()</code></li>
<li>It can also modify any columns you want (if the name is the same as an existing column)</li>
</ol>
<p><strong>Exercise</strong>: use columns <code>high</code> and <code>low</code> and create a new column, <code>mid</code>, defined as the average between daily high and low prices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">mutate</span>(M7, <span class="at">mid=</span> (high<span class="sc">+</span>low)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  symbol       date    open    high     low   close    volume adjusted      mid
1   AAPL 2020-01-02 74.0600 75.1500 73.7975 75.0875 135480400 72.79604 74.47375
2   AAPL 2020-01-03 74.2875 75.1450 74.1250 74.3575 146322800 72.08828 74.63500
3   AAPL 2020-01-06 73.4475 74.9900 73.1875 74.9500 118387200 72.66272 74.08875
4   AAPL 2020-01-07 74.9600 75.2250 74.3700 74.5975 108872000 72.32098 74.79750
5   AAPL 2020-01-08 74.2900 76.1100 74.2900 75.7975 132079200 73.48434 75.20000
6   AAPL 2020-01-09 76.8100 77.6075 76.5500 77.4075 170108400 75.04523 77.07875</code></pre>
</div>
</div>
</section>
<section id="the-select-function" class="level2">
<h2 class="anchored" data-anchor-id="the-select-function">2. The <code>select()</code> function</h2>
<p>The <code>select()</code> function select (and optionally rename) variables in a data frame, using a concise mini-language that makes it easy to refer to variables based on their name (<em>e.g</em>. <code>a:f</code> selects all columns from <code>a</code> on the left to <code>f</code> on the right) or type (e.g.&nbsp;<code>where(is.numeric)</code> selects all numeric columns):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(.data, <span class="co">#The object which you are performing the operations </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>       variable_3, <span class="co">#Can reorder columns</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>       variable_1, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>       variable_2<span class="sc">:</span>variable_4, <span class="co">#Matches position patterns </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">where</span>(is.numeric) <span class="co">#Can select all columns that match a given pattern</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>       ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>And select only the columns you’ve asked for</li>
<li>You can also use <code>select(.data,-variable)</code> to remove a variable</li>
<li>It keeps the structure of the <code>data.frame</code> intact - no rows are affected</li>
</ol>
<p>The <code>select()</code> function also comes with a handy companion of <code>selectors</code>, which are functions that help you cherry pick columns in a concise way, rather than hardcoding them altogether:</p>
<ol type="1">
<li><code>:</code> for selecting a range of consecutive variables.</li>
<li><code>starts_with()</code> starts with a string</li>
<li><code>ends_with()</code> ends with a string</li>
<li><code>contains()</code> contains a string</li>
<li><code>matches()</code>matches a regular expression.</li>
<li><code>where()</code>a function to all variables and selects those for which the function returns <code>TRUE</code></li>
</ol>
<p><strong>Exercise</strong>: Select only the <code>symbol</code>, <code>date</code>, <code>volume</code>, and <code>adjusted</code>, in that order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">select</span>(M7,symbol,date,volume,adjusted)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  symbol       date    volume adjusted
1   AAPL 2020-01-02 135480400 72.79604
2   AAPL 2020-01-03 146322800 72.08828
3   AAPL 2020-01-06 118387200 72.66272
4   AAPL 2020-01-07 108872000 72.32098
5   AAPL 2020-01-08 132079200 73.48434
6   AAPL 2020-01-09 170108400 75.04523</code></pre>
</div>
</div>
</section>
<section id="the-filter-function" class="level2">
<h2 class="anchored" data-anchor-id="the-filter-function">3. The <code>filter()</code> function</h2>
<p>The <code>filter()</code> function is used to subset a data frame, retaining all rows that satisfy your conditions. To be retained, the row must produce a value of <code>TRUE</code> for all conditions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(.data, <span class="co">#The object which you are performing the operations</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>       variable_1 <span class="sc">&gt;</span><span class="dv">10</span>, <span class="co">#Simple arithmetic operators</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>       variable_2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'AAPL'</span>,<span class="st">'MSFT'</span>,<span class="st">'FORD'</span>), <span class="co">#Pattern search</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>       <span class="sc">!</span>(variable_3 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Boston'</span>,<span class="st">'Mass'</span>,<span class="st">'Silicon Valley'</span>)), <span class="co">#Negate pattern search</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       variable_4 <span class="sc">&gt;=</span><span class="dv">10</span> <span class="sc">&amp;</span> variable_3<span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">|</span> <span class="fu">is.na</span>(variable_4) <span class="co">#IF and OR conditions</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>       ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>And filter the rows based on the conditions outlined</li>
<li>You can use any function, predefined or custom, and apply it to <code>filter()</code></li>
<li>It returns a subset of the whole object, keeping the columns and the data structure intact</li>
</ol>
<p><strong>Exercise</strong>: filter for observations that occurred in 2025, only. You can use the <code>year()</code> function with the <code>date</code> variable to retrieve the year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">filter</span>(M7,<span class="fu">year</span>(date)<span class="sc">==</span><span class="dv">2025</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  symbol       date   volume adjusted
1   AAPL 2025-01-02 55740700   243.85
2   AAPL 2025-01-03 40244100   243.36
3   AAPL 2025-01-06 45045600   245.00
4   AAPL 2025-01-07 40856000   242.21
5   AAPL 2025-01-08 37628900   242.70
6   AAPL 2025-01-10 61710900   236.85</code></pre>
</div>
</div>
</section>
<section id="the-arrange-function" class="level2">
<h2 class="anchored" data-anchor-id="the-arrange-function">3. The <code>arrange()</code> function</h2>
<p>The <code>arrange()</code> function reorders the rows of a data frame by the values of selected columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Some Options, always in the following format: the object you are rearranging + the reordering scheme</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(.data, variable1) <span class="co">#Ascending by variable_1</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(.data, variable1, variable_2) <span class="co">#Ascending by variable_1 and then variable_2</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(.data, variable2, variable_1) <span class="co">#Ascending by variable_2 and then variable 1</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(.data, variable1, <span class="fu">desc</span>(variable_2)) <span class="co">#Ascending by variable_1, and then descending by variable_2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>And reorders the rows of your <code>data.frame</code> (or <code>tibble</code>)</li>
<li>This can be useful for visualization, but also for applying position-dependent functions, like <code>lag()</code>, <code>lead()</code>, <code>head()</code>, and <code>tail()</code></li>
</ol>
<p><strong>Exercise</strong>: arrange the dataset by descending <code>date</code> (newest to oldest) and <code>symbol</code>..</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">arrange</span>(M7,<span class="fu">desc</span>(date),symbol)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(M7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  symbol       date    volume adjusted
1   AAPL 2025-01-29  45486100   239.36
2   AMZN 2025-01-29  26091700   237.07
3   GOOG 2025-01-29  12287800   197.18
4   META 2025-01-29  21377800   676.49
5   MSFT 2025-01-29  23581400   442.33
6   NVDA 2025-01-29 467120600   123.70</code></pre>
</div>
</div>
</section>
<section id="the-summarize-function" class="level2">
<h2 class="anchored" data-anchor-id="the-summarize-function">4. The <code>summarize()</code> function</h2>
<p>The <code>summarise()</code> - or <code>summarize()</code> - function creates a new data frame. It returns one row for each combination of grouping variables; if there are no grouping variables, the output will have a single row summarising all observations in the input. It will contain one column for each grouping variable and one column for each of the summary statistics that you have specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(.data, <span class="co">#The object which you are performing the operations </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">new_variable_1 =</span> <span class="fu">mean</span>(var1,<span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="co">#Average of var1, removing NA values</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">new_variable_2 =</span> <span class="fu">median</span>(var2,<span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="co">#Median of var1, removing, NA values</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">new_variable_3 =</span> <span class="fu">n_distinct</span>(var2) <span class="co">#Number of unique values of var2</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>And reshapes the <code>data.frame</code> (or <code>tibble</code>) by the aggregation functions</li>
<li>As the name suggests, it is used to summarize a table</li>
</ol>
<p><strong>Exercise</strong>: summarize the dataset by creating an <code>average</code> column, defined as the average <code>adjusted</code> prices. You can use the <code>mean()</code> function to get the average. Use the option <code>na.rm=TRUE</code> inside the <code>mean</code> function to make sure that <code>NA</code> values are disregarded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Summary<span class="ot">=</span><span class="fu">summarize</span>(M7,<span class="at">average=</span><span class="fu">mean</span>(adjusted,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first observations</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   average
1 322.1803</code></pre>
</div>
</div>
</section>
<section id="slice-and-dice-through-group_by" class="level2">
<h2 class="anchored" data-anchor-id="slice-and-dice-through-group_by">5. Slice and dice through <code>group_by</code></h2>
<p>The <code>group_by()</code> function takes an existing table and converts it into a <em>grouped</em> table where operations are performed “by group”. Using <code>ungroup()</code> removes grouping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">=</span><span class="fu">group_by</span>(Data,v1,v2,v3)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">=</span><span class="fu">summarize</span>(<span class="at">avg=</span><span class="fu">mean</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>This function takes the <code>.data</code> argument you provided (in your example, the <code>Data</code> object)…</li>
<li>And creates the <code>avg</code> variable taking the average of <code>x</code> within each tuple defined by the grouping variables (in this case, <code>v1</code>,<code>v2</code>, and <code>v3</code> )</li>
<li>It returns a <code>grouped dataframe</code>, with the results of <code>avg</code> displayed for each unique combination of <code>v1</code>,<code>v2</code>, and <code>v3</code></li>
</ol>
<p>The <code>group_by()</code> function in R is part of the dplyr package and is used to create grouped data frames. It is commonly used in combination with <code>summarize()</code>, <code>mutate()</code>, and other <code>dplyr</code> functions to perform operations within groups.</p>
<section id="important" class="level3 callout-alert">
<h3 class="anchored" data-anchor-id="important">Important</h3>
<p>After grouping, it’s often necessary to <em>ungroup</em> the data to prevent unintended behavior in subsequent operations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">=</span><span class="fu">group_by</span>(Data,v1,v2,v3)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">=</span><span class="fu">summarize</span>(<span class="at">avg=</span><span class="fu">mean</span>(x,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Data<span class="ot">=</span><span class="fu">ungroup</span>(Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<p>Let’s try the latest <code>summarize()</code> call again, but now grouping the data by <code>symbol</code> first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply function to the data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>M7<span class="ot">=</span><span class="fu">group_by</span>(M7,symbol)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>Summary<span class="ot">=</span><span class="fu">summarize</span>(M7,<span class="at">average=</span><span class="fu">mean</span>(adjusted,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Show the first 10 observations</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Summary,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  symbol average
  &lt;chr&gt;    &lt;dbl&gt;
1 AAPL      234.
2 AMZN      227.
3 GOOG      196.
4 META      625.
5 MSFT      430.
6 NVDA      137.
7 TSLA      405.</code></pre>
</div>
</div>
</section>
<section id="pipe-your-way-through-the-code" class="level2">
<h2 class="anchored" data-anchor-id="pipe-your-way-through-the-code">6. Pipe your way through the code <code>%&gt;%</code></h2>
<p>The <code>dplyr</code> verbs, in isolation, are a great tool for data analysts, but what really makes them to shine is what glues them together. The pipe operator (<code>%&gt;%</code> or <code>|&gt;</code>) is a key feature of the <code>magrittr</code> package (included in the <code>tidyverse</code>) and is widely used in R, especially together with <code>dplyr</code>, for improving code readability and structuring data transformation workflows. Key benefits include:</p>
<p>✅ Improved Readability – The sequence of transformations is clear.</p>
<p>✅ No Need for Temporary Variables – Each step directly passes its result to the next function.</p>
<p>✅ Avoids Nesting – No deeply nested function calls.</p>
<p>The pipe operator allows you to pass the result of one function as the first argument to the next function, making code more readable and eliminating the need for nested function calls. To show its functionality in action, in the code chunk below, both parts of the code produce the exact same result, but the latter, using the pipe operator, is much simpler to read:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Instead of </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'Data.csv'</span>) <span class="co">#Start with the data</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">mutate</span>(Data, <span class="at">new_var_1=</span>var_1<span class="sc">*</span><span class="dv">10</span>)<span class="co">#Mutate</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">select</span>(Data, var_1,var_2,new_var_1,<span class="fu">where</span>(is.numeric))<span class="co">#Select</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">filter</span>(Data, new_var_1<span class="sc">&gt;</span><span class="dv">5</span>)<span class="co">#Filter</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">arrange</span>(Data, new_var_1,<span class="fu">desc</span>(var2))<span class="co">#Arrange</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">summarize</span>(Data, <span class="at">new_var=</span><span class="fu">mean</span>(new_var_1,<span class="at">na.rm=</span><span class="cn">TRUE</span>))<span class="co">#Summarize</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Do</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">'Data.csv'</span>)<span class="sc">%&gt;%</span> <span class="co">#Start with the data</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">new_var_1=</span>var_1<span class="sc">*</span><span class="dv">10</span>)<span class="sc">%&gt;%</span> <span class="co">#Mutate</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(var_1,var_2,new_var_1,<span class="fu">where</span>(is.numeric))<span class="sc">%&gt;%</span> <span class="co">#Select</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(new_var_1<span class="sc">&gt;</span><span class="dv">5</span>)<span class="sc">%&gt;%</span> <span class="co">#Filter</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(new_var_1,<span class="fu">desc</span>(var2))<span class="sc">%&gt;%</span> <span class="co">#Arrange</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="at">new_var=</span><span class="fu">mean</span>(new_var_1,<span class="at">na.rm=</span><span class="cn">TRUE</span>))<span class="co">#Summarize</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="hands-on-exercise" class="level2">
<h2 class="anchored" data-anchor-id="hands-on-exercise">Hands-on Exercise</h2>
<p>On January <span class="math inline">\(25^{th}\)</span>, chinese startup <em>DeepSeek</em> disrupted the tech stock market as investors reassessed the likely future investment in Artificial Intelligence hardware. As part of your work as a buy-side analyst, you were asked to analyze how the <em>Magnificent 7</em> performed after the <em>DeepSeek</em>. To this point, follow the instructions and answer to the following question: <strong>which stock suffered the most during January 2025?</strong></p>
<ol type="1">
<li>To answer this question, you will be using all <code>dplyr</code> verbs you’ve practiced so far</li>
<li>Furthermore, you will be also using some common base R and ther <code>dplyr</code> functions, like <code>lag()</code>, <code>prod()</code>, <code>as.Date()</code> and <code>drop_na()</code></li>
</ol>
<p>The expected result is a <code>data.frame</code> object that shows, for each <code>symbol</code>, the monthly return on January, 2025, ordered from lowest-to-highest.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Instructions
</div>
</div>
<div class="callout-body-container callout-body">
<p>The data, stored in <code>M7.csv</code>, can be loaded using <code>read.csv('M7.csv')</code>. You can download it using the link shown in <em>Slide 4</em>.</p>
<ol type="1">
<li>Select only the <code>symbol</code>, <code>date</code>, and <code>adjusted</code> columns, and arrange the dataset from oldest to newest</li>
<li>Mutate your <code>date</code> variable, making sure to read it as a Date object using <code>as.Date()</code></li>
<li>Create a <code>Year</code> variable and filter only on observations happening in 2025. You can use the <code>year()</code> function to retrieve the year of a given <code>Date</code> column.</li>
<li>Group data by <code>symbol</code></li>
<li>Create, for each different <code>symbol</code>, a <code>Return</code> variable that is defined as <span class="math inline">\(P_{t+1}/P_{t}\)</span>, where <span class="math inline">\(t\)</span> refers to a date. You can use the <code>lag()</code> function for this</li>
<li>You will see that <code>lag</code> produces an <code>NA</code> whenever you try to lag the first observation. To make sure your data does not contain any <code>NA</code>, call <code>drop_na()</code></li>
<li>Create, for each different <code>symbol</code>, a <code>Cum_Return</code> variable that is defined as the cumulative return. Compounded returns over time can be written as <span class="math inline">\(\small \prod(1+R_t)=(1+R_1)\times(1+R_2)\times...\times(1+R_t)\)</span>. For this, you can use the <code>prod()</code> function.</li>
<li>Pick the latest observation from each <code>symbol</code> and arrange the table from lowest-to-highest return. The function <code>slice_tail(n=x)</code> retrieves the bottom <code>x</code> observations, whereas <code>slice_head(n=y)</code> retrieves the top <code>y</code>.</li>
</ol>
</div>
</div>
</section>
<section id="solution-walkthrough" class="level2">
<h2 class="anchored" data-anchor-id="solution-walkthrough">Solution walkthrough</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read the Data</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>M7<span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Select only the columns of interest</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(symbol,date,adjusted)<span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sure date is read as a Date object</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">as.Date</span>(date))<span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter for observations happening in 2025</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">==</span><span class="dv">2025</span>)<span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Arrange from chronological order</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(date)<span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Group by Symbol to perform the calculations</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the return</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Return =</span> adjusted<span class="sc">/</span><span class="fu">lag</span>(adjusted,<span class="at">default =</span> <span class="cn">NA</span>))<span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove NAs before doing the cumulative product</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="fu">drop_na</span>()<span class="sc">%&gt;%</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Cum_Return =</span> <span class="fu">cumprod</span>(Return)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Select the latest observation from each symbol</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_tail</span>(<span class="at">n=</span><span class="dv">1</span>)<span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Select symbol, date, and cumulative return</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(symbol,date,Cum_Return)<span class="sc">%&gt;%</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Arrange from lowest-to-highest</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(Cum_Return)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
# Groups:   symbol [7]
  symbol date       Cum_Return
  &lt;chr&gt;  &lt;date&gt;          &lt;dbl&gt;
1 NVDA   2025-01-29    -0.106 
2 AAPL   2025-01-29    -0.0184
3 TSLA   2025-01-29     0.0259
4 GOOG   2025-01-29     0.0344
5 MSFT   2025-01-29     0.0567
6 AMZN   2025-01-29     0.0765
7 META   2025-01-29     0.129 </code></pre>
</div>
</div>
<p>This code processes stock price data from <code>M7</code> using the <code>dplyr</code> package. It calculates the cumulative return for each stock (<code>symbol</code>) in the year 2025, then selects the latest available observation per stock and sorts them from lowest to highest cumulative return.</p>
<ol type="1">
<li><p><strong>Read the Data.</strong> <code>M7</code> is assumed to be a data frame or tibble containing stock data ready in your session. You can use <code>read.csv()</code> and store it in an R object. The pipe operator <code>%&gt;%</code>) is used to chain functions together.</p></li>
<li><p><strong>Select Relevant Columns.</strong> Keeps only the relevant columns for the analysis:</p></li>
</ol>
<ul>
<li><code>symbol</code> → The stock ticker</li>
<li><code>date</code> → The trading date</li>
<li><code>adjusted</code> → The adjusted closing price (used for return calculations)</li>
</ul>
<p>Making sure the <code>select</code> function is applied as one of the first adjustments can facilitate data wrangling as it shrinks the dataset for the upcoming operations.</p>
<ol start="3" type="1">
<li><p><strong>Ensure <code>date</code> is a <code>Date</code> object in your session</strong>. The code converts the <code>date</code> column to a <code>Date</code> object to enable time-based filtering and calculations, like <code>year()</code>.</p></li>
<li><p><strong>Filter Data for 2025</strong>. The code uses <code>year(date) == 2025</code> (from the <code>lubridate</code> package, loaded together with the <code>tidyverse</code>) to keep only data from 2025.</p></li>
<li><p><strong>Sort Data in Chronological Order</strong>. The code ensures that stock prices are arranged earliest to latest for correct return calculations.</p></li>
<li><p><strong>Groups the dataset by stock (<code>symbol</code>)</strong>. Using <code>group_by()</code> ensures that return calculations are performed for each stock separately</p></li>
<li><p><strong>Calculate Daily Returns</strong>. After the dataset is grouped, we use the <code>mutate()</code> function to create our return metric:</p></li>
</ol>
<p><span class="math display">\[
Return=\dfrac{P_{t}}{P_{t-1}}
\]</span></p>
<ul>
<li>Uses <code>lag(adjusted)</code> to get the previous day’s adjusted price.</li>
<li>The first row in each group will have NA (because there’s no previous price)</li>
</ul>
<p>Because of that, we also need a call to <code>drop_na()</code> to make sure that whenever we are multiplying these indices, we are not including <code>NA</code> values.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>The function <code>cumprod()</code>, which calculates the cumulative product of a series, multiplies values sequentially. However, if there are missing values (<code>NA</code>) in the sequence, <code>cumprod()</code> propagates <code>NA</code> to all subsequent values. This can corrupt the entire computation.</p>
<p>For example, ommitting the <code>drop_na()</code> step in the solution code would produce <code>NA</code> all over <code>Cum_Return</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Read the Data</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>M7<span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Select only the columns of interest</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(symbol,date,adjusted)<span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Make sure date is read as a Date object</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">as.Date</span>(date))<span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter for observations happening in 2025</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="fu">year</span>(date)<span class="sc">==</span><span class="dv">2025</span>)<span class="sc">%&gt;%</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Arrange from chronological order</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(date)<span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Group by Symbol to perform the calculations</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the return</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Return =</span> adjusted<span class="sc">/</span><span class="fu">lag</span>(adjusted,<span class="at">default =</span> <span class="cn">NA</span>))<span class="sc">%&gt;%</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove NAs before doing the cumulative product</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Cum_Return =</span> <span class="fu">cumprod</span>(Return)<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 126 × 5
# Groups:   symbol [7]
   symbol date       adjusted Return Cum_Return
   &lt;chr&gt;  &lt;date&gt;        &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
 1 AAPL   2025-01-02     244. NA             NA
 2 AMZN   2025-01-02     220. NA             NA
 3 GOOG   2025-01-02     191. NA             NA
 4 META   2025-01-02     599. NA             NA
 5 MSFT   2025-01-02     419. NA             NA
 6 NVDA   2025-01-02     138. NA             NA
 7 TSLA   2025-01-02     379. NA             NA
 8 AAPL   2025-01-03     243.  0.998         NA
 9 AMZN   2025-01-03     224.  1.02          NA
10 GOOG   2025-01-03     193.  1.01          NA
# ℹ 116 more rows</code></pre>
</div>
</div>
</div>
</div>
<ol start="8" type="1">
<li><strong>Calculate Cumulative Returns</strong>. With the series of daily returns in place cumulative return over time can be retrieved by compounding each individual return over time:</li>
</ol>
<p><span class="math display">\[
\text{Cumulative Return}_{t=1\rightarrow T}= (1+R_1)\times(1+R_2)\times(1+R_3)\times...\times(1+R_t)\equiv\prod_{t=1}^{T}(1+R_t)
\]</span> To perform such calculations, the code uses <code>cumprod(Return)</code>, which multiplies returns over time. In the end, we also need to subtract 1 to express it as a percentage return.</p>
<ol start="9" type="1">
<li><p><strong>Select the Latest Observation Per Stock</strong>. The <code>slice_tail()</code> function keeps only the last row (i.e., the most recent date) for each stock. Note that this behavior is only possible because our data has been grouped by <code>symbol</code> in the subsequent steps. In an <code>ungrouped</code> case, <code>slice_tail()</code> would retrieve the latest observation considering the data as a whole - in this case, META cumulative returns.</p></li>
<li><p><strong>Keep Only Key Columns and Rearrange</strong>. After we’re done creating the relevant variables, we can use the <code>select()</code> function to keep only the columns that are of interest: <code>symbol</code>,<code>date</code>, and <code>Cum_Return</code>, and use the <code>arrange()</code> function to sort observations by ascending order of cumulative returns (<em>i.e</em>, lowest-to-highest).</p></li>
</ol>
</section>
<section id="try-doing-some-edits-on-your-own" class="level2">
<h2 class="anchored" data-anchor-id="try-doing-some-edits-on-your-own">Try doing some edits on your own!</h2>
<p>Try thinking about changes you could do to either improve code readability of the analysis. A couple of edits that can be made include, but are not limited, to:</p>
<ol type="1">
<li>Adding more time periods to the analysis</li>
<li>Increasing the set of <code>assets</code> to include more tech firms other than the magnificent seven</li>
<li>Calculate volatility metrics using <code>var()</code> or <code>stdev()</code> functions</li>
</ol>
<p>Play around with these concepts to get familiar with all the data manipulation tools that come with <code>dplyr</code>!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lsmacoris\.github\.io\/lectures");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Lucas Macoris. Photography by <a href="https://www.jurizieri.com.br/">Juliana Rizieri</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/lsmacoris/lectures/edit/main/quant-fin-replications/L2/L2-Replication.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/lsmacoris/lectures/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>