<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.55">

  <meta name="author" content="Lucas S. Macoris">
  <title>Lucas S. Macoris – The Capital Asset Pricing Model (CAPM) in practice</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-87FLN5SXEJ"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-87FLN5SXEJ', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="../../../site_libs/font-awesome-6.5.2/js/script.js"></script>

</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">The Capital Asset Pricing Model (CAPM) in practice</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lucas S. Macoris 
</div>
</div>
</div>

</section>
<section id="outline" class="slide level2">
<h2>Outline</h2>
<ul>
<li>This lecture is mainly based the following textbooks:
<ol type="1">
<li><em>Tidy Finance</em> <span class="citation" data-cites="tidyfinance">(<a href="#/references" role="doc-biblioref" onclick="">Scheuch, Voigt, and Weiss 2023</a>)</span></li>
<li><em>R for Data Science</em> <span class="citation" data-cites="r4ds">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, Mine Cetinkaya-Rundel, and Grolemund 2023</a>)</span></li>
</ol></li>
</ul>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Coding Replications</strong></p>
</div>
<div class="callout-content">
<p>For coding replications, whenever applicable, please follow <a href="https://lsmacoris.github.io/lectures/quant-fin.html">this</a> page or hover on the specific slides with containing coding chunks.</p>
<ol type="1">
<li>Ensure that you have your <span class="blue"><i class="fa-brands fa-r-project" aria-label="r-project"></i></span> session properly set-up according to the instructions outlined in the course webpage</li>
<li>In the webpage, you can also find a detailed discussion of the examples covered in this lecture</li>
</ol>
</div>
</div>
</div>
</section>
<section id="disclaimer" class="slide level2">
<h2>Disclaimer</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Disclaimer</strong></p>
</div>
<div class="callout-content">
<p>The information presented in this lecture is for educational and informational purposes only and should not be construed as investment advice. Nothing discussed constitutes a recommendation to buy, sell, or hold any financial instrument or security. Investment decisions should be made based on individual research and consultation with a qualified financial professional. The presenter assumes no responsibility for any financial decisions made based on this content.</p>
<p>All code used in this lecture is publicly available and is also shared on my <a href="https://github.com/lsmacoris">GitHub</a> page. Participants are encouraged to review, modify, and use the code for their own learning and research purposes. However, no guarantees are made regarding the accuracy, completeness, or suitability of the code for any specific application.</p>
<p>For any questions or concerns, please feel free to reach out via email at <a href="mailto:lucas.macoris@fgv.br">lucas.macoris@fgv.br</a></p>
</div>
</div>
</div>
</section>
<section id="background" class="slide level2">
<h2>Background</h2>
<ul>
<li><p>The <span class="blue"><em>Capital Asset Pricing Model (CAPM)</em></span> is a very practical, robust and straightforward implementation for modeling expected returns</p></li>
<li><p>It gets managers to think about risk in the correct way: instead of thinking about total risk, the <span class="blue">CAPM</span> shows us that we only the market risk (non-diversifiable) should be the concern</p></li>
</ul>
<div class="fragment">
<ul>
<li>There are <span class="blue">three</span> simplifying assumptions around investor behavior that the <span class="blue">CAPM</span> establishes:</li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>The Capital Asset Pricing Model (CAPM) Assumptions</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li><p>Investors can buy and sell all securities at competitive market prices without incurring taxes or transactions costs can borrow and lend at the risk-free interest rate</p></li>
<li><p>Investors hold only efficient portfolios of traded securities</p></li>
<li><p>Investors have homogeneous expectations regarding the volatilities, correlations, and expected returns of securities</p></li>
</ol>
</div>
</div>
</div>
</div>
<div class="fragment">
<p><strong>Question</strong>: why these assumptions are important?</p>
</div>
</section>
<section id="pricing-the-risk-premium-under-the-capm" class="slide level2">
<h2>Pricing the Risk Premium under the CAPM</h2>
<ul>
<li>Recall that the expected return of any given asset <span class="math inline">\(i\)</span> is given by:</li>
</ul>
<p><span class="math display">\[
\small E[R_i]  =  R_f + \beta_i^P  \times (E[R_p] - R_f)
\]</span></p>
<ul>
<li>How can we find <span class="math inline">\(\beta_i^P\)</span>, the sensitivity of asset <span class="math inline">\(i\)</span> returns to the efficient portfolio, <span class="math inline">\(P\)</span>?
<ol type="1">
<li>To identify the efficient portfolio <span class="citation" data-cites="Markowitz">(<a href="#/references" role="doc-biblioref" onclick="">Markowitz 1952</a>)</span>, we need to know the expected returns, volatilities, and correlations between all available investments!</li>
<li>However, if the <span class="blue">CAPM</span> assumptions are valid, we can now identify the efficient portfolio: <strong>it is equal to the market portfolio!</strong></li>
</ol></li>
<li>What does that mean for us in terms of determining expected equity returns? Until now, we were agnostic on what <span class="math inline">\(P\)</span> was. Under the <span class="blue">CAPM</span>, we can change the subscript <span class="math inline">\(P\)</span> to <span class="math inline">\(M\)</span>:</li>
</ul>
<p><span class="math display">\[
\small E[R_i] =  R_f + \beta_i^M  \times (E[R_m] - R_f)
\]</span></p>
</section>
<section id="capm-implication-1-the-capital-market-line-cml" class="slide level2">
<h2>CAPM Implication 1: the Capital Market Line (CML)</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Images/F1.png" class="quarto-figure quarto-figure-center" style="width:70.0%"></p>
</figure>
</div>
</section>
<section id="the-cml-shows-no-clear-relationship-between-risk-and-return" class="slide level2">
<h2>The CML shows no clear relationship between risk and return…</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Images/F2.png" class="quarto-figure quarto-figure-center" style="width:70.0%"></p>
</figure>
</div>
</section>
<section id="capm-implication-2-the-security-market-line-sml-makes-the-relationship-clear-when-focusing-only-betam_i" class="slide level2">
<h2>CAPM Implication 2: the Security Market Line (SML) makes the relationship clear when focusing only (<span class="math inline">\(\beta^M_i\)</span>)!</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Images/F3.png" class="quarto-figure quarto-figure-center" style="width:60.0%"></p>
</figure>
</div>
</section>
<section id="hands-on-exercise" class="slide level2">
<h2>Hands-On Exercise</h2>
<ul>
<li>You work as a buy-side analyst at <em>Pierpoint Capital</em>, focusing on the chemicals industry. You job is replicate the <span class="blue">CAPM</span> for a handful of securities from the Chemical (basic) industry and provide insights for the fund manager:</li>
</ul>
<ol type="1">
<li>Which stocks, according to the <span class="blue">CAPM</span>, are <span class="green">undervalued</span> and why?</li>
<li>Which stocks, according to the <span class="blue">CAPM</span>, are <span class="red">overvalued</span> and why?</li>
<li>If the fund were to implement your strategy, what are the risks associated with?</li>
</ol>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Specific Instructions</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li><p>The securities to be included in the analysis are: Dow (ticker: <em>DOW</em>), LyondellBasell (<em>LYB</em>), Perimeter (<em>PRM</em>), Flotek (<em>FTK</em>), Rayonier (<em>RYAM</em>), Albemarle (<em>ALB</em>), Celanese (<em>CE</em>),The Chemours (<em>CC</em>), Ginkgo Bioworks (<em>DNA</em>), and American Vanguard (<em>AVD</em>).</p></li>
<li><p>CAPM estimation should be done at a <em>weekly</em> level using data from 2024</p></li>
</ol>
</div>
</div>
</div>
</section>
<section id="estimating-the-equity-cost-of-capital-in-practice" class="slide level2">
<h2>Estimating the Equity Cost of Capital in practice</h2>
<ul>
<li>The dynamics behind the pricing of securities under the <span class="blue">CAPM</span> are:</li>
</ul>
<p><span class="math display">\[R_i = R_f + \beta \times (E[R_m] - R_f)\]</span></p>
<ul>
<li><p>However, no one really told you from where the numbers came from</p></li>
<li><p>Recall that, under the <span class="blue">CAPM</span>, we need to have estimates related to the market portfolio:</p>
<ol type="1">
<li>It is is equal to the risk-free interest rate, <span class="blue"><span class="math inline">\(R_f\)</span></span>…</li>
<li>The expected return on the market portfolio, <span class="blue"><span class="math inline">\(E[R_m]\)</span></span>…</li>
<li>And a stock’s s sensitivity to the market portfolio, denoted by <span class="blue"><span class="math inline">\(\beta\)</span></span></li>
</ol></li>
</ul>
</section>
<section id="cost-of-equity-components-the-risk-free-rate" class="slide level2">
<h2>Cost of Equity Components: the risk-free rate</h2>
<ul>
<li><p>The first ingredient of CAPM is <span class="blue">risk-free rate</span>, which is the interest rate that investors can earn while having zero to limited volatility</p></li>
<li><p>Suggestions on how to pick the Risk-Free (<span class="math inline">\(R_f\)</span>) rate to be used:</p>
<ol type="1">
<li>The yield on U.S. Treasury securities</li>
<li>Surveys suggest most practitioners use 10- to 30-year treasuries</li>
<li>Highest quality assets</li>
</ol></li>
<li><p>Often, we use a short-term risk-free rate to evaluate a short-term investment, and a long-term rate when evaluating a long-term investment</p></li>
</ul>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Country-specific risk-free rates</strong></p>
</div>
<div class="callout-content">
<p>Whenever modeling assets <em>outside</em> of the U.S, we can either use the yields for local treasuries (<em>i.e</em>, relatively safer assets) or use U.S treasuries by adjusting the calculations for country-specific risk premium - see, for example, Brazilian’s <em>EMBI</em>.</p>
</div>
</div>
</div>
</section>
<section id="cost-of-equity-components-the-market-risk-premium" class="slide level2">
<h2>Cost of Equity Components: the market risk premium</h2>
<ul>
<li><p>Another component of the Cost of Equity is the difference between <span class="math inline">\(E[R_m]\)</span> and <span class="math inline">\(R_f\)</span> (the market risk premium)</p></li>
<li><p>Ways to estimate the market risk premium:</p>
<ol type="1">
<li>Estimate the risk premium (<span class="math inline">\(E[R_m] − R_f\)</span>) using the historical average excess return of the market over the risk-free interest rate</li>
<li>Notice that, even with long periods, we often have large standard errors</li>
<li>Implicitly, you are assuming that the past is a good proxy for the future</li>
</ol></li>
</ul>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Watch-out!</strong></p>
</div>
<div class="callout-content">
<p>Indexes like the <span class="blue">S&amp;P500</span> and <span class="blue">Ibovespa</span> are not considered the <span class="blue">market portfolio</span>, but rather, they are <em>proxies</em> for the market portfolios - in other words, they are reasonable approximations of the market portfolio for a given set universe of securities</p>
</div>
</div>
</div>
</section>
<section id="step-1-collecting-data" class="slide level2">
<h2>Step 1: Collecting Data</h2>
<ul>
<li><p>As a suggestion, we will be collecting data on U.S. Treasury yields and Market Risk Premium using <span class="blue">Kenneth French</span>’s <a href="https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/data_library.html">website</a>, which hosts a data library with updated on U.S. returns from a wide varieaty of risk factors and asset classes</p>
<ol type="1">
<li>Treasury yields (<span class="math inline">\(R_F\)</span>) are defined as the daily returns on the <em>1-month Treasury Bill</em></li>
<li>Market Returns (<span class="math inline">\(R_M\)</span>) are defined as the value-weighted returns on a bundle of U.S. stocks <sup>1</sup></li>
</ol></li>
<li><p>I have already worked on the data for you, and you can download it using the <em>Download</em> button - details on the code used to manipulate the data and put it into tidy format are presented in the next slide</p></li>
<li><p>To load the data in your session, call:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="co">#Assuming that you have the file in your working directory</span></span>
<span id="cb1-2"><a></a>FF_Data<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">'FF_Data.RDS'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<button class="btn btn-default" onclick="
    async function downloadFile(event) {
      event.preventDefault();
      try {
        const response = await fetch('data:application/octet-stream;base64,WAoAAAACAAQEAQACAwAAAAMTAAAAAwAAAw4AAAA1QNNDwAAAAABA00WAAAAAAEDTR0AAAAAAQNNJAAAAAABA00rAAAAAAEDTTIAAAAAAQNNOQAAAAABA01AAAAAAAEDTUcAAAAAAQNNTgAAAAABA01VAAAAAAEDTVwAAAAAAQNNYgAAAAABA01qAAAAAAEDTXEAAAAAAQNNeAAAAAABA01/AAAAAAEDTYYAAAAAAQNNjQAAAAABA02UAAAAAAEDTZsAAAAAAQNNogAAAAABA02pAAAAAAEDTbAAAAAAAQNNtwAAAAABA02+AAAAAAEDTcUAAAAAAQNNzAAAAAABA03TAAAAAAEDTdoAAAAAAQNN4QAAAAABA03oAAAAAAEDTe8AAAAAAQNN9gAAAAABA039AAAAAAEDTgQAAAAAAQNOCwAAAAABA04SAAAAAAEDThkAAAAAAQNOIAAAAAABA04nAAAAAAEDTi4AAAAAAQNONQAAAAABA048AAAAAAEDTkMAAAAAAQNOSgAAAAABA05RAAAAAAEDTlgAAAAAAQNOXwAAAAABA05mAAAAAAEDTm0AAAAAAQNOdAAAAAABA054AAAAAAAAABAIAAAABAAQACQAAAAVjbGFzcwAAABAAAAABAAQACQAAAAREYXRlAAAA/gAAAA4AAAA1v5NBOmTwECs/kLKBmBiYzj+ETPCttDUBP4VeJc2sxH0/iEeOlvP2+j+OZnfEUwAIv2f4k50d1PU/ibNkVQ/r8T+FtrVMN+3/v292I2XAigC/a6wFRFAlCT+Xn4LmQtXBP3KyWf+FkQC/h5A75Ww9ir+RKBN9DkQWv6BxtQo1P/s/m7oinJOciD93iCpkpPb7P5D1uSfeSUY/j5rw54m3e79gIBigxkj5v3rO4E5jcnw/gsRfIGxegj+Ke9wxUpMaP3YFphtJy/w/Fe+/AqmAAz+SCM6z5oq7P4Wn1/dOY3u/k7KuyLbm2L948iDpT7R/v5x2ZYkhlfe/UqsWxQaYED+kQKmJ2r3AP47A8RA4WHo/TkaF2iyX/r+nR5dyHLNaP6URACnUWIE/jpyz7JSWGz90dJzGRlsFP2BRmR9lxgg/h2Yuhh5ykj+A68mVXeV/v4dUVL105Pa/h2PD2ZZbQz+qSLbS/FLhv5c4FsQMtoY/ljH7EE4/uT+D4bs6hdYBP4TrkT2nCHG/gvEmi2C4v7+XSBAbeR4bP3bNKVLuIQK/j6QtG2wXKgAAAA4AAAA1P0zYaVS5//w/UgfDz9FYCz9M2GlUuf/8P1IHw8/RWAs/UbPOLbyj+j9RNd6I6Ef/P1E13ojoR/8/S4imkWuwBD9RNd6I6Ef/P1E13ojoR/8/UTXeiOhH/z9RNd6I6Ef/P0uIppFrsAQ/UTXeiOhH/z9RNd6I6Ef/P1E13ojoR/8/UTXeiOhH/z9Qt++JG8QFP1Bj+2gZY/k/UGP7aBlj+T9QY/toGWP5P0o45mIZR/4/UgfDz9FYCz9SB8PP0VgLP0zYaVS5//w/UgfDz9FYCz9LiKaRa7AEP1E13ojoR/8/UTXeiOhH/z9RNd6I6Ef/P1GJ04X0f/E/UgfDz9FYCz9SB8PP0VgLP1IHw8/RWAs/UgfDz9FYCz9KOOZiGUf+P1Bj+2gZY/k/UGP7aBlj+T9QY/toGWP5P0zYkiiK0AA/S9y91D8wAj9L3L3UPzACP0vcvdQ/MAI/TNiSKIrQAD9QY/toGWP5P1Bj+2gZY/k/UGP7aBlj+T9KOOZiGUf+P0vcvdQ/MAI/S9y91D8wAj9L3L3UPzACP0ZJtUvn//8/Nki9AVRwBgAABAIAAAABAAQACQAAAAVuYW1lcwAAABAAAAADAAQACQAAAAREYXRlAAQACQAAAANNUlAABAAJAAAAAlJmAAAEAgAAAf8AAAAQAAAAAQAEAAkAAAAKZGF0YS5mcmFtZQAABAIAAAABAAQACQAAAAlyb3cubmFtZXMAAAANAAAAAoAAAAD////LAAAA/g==');
        if (!response.ok) throw new Error('Network response failed');
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = 'FF_Data.rds';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.dispatchEvent(new MouseEvent('click'));
        document.body.removeChild(a);
        setTimeout(() => {
          window.URL.revokeObjectURL(blobUrl);
        }, 100);
        return false;
      } catch (error) {
        console.error('Download failed:', error);
        alert('Download failed. Please try again.');
      }
    }
    downloadFile(event);
  " has_icon="TRUE"><i class="fa fa-save"></i> Download Raw data</button>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p>Click <a href="https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/Data_Library/f-f_5_factors_2x3.html">here</a> for details around the stock selection criteria.</p></li></ol></aside></section>
<section id="step-1-r_m-r_f-and-the-market-risk-premium" class="slide level2">
<h2>Step 1: <span class="math inline">\(R_M\)</span>, <span class="math inline">\(R_F\)</span>, and the Market Risk Premium</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Code</a></li><li><a href="#tabset-1-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="co"># Use Fama-French Data to retrieve Rf and MRP</span></span>
<span id="cb2-2"><a></a>FF_url <span class="ot">&lt;-</span> <span class="st">"https://mba.tuck.dartmouth.edu/pages/faculty/ken.french/ftp/F-F_Research_Data_5_Factors_2x3_daily_CSV.zip"</span></span>
<span id="cb2-3"><a></a>temp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb2-4"><a></a><span class="fu">download.file</span>(FF_url, temp_file)</span>
<span id="cb2-5"><a></a></span>
<span id="cb2-6"><a></a><span class="co">#Download and manipulate the data</span></span>
<span id="cb2-7"><a></a><span class="fu">unzip</span>(temp_file)<span class="sc">%&gt;%</span></span>
<span id="cb2-8"><a></a><span class="fu">read.csv</span>(<span class="at">skip=</span><span class="dv">3</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-9"><a></a><span class="co">#Select only the data, Excess Returns, and Risk-Free Columns</span></span>
<span id="cb2-10"><a></a><span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a></a><span class="co">#Change the names of the variables</span></span>
<span id="cb2-12"><a></a><span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'Date'</span>,<span class="st">'MRP'</span>,<span class="st">'Rf'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a></a><span class="co">#Make sure the date columns is read as a Date object</span></span>
<span id="cb2-14"><a></a><span class="fu">mutate</span>(<span class="at">Date=</span><span class="fu">as.Date</span>(<span class="fu">strptime</span>(Date,<span class="at">format=</span><span class="st">'%Y%m%d'</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a></a><span class="co">#Filter for 2024</span></span>
<span id="cb2-16"><a></a><span class="fu">filter</span>(<span class="fu">year</span>(Date)<span class="sc">==</span><span class="dv">2024</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a></a><span class="co">#Manipulate data to aggregate</span></span>
<span id="cb2-18"><a></a><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),\(x) (<span class="dv">1</span><span class="sc">+</span>x<span class="sc">/</span><span class="dv">100</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a></a><span class="co">#Pivot to get only one column</span></span>
<span id="cb2-20"><a></a><span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"Key"</span>,<span class="at">values_to =</span> <span class="st">"Value"</span>,<span class="sc">-</span>Date)<span class="sc">%&gt;%</span></span>
<span id="cb2-21"><a></a><span class="co">#Group by the newly created Key column</span></span>
<span id="cb2-22"><a></a><span class="fu">group_by</span>(Key)<span class="sc">%&gt;%</span></span>
<span id="cb2-23"><a></a><span class="co">#Apply nest() for functional programming and perform aggregation</span></span>
<span id="cb2-24"><a></a><span class="fu">nest</span>()<span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a></a><span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data,as.xts))<span class="sc">%&gt;%</span></span>
<span id="cb2-26"><a></a><span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data,apply.weekly,\(x) <span class="fu">prod</span>(x)<span class="sc">-</span><span class="dv">1</span>))<span class="sc">%&gt;%</span></span>
<span id="cb2-27"><a></a><span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data,as.data.frame))<span class="sc">%&gt;%</span></span>
<span id="cb2-28"><a></a><span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(data,<span class="sc">~</span><span class="fu">rownames_to_column</span>(.,<span class="st">'Date'</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb2-29"><a></a><span class="fu">unnest</span>(data)<span class="sc">%&gt;%</span></span>
<span id="cb2-30"><a></a><span class="co">#Pivot back to wide format</span></span>
<span id="cb2-31"><a></a><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Key,<span class="at">values_from =</span> Value)<span class="sc">%&gt;%</span></span>
<span id="cb2-32"><a></a><span class="co">#Write as a csv</span></span>
<span id="cb2-33"><a></a><span class="fu">saveRDS</span>(<span class="st">'MRP_and_RF.rds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>         Date           MRP           Rf
1  2024-01-05 -1.880351e-02 0.0008802904
2  2024-01-12  1.630595e-02 0.0011004841
3  2024-01-19  9.912377e-03 0.0008802904
4  2024-01-26  1.043348e-02 0.0011004841
5  2024-02-02  1.185523e-02 0.0010804666
6  2024-02-09  1.484388e-02 0.0010504411
7  2024-02-16 -2.926148e-03 0.0010504411
8  2024-02-23  1.254919e-02 0.0008402646
9  2024-03-01  1.060239e-02 0.0010504411
10 2024-03-08 -3.840512e-03 0.0010504411
11 2024-03-15 -3.377924e-03 0.0010504411
12 2024-03-22  2.306942e-02 0.0010504411
13 2024-03-28  4.564621e-03 0.0008402646
14 2024-04-05 -1.150557e-02 0.0010504411
15 2024-04-12 -1.675444e-02 0.0010504411
16 2024-04-19 -3.211752e-02 0.0010504411
17 2024-04-26  2.707724e-02 0.0010504411
18 2024-05-03  5.745092e-03 0.0010204162
19 2024-05-10  1.656236e-02 0.0010004001
20 2024-05-17  1.543225e-02 0.0010004001
21 2024-05-24 -1.968430e-03 0.0010004001
22 2024-05-31 -6.544949e-03 0.0008002400
23 2024-06-07  9.163612e-03 0.0011004841
24 2024-06-14  1.293156e-02 0.0011004841
25 2024-06-21  5.376481e-03 0.0008802904
26 2024-06-28  8.368114e-05 0.0011004841
27 2024-07-05  1.761172e-02 0.0008402646
28 2024-07-12  1.057404e-02 0.0010504411
29 2024-07-19 -1.923631e-02 0.0010504411
30 2024-07-26 -6.090287e-03 0.0010504411
31 2024-08-02 -2.779540e-02 0.0010704580
32 2024-08-09 -1.139424e-03 0.0011004841
33 2024-08-16  3.955583e-02 0.0011004841
34 2024-08-23  1.501644e-02 0.0011004841
35 2024-08-30  9.239343e-04 0.0011004841
36 2024-09-06 -4.546808e-02 0.0008002400
37 2024-09-13  4.114533e-02 0.0010004001
38 2024-09-20  1.494732e-02 0.0010004001
39 2024-09-27  4.994023e-03 0.0010004001
40 2024-10-04  1.992034e-03 0.0008803095
41 2024-10-11  1.142536e-02 0.0008502890
42 2024-10-18  8.262229e-03 0.0008502890
43 2024-10-25 -1.139132e-02 0.0008502890
44 2024-11-01 -1.142076e-02 0.0008803095
45 2024-11-08  5.133601e-02 0.0010004001
46 2024-11-15 -2.267490e-02 0.0010004001
47 2024-11-22  2.167504e-02 0.0010004001
48 2024-11-29  9.707892e-03 0.0008002400
49 2024-12-06  1.021493e-02 0.0008502890
50 2024-12-13 -9.249021e-03 0.0008502890
51 2024-12-20 -2.273584e-02 0.0008502890
52 2024-12-27  5.566751e-03 0.0006801734
53 2024-12-31 -1.544986e-02 0.0003400289</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="step-2-collecting-stock-price-information" class="slide level2">
<h2>Step 2: collecting stock price information</h2>
<ul>
<li><p>Now that we have the right-hand side components of your <span class="blue">CAPM</span> equation, it is time to collect information on stock prices for the selected stocks. By now, you can pretty much apply the rationale you’ve done in previous lectures:</p>
<ol type="1">
<li>Create a vector <code>assets</code> containing the tickers that you wish to request information from</li>
<li>Create a <code>start</code> and <code>end</code> objects containing the analysis period</li>
<li>Use <code>tq_get()</code> and pipe <code>assets</code> onto the function along with <code>from=start</code> and <code>to=end</code> arguments</li>
<li>Manipulate the data to calculate weekly returns, assigning it to an object called <code>Stock_Data</code></li>
</ol></li>
<li><p>Finally, you can use <code>left_join()</code> to merge <code>Stock_Data</code> with <code>FF_Data</code>:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>Final_Data<span class="ot">=</span>Stock_Data<span class="sc">%&gt;%</span><span class="fu">left_join</span>(FF_Data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-collecting-stock-price-information-1" class="slide level2">
<h2>Step 2: collecting stock price information</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Code</a></li><li><a href="#tabset-2-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="co">#Create the start and end dates</span></span>
<span id="cb5-2"><a></a>start<span class="ot">=</span><span class="fu">as.Date</span>(<span class="st">'2024-01-01'</span>)</span>
<span id="cb5-3"><a></a>end<span class="ot">=</span><span class="fu">as.Date</span>(<span class="st">'2024-12-31'</span>)</span>
<span id="cb5-4"><a></a></span>
<span id="cb5-5"><a></a><span class="co">#Create the list of assets</span></span>
<span id="cb5-6"><a></a>assets<span class="ot">=</span><span class="fu">c</span>(<span class="st">'DOW'</span>,<span class="st">'LYB'</span>,<span class="st">'PRM'</span>,<span class="st">'FTK'</span>,<span class="st">'RYAM'</span>,</span>
<span id="cb5-7"><a></a>         <span class="st">'ALB'</span>,<span class="st">'CE'</span>,<span class="st">'CC'</span>,<span class="st">'DNA'</span>,<span class="st">'AVD'</span>)</span>
<span id="cb5-8"><a></a></span>
<span id="cb5-9"><a></a><span class="co">#Collect data, select necessary columns, and calculate weekly returns</span></span>
<span id="cb5-10"><a></a>Stock_Data<span class="ot">=</span>assets<span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a></a>  <span class="fu">tq_get</span>(<span class="at">from=</span>start,<span class="at">to=</span>end)<span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a></a>  <span class="fu">select</span>(symbol,date,adjusted)<span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a></a>  <span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a></a>  <span class="fu">tq_transmute</span>(<span class="at">select =</span> adjusted,</span>
<span id="cb5-15"><a></a>               <span class="at">mutate_fun =</span> weeklyReturn,</span>
<span id="cb5-16"><a></a>               <span class="at">col_rename =</span> <span class="st">'weekly_return'</span>)</span>
<span id="cb5-17"><a></a></span>
<span id="cb5-18"><a></a><span class="co">#Left join when column names are different</span></span>
<span id="cb5-19"><a></a>Full_Data<span class="ot">=</span>Stock_Data<span class="sc">%&gt;%</span><span class="fu">left_join</span>(FF_Data,<span class="at">by=</span><span class="fu">c</span>(<span class="st">'date'</span><span class="ot">=</span><span class="st">'Date'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 530 × 5
# Groups:   symbol [10]
   symbol date       weekly_return      MRP       Rf
   &lt;chr&gt;  &lt;date&gt;             &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1 DOW    2024-01-05      -0.00922 -0.0188  0.000880
 2 DOW    2024-01-12      -0.0265   0.0163  0.00110 
 3 DOW    2024-01-19      -0.0105   0.00991 0.000880
 4 DOW    2024-01-26       0.0237   0.0104  0.00110 
 5 DOW    2024-02-02      -0.0118   0.0119  0.00108 
 6 DOW    2024-02-09       0.0107   0.0148  0.00105 
 7 DOW    2024-02-16       0.0276  -0.00293 0.00105 
 8 DOW    2024-02-23       0.0164   0.0125  0.000840
 9 DOW    2024-03-01       0.00146  0.0106  0.00105 
10 DOW    2024-03-08       0.0151  -0.00384 0.00105 
# ℹ 520 more rows</code></pre>
</div>
</div>
<p><span class="math inline">\(\rightarrow\)</span> <em>You now have the weekly returns for all selected stocks, the weekly risk-free returns, and the weekly market returns!</em></p>
</div>
</div>
</div>
</section>
<section id="cost-of-equity-components-beta-estimation" class="slide level2">
<h2>Cost of Equity Components: <span class="math inline">\(\beta\)</span> estimation</h2>
<ul>
<li><p>All that’s left is to estimate the stocks’s sensitivity to the returns of the market portfolio, <span class="math inline">\(\beta\)</span></p></li>
<li><p>From what we know on the theory on portfolio returns, a new asset <span class="math inline">\(i\)</span> should be enhance the performance of a portfolio if:</p></li>
</ul>
<p><span class="math display">\[
\small \underbrace{\frac{E[R_i] - R_f}{\sigma_{i} \times Corr(R_i,R_m)}}_{\text{Sharpe Ratio of } i} &gt; \underbrace{\frac{E[R_m] - R_f}{\sigma_{m}}}_{\text{Sharpe Ratio of Market}}
\]</span></p>
<ul>
<li>With that, we saw that the expected return from an asset <span class="math inline">\(i\)</span> should be:</li>
</ul>
<p><span class="math display">\[
\small R_i - R_f = \underbrace{\frac{\sigma_{i} \times Corr(R_i,R_m)}{\sigma_{m}}}_{\beta^M_i}  \times (E[R_m] - R_f)
\]</span></p>
</section>
<section id="cost-of-equity-components-beta-estimation-continued" class="slide level2">
<h2>Cost of Equity Components: <span class="math inline">\(\beta\)</span> estimation, continued</h2>
<ul>
<li>Because <span class="math inline">\(\small Corr(R_i,R_m)=\frac{Cov(R_i,R_m)}{\sigma_i\sigma_m}\)</span>, we have that:</li>
</ul>
<p><span class="math display">\[
\small (R_i - R_f)=\frac{\sigma_{i} \times Cov(R_i,R_m)}{\sigma_i \sigma_m\sigma_{m}}  \times (E[R_p] - R_f)\rightarrow  (R_i - R_f)=  \underbrace{\frac{Cov(R_i,R_m)}{\sigma^2_m}}_{\text{OLS formula for slope}}\times (E[R_p] - R_f)
\]</span></p>
<ul>
<li>We can then estimate <span class="math inline">\(\beta\)</span> using an <em>Ordinary Least Squares</em> regression:</li>
</ul>
<p><span class="math display">\[
\small \underbrace{(R_i - R_f)}_{\text{Excess Return}} = \underbrace{\alpha_i}_{\text{Uncorrelated Return}} + \underbrace{\beta_i}_{\text{Stock's Market Sensitivity}} \times \underbrace{(R_m - R_f)}_{\text{Risk Premium}} + \epsilon_i
\]</span></p>
<ul>
<li><span class="math inline">\(\epsilon_i\)</span> is the error term (or the <em>residual</em>). It represents the <em>deviations</em> from the best-fitting line and is, by definition, zero on average (or else we could improve the fit), and represent firm-specific risk that is diversifiable and that averages out in a large portfolio</li>
</ul>
</section>
<section id="step-3-estimating-alpha-and-beta" class="slide level2">
<h2>Step 3: estimating <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span></h2>
<ul>
<li>We know need estimate the following equation for each stock in our analysis:</li>
</ul>
<p><span class="math display">\[
\small Excess_t = \alpha + \beta \times (R_m - R_f) + \epsilon_t
\]</span></p>
<ul>
<li><p>The naivest way to do it is to repeat the process <span class="math inline">\(10\)</span> times, filtering each stock at a time, and running an <em>OLS</em> model with the <code>lm()</code> function:</p>
<ol type="1">
<li>Start with the <code>Full_Data</code> object and pipe onto <code>mutate</code> to creat the <code>excess_return</code> variable</li>
<li><code>select</code> only the <code>symbol</code>, the <code>excess_return</code>, and the <code>MRP</code> columns</li>
<li>Use <code>filter</code> to work with a single ticker, say, <code>symbol=='DOW'</code></li>
<li>Call the <code>lm()</code> function to run an <em>OLS</em> regression of excess returns on market returns</li>
</ol></li>
<li><p>The next slide shows the result of estimating the <span class="blue">CAPM</span> model for <em>RYAM</em></p></li>
</ul>
</section>
<section id="step-3-estimating-alpha-and-beta-ryam-only" class="slide level2">
<h2>Step 3: estimating <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> (<em>RYAM</em> only)</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Code</a></li><li><a href="#tabset-3-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co">#Manipulate data</span></span>
<span id="cb7-2"><a></a>RYAM<span class="ot">=</span>Full_Data<span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a></a>  <span class="fu">filter</span>(symbol<span class="sc">==</span><span class="st">'RYAM'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a></a>  <span class="fu">mutate</span>(<span class="at">excess_return=</span>weekly_return<span class="sc">-</span>Rf)<span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a></a>  <span class="fu">select</span>(symbol,excess_return,MRP)</span>
<span id="cb7-6"><a></a></span>
<span id="cb7-7"><a></a><span class="co">#Run the OLS regression</span></span>
<span id="cb7-8"><a></a>OLS<span class="ot">=</span><span class="fu">lm</span>(excess_return<span class="sc">~</span>MRP,<span class="at">data=</span>RYAM)</span>
<span id="cb7-9"><a></a></span>
<span id="cb7-10"><a></a><span class="co">#Inspect the results using summary()</span></span>
<span id="cb7-11"><a></a><span class="fu">summary</span>(OLS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = excess_return ~ MRP, data = RYAM)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.153351 -0.036530 -0.005546  0.026486  0.185118 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) 0.008144   0.009698   0.840   0.4050  
MRP         1.237611   0.529959   2.335   0.0236 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.06842 on 50 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.09835,   Adjusted R-squared:  0.08031 
F-statistic: 5.454 on 1 and 50 DF,  p-value: 0.02358</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="understanding-the-beta-term-inside-the-ols-estimation" class="slide level2">
<h2>Understanding the <span class="math inline">\(\beta\)</span> term inside the OLS estimation</h2>
<p><span class="math display">\[
\small \underbrace{(R_i - R_f)}_{\text{Excess Return}} = \underbrace{\alpha}_{\text{Uncorrelated Return}} + \underbrace{\beta}_{\text{Stock's Market Sensitivity}} \times \underbrace{(R_m - R_f)}_{\text{Risk Premium}} + \epsilon
\]</span></p>
<ol type="1">
<li><p><span class="math inline">\(\beta\)</span> is the sensitivity to market risk. It measures the historical variation of the security relative to the market</p></li>
<li><p>According to the CAPM, all assets should line on the <em>Security Market Line (SML)</em></p></li>
</ol>
<ul>
<li>If <span class="math inline">\(\beta&gt;1\)</span>, it means that a 1% variation in market returns implies a variation that is <span class="blue">greater</span> than 1% in stock returns (either <span class="green">up</span> or <span class="red">down</span>!)</li>
<li>If <span class="math inline">\(\beta&lt;1\)</span> it means that a 1% variation in market returns implies a variation that is <span class="blue">less</span> than 1% in stock returns (either <span class="green">up</span> or <span class="red">down</span>!)</li>
</ul>
</section>
<section id="assessing-required-returns" class="slide level2">
<h2>Assessing Required Returns</h2>
<ul>
<li>Suppose you need to price the long-run required returns for investing in an opportunity that has the same equity risk and as <em>RYAM</em>. It is now a straightforward application of the <span class="blue">CAPM</span>:</li>
</ul>
<p><span class="math display">\[
\small \text{Required Return} = R_f +  \beta \times (R_m - R_f)
\]</span></p>
<ul>
<li><p>Say, for example that you have the following information:</p>
<ol type="1">
<li>The historical long-run risk-free rate return, <span class="math inline">\(\small R_f\)</span>, is <span class="math inline">\(\small 4.50\%\)</span></li>
<li>The historical long-run market return, <span class="math inline">\(\small R_m\)</span>, is <span class="math inline">\(\small 9.94\%\)</span></li>
<li>The <span class="math inline">\(\beta\)</span> you’ve just found is <span class="math inline">\(\small 1.23\)</span></li>
</ol></li>
<li><p>Then, the long-run required return is simply:</p></li>
</ul>
<p><span class="math display">\[
\small \text{Required Return} = 4.5\%+ 1.23\times(9.94\%-4.5\%)=11.20\%
\]</span></p>
</section>
<section id="the-dynamic-nature-of-beta" class="slide level2">
<h2>The Dynamic Nature of <span class="math inline">\(\beta\)</span></h2>
<ul>
<li><p>In our previous example, <span class="math inline">\(\beta\)</span> was estimated using a simple <em>OLS</em> regression of asset excess returns on market excess returns</p></li>
<li><p>Our estimate of <span class="math inline">\(\beta\)</span> was then used to build the required return for <em>RYAM</em>. Note, however, that the sensitivity of <em>RYAM</em> to systematic risk changes over time:</p>
<ol type="1">
<li>Shifts in business models (<em>e.g.</em>, firms diversifying revenue streams)</li>
<li>Macroeconomic conditions (<em>e.g.</em>, monetary policy, recessions)</li>
<li>Market structure changes (<em>e.g.</em>, sector rotations, liquidity shifts)</li>
<li>Leverage variations (<em>e.g</em>., debt levels affecting risk exposure)</li>
</ol></li>
<li><p>In what follows, we’ll look how the <span class="math inline">\(\beta\)</span> estimate for <em>RYAM</em> changes over time considering an estimation window of <span class="math inline">\(24\)</span> weeks</p></li>
</ul>
</section>
<section id="the-dynamic-nature-of-beta-continued" class="slide level2">
<h2>The Dynamic Nature of <span class="math inline">\(\beta\)</span>, continued</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Code</a></li><li><a href="#tabset-4-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="co">#Manipulate data</span></span>
<span id="cb9-2"><a></a>RYAM<span class="ot">=</span>Full_Data<span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a></a>  <span class="fu">filter</span>(symbol<span class="sc">==</span><span class="st">'RYAM'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a></a>  <span class="fu">mutate</span>(<span class="at">excess_return=</span>weekly_return<span class="sc">-</span>Rf)<span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a></a>  <span class="fu">select</span>(date,symbol,excess_return,MRP)</span>
<span id="cb9-6"><a></a></span>
<span id="cb9-7"><a></a><span class="co">#Create a custom OLS function that extracts all coefficients to pass it to tq_transmute </span></span>
<span id="cb9-8"><a></a>custom_OLS <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb9-9"><a></a>    <span class="fu">coef</span>(<span class="fu">lm</span>(excess_return <span class="sc">~</span> MRP, <span class="at">data =</span> data))</span>
<span id="cb9-10"><a></a>}</span>
<span id="cb9-11"><a></a></span>
<span id="cb9-12"><a></a><span class="co">#Apply the custom function to tq_transmute in rolling format</span></span>
<span id="cb9-13"><a></a>rolling_regs<span class="ot">=</span>RYAM<span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a></a>  <span class="fu">tq_transmute</span>(</span>
<span id="cb9-15"><a></a>      <span class="at">mutate_fun =</span> rollapply,</span>
<span id="cb9-16"><a></a>      <span class="at">by.column=</span><span class="cn">FALSE</span>,</span>
<span id="cb9-17"><a></a>      <span class="at">width=</span><span class="dv">24</span>, <span class="co">#Use latest 24 weeks</span></span>
<span id="cb9-18"><a></a>      <span class="at">FUN =</span> custom_OLS,</span>
<span id="cb9-19"><a></a>      <span class="at">col_rename =</span> <span class="fu">c</span>(<span class="st">'alpha'</span>,<span class="st">'beta'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(alpha))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 × 4
# Groups:   symbol [1]
   symbol date         alpha     beta
   &lt;chr&gt;  &lt;date&gt;       &lt;dbl&gt;    &lt;dbl&gt;
 1 RYAM   2024-06-14 0.0122   0.274  
 2 RYAM   2024-06-21 0.0110   0.311  
 3 RYAM   2024-06-28 0.0106   0.510  
 4 RYAM   2024-07-05 0.00960  0.387  
 5 RYAM   2024-07-12 0.00884  0.358  
 6 RYAM   2024-07-19 0.0122   0.00874
 7 RYAM   2024-07-26 0.0151  -0.186  
 8 RYAM   2024-08-02 0.0117   0.254  
 9 RYAM   2024-08-09 0.0222   0.334  
10 RYAM   2024-08-16 0.0288   0.615  
# ℹ 20 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="the-dynamic-nature-of-beta-practice" class="slide level2">
<h2>The Dynamic Nature of <span class="math inline">\(\beta\)</span>, practice</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Code</a></li><li><a href="#tabset-5-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="co">#Pipe the rolling regression object into ggplot</span></span>
<span id="cb11-2"><a></a>rolling_regs<span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>date,<span class="at">y=</span>beta))<span class="sc">+</span></span>
<span id="cb11-4"><a></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb11-5"><a></a>  <span class="fu">geom_smooth</span>()<span class="sc">+</span></span>
<span id="cb11-6"><a></a>  <span class="co">#Annotations</span></span>
<span id="cb11-7"><a></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rolling Beta regression (RYAM)'</span>,</span>
<span id="cb11-8"><a></a>       <span class="at">subtitle =</span> <span class="st">'Source: Yahoo! Finance. Using the latest 24 observations of weekly returns.'</span>,</span>
<span id="cb11-9"><a></a>       <span class="at">x =</span> <span class="st">'Week'</span>,</span>
<span id="cb11-10"><a></a>       <span class="at">y =</span> <span class="st">'Estimated Beta'</span>)<span class="sc">+</span></span>
<span id="cb11-11"><a></a>  <span class="co">#Theme</span></span>
<span id="cb11-12"><a></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb11-13"><a></a>  <span class="co">#Scale x</span></span>
<span id="cb11-14"><a></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">'4 weeks'</span>)<span class="sc">+</span>  </span>
<span id="cb11-15"><a></a>  <span class="co">#Adding further customizations</span></span>
<span id="cb11-16"><a></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">'none'</span>,</span>
<span id="cb11-17"><a></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="sc">+</span><span class="dv">4</span>,<span class="at">face=</span><span class="st">'bold'</span>),</span>
<span id="cb11-18"><a></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">vjust=</span><span class="sc">-</span><span class="dv">3</span>,<span class="at">face=</span><span class="st">'bold'</span>),</span>
<span id="cb11-19"><a></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-14-1.png" width="1440"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="understanding-the-alpha-term-inside-the-ols-estimation" class="slide level2">
<h2>Understanding the <span class="math inline">\(\alpha\)</span> term inside the OLS estimation</h2>
<p><span class="math display">\[
\small \underbrace{(R_i - R_f)}_{\text{Excess Return}} = \underbrace{\alpha}_{\text{Uncorrelated Return}} + \underbrace{\beta}_{\text{Stock's Market Sensitivity}} \times \underbrace{(R_m - R_f)}_{\text{Risk Premium}} + \epsilon
\]</span></p>
<ol type="1">
<li><p><span class="math inline">\(\alpha_i\)</span> is the constant term. It measures the historical performance of the security relative to the expected return predicted by the security market line</p></li>
<li><p>It is the distance that the stock’s average return is above or below the SML. Thus, we can say <span class="math inline">\(\alpha_i\)</span> is a risk-adjusted measure of the stock’s historical performance.</p></li>
<li><p>According to the CAPM, <span class="math inline">\(\alpha_i\)</span> <span class="blue">should not be significantly different from zero</span></p></li>
</ol>
<ul>
<li>If <span class="math inline">\(\alpha&gt;0\)</span> consistently, it would mean that a security delivers a <em>constant</em> positive return and, by definition, independent from the market returns</li>
<li>If that is the case, investors would buy the security up to a point where price adjusts so that <span class="math inline">\(\alpha\)</span> goes to zero (recall <em>Assumption #1</em>)!</li>
</ul>
</section>
<section id="interpreting-alpha" class="slide level2">
<h2>Interpreting <span class="math inline">\(\alpha\)</span></h2>
<p><span class="math display">\[\small \alpha_i = \underbrace{E[R_i]}_{\text{Observed by the analyst}} - \underbrace{R_i}_{\text{Implied by the CAPM}}\]</span></p>
<ol type="1">
<li><strong>A <span class="green">positive</span> alpha means that the stock is <span class="green">above</span> the SML</strong>
<ul>
<li>In words, the expected return is <span class="green">higher</span> than its required return. Before prices adjust, investors will anticipate that the price will <span class="green">rise</span> and will likely put in buy orders at the current prices</li>
</ul></li>
<li><strong>A <span class="red">negative</span> alpha means that the stock is <span class="red">below</span> the SML</strong>
<ul>
<li>The expected return is <span class="red">lower</span> than its required return. Before prices adjust, investors will anticipate that the price will <span class="red">fall</span> and will likely put in sell orders at the current prices</li>
</ul></li>
</ol>
<p><span class="math inline">\(\rightarrow\)</span> <em>In either case, we’ll be able to improve portfolio results. However, as we do so, prices will change and their alphas will shrink towards zero!</em></p>
</section>
<section id="step-4-putting-all-together" class="slide level2">
<h2>Step 4: putting all together</h2>
<ul>
<li><p>Our final step is to use the <span class="blue">CAPM</span> to assess which stocks are <span class="red">overvalued</span>, and which ones are <span class="green">undervalued</span></p></li>
<li><p>You could proceed by doing the same procedure as before, but now focusing on the <span class="math inline">\(\alpha\)</span> term that has been estimated for you</p>
<ol type="1">
<li><p>To do that for all 10 stocks, you could do a <code>for</code> loop, store the results, and analyze</p></li>
<li><p>In general, <code>for</code> loops are <em>inefficient</em>: they run sequentially, have slower performance, and are difficult to read</p></li>
</ol></li>
<li><p>An alternative is to use the <code>tidyverse</code> excellent capabilities for functional programming using the <code>map</code> function from the <code>purrr</code> package, which breaks the problem into sub-pieces and estimate the models in parallel</p></li>
<li><p>For detailed information on functional programming, see <code>purrr</code> documentation <a href="https://purrr.tidyverse.org/">here</a></p></li>
</ul>
</section>
<section id="step-4-putting-all-together-continued" class="slide level2">
<h2>Step 4: putting all together, continued</h2>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-6-1">For Loop</a></li><li><a href="#tabset-6-2">Functional Programming</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="co">#Start an empty data.frame</span></span>
<span id="cb12-2"><a></a>Stored_Data<span class="ot">=</span><span class="fu">data.frame</span>()</span>
<span id="cb12-3"><a></a></span>
<span id="cb12-4"><a></a><span class="cf">for</span> (i <span class="cf">in</span> assets){</span>
<span id="cb12-5"><a></a>  </span>
<span id="cb12-6"><a></a>  <span class="co">#Manipulate data</span></span>
<span id="cb12-7"><a></a>  Filtered_Data<span class="ot">=</span>Full_Data<span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a></a>    <span class="co">#Filter for the specific ticker</span></span>
<span id="cb12-9"><a></a>    <span class="fu">filter</span>(symbol<span class="sc">==</span> i)<span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a></a>    <span class="fu">mutate</span>(<span class="at">excess_return=</span>weekly_return<span class="sc">-</span>Rf)<span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a></a>    <span class="fu">select</span>(symbol,excess_return,MRP)</span>
<span id="cb12-12"><a></a>  </span>
<span id="cb12-13"><a></a>  <span class="co">#Run the OLS regression</span></span>
<span id="cb12-14"><a></a>  OLS<span class="ot">=</span><span class="fu">lm</span>(excess_return<span class="sc">~</span>MRP,<span class="at">data=</span>Filtered_Data)</span>
<span id="cb12-15"><a></a></span>
<span id="cb12-16"><a></a>  <span class="co">#Get the coefficients using the coefficients() function and add it to a temp data</span></span>
<span id="cb12-17"><a></a>  </span>
<span id="cb12-18"><a></a>  Temp_Data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">ticker=</span>i,</span>
<span id="cb12-19"><a></a>                         <span class="at">alpha=</span><span class="fu">coefficients</span>(OLS)[<span class="dv">1</span>],</span>
<span id="cb12-20"><a></a>                         <span class="at">beta=</span><span class="fu">coefficients</span>(OLS)[<span class="dv">2</span>])</span>
<span id="cb12-21"><a></a>  </span>
<span id="cb12-22"><a></a>  <span class="co">#Bind it to the dataframe</span></span>
<span id="cb12-23"><a></a>  Stored_Data<span class="ot">=</span>Stored_Data<span class="sc">%&gt;%</span><span class="fu">rbind</span>(Temp_Data)</span>
<span id="cb12-24"><a></a>  </span>
<span id="cb12-25"><a></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>CAPM_Estimation<span class="ot">=</span>Full_Data<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a></a>  <span class="fu">mutate</span>(<span class="at">excess_return=</span>weekly_return<span class="sc">-</span>Rf)<span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a></a>  <span class="fu">select</span>(symbol,excess_return,MRP)<span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a></a>  <span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a></a>  <span class="fu">nest</span>()<span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a></a>  <span class="fu">mutate</span>(<span class="at">CAPM =</span> <span class="fu">map</span>(data,<span class="sc">~</span> <span class="fu">lm</span>(excess_return<span class="sc">~</span>MRP,<span class="at">data=</span>.)))<span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a></a>  <span class="fu">mutate</span>(<span class="at">coefficients =</span> <span class="fu">map</span>(CAPM,tidy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="charting-the-result" class="slide level2">
<h2>Charting the result</h2>
<div class="panel-tabset">
<ul id="tabset-7" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-7-1">Code</a></li><li><a href="#tabset-7-2">Output</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a>CAPM_Estimation<span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a></a>  <span class="fu">select</span>(coefficients)<span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a></a>  <span class="fu">unnest</span>()<span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a></a>  <span class="fu">filter</span>(term<span class="sc">==</span><span class="st">'(Intercept)'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a></a>  <span class="fu">select</span>(symbol,estimate)<span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'Ticker'</span>,<span class="st">'Alpha'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Ticker,<span class="at">y=</span>Alpha))<span class="sc">+</span></span>
<span id="cb14-8"><a></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb14-9"><a></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">yend =</span> <span class="dv">0</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>)<span class="sc">+</span></span>
<span id="cb14-10"><a></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>,<span class="at">linetype=</span><span class="st">'dashed'</span>)<span class="sc">+</span></span>
<span id="cb14-11"><a></a>  <span class="co">#Annotations</span></span>
<span id="cb14-12"><a></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Using CAPM to analyze over/undervalued investment opportunities'</span>,</span>
<span id="cb14-13"><a></a>       <span class="at">subtitle =</span> <span class="st">'Source: Yahoo! Finance'</span>,</span>
<span id="cb14-14"><a></a>       <span class="at">x =</span> <span class="st">'Ticker'</span>,</span>
<span id="cb14-15"><a></a>       <span class="at">y =</span> <span class="st">'Alpha'</span>)<span class="sc">+</span></span>
<span id="cb14-16"><a></a>  <span class="co">#Scales</span></span>
<span id="cb14-17"><a></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent)<span class="sc">+</span></span>
<span id="cb14-18"><a></a>  <span class="co">#Custom 'TidyQuant' theme</span></span>
<span id="cb14-19"><a></a>  <span class="fu">theme_tq</span>()<span class="sc">+</span></span>
<span id="cb14-20"><a></a>  <span class="co">#Adding further customizations</span></span>
<span id="cb14-21"><a></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">'none'</span>,</span>
<span id="cb14-22"><a></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">'bold'</span>,<span class="at">size=</span><span class="dv">15</span>),</span>
<span id="cb14-23"><a></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb14-24"><a></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>,<span class="at">face=</span><span class="st">'bold'</span>),</span>
<span id="cb14-25"><a></a>        <span class="at">plot.subtitle  =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>,<span class="at">face=</span><span class="st">'bold'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="index_files/figure-revealjs/unnamed-chunk-18-1.png" width="1440"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="capm-shortcomings" class="slide level2">
<h2>CAPM shortcomings</h2>
<ul>
<li><p>In our estimation, none of the <span class="math inline">\(\small \alpha\)</span> results were statistically significant, meaning that we cannot reject the hypothesis that <span class="math inline">\(\alpha\)</span> is different from zero</p>
<ol type="1">
<li>In such a way, it implies that investors cannot really earn abnormal returns that are uncorrelated with the market</li>
<li>However, many researchers have found <span class="blue">market anomalies</span> where it was possible to create a strategy that generated positive <span class="math inline">\(\alpha\)</span></li>
</ol></li>
<li><p>It is important to recall some of the model’s shortcomings:</p>
<ol type="1">
<li>Market Returns are really context-dependent, and the use of <em>NYSE/DOW/Ibovespa</em> etc is problem-specific</li>
<li>The sensitivity to market returns, <span class="math inline">\(\small \beta\)</span>, might not be stable over time</li>
<li>Systematic Risk might not be the <span class="blue">only</span> factor that matters!</li>
<li>Assumptions of the CAPM might not be that realistic</li>
</ol></li>
</ul>
</section>
<section id="capm-and-efficient-markets" class="slide level2">
<h2><em>CAPM</em> and Efficient Markets</h2>
<ul>
<li><p>The <em>CAPM</em> model relates to the <em>Efficient Market Hypothesis</em> <span class="citation" data-cites="fama1970">(<a href="#/references" role="doc-biblioref" onclick="">Fama 1970</a>)</span> by providing a framework to determine expected returns based on a single factor: the <span class="blue">systematic risk</span></p></li>
<li><p>Hence, if the <em>Efficient Market Hypothesis</em> holds, CAPM should <span class="green">correctly</span> price all assets:</p>
<ol type="1">
<li>Expected returns depend only on beta, the sensitivity to systematic risk</li>
<li>No other risk factors should systematically predict returns</li>
</ol></li>
</ul>
<div class="fragment">
<p><strong>Question</strong>: if the <em>CAPM</em> does not hold in practice, does that mean that markets are <em>inefficient</em>?</p>
</div>
<div class="fragment">
<ul>
<li><p>It is tempting to argue that if the <em>CAPM</em> <span class="red">fails</span> to account for some market anomalies, it must be that the markets are <span class="blue">not efficient</span> as the model would predict</p></li>
<li><p>Note, however, that this discussion is more nuanced than simply rejecting the <em>Efficient Market Hypothesis</em> altogether</p></li>
</ul>
</div>
</section>
<section id="capm-and-efficient-markets-continued" class="slide level2">
<h2><em>CAPM</em> and Efficient Markets, continued</h2>
<ol type="1">
<li><p>It is tempting to argue that if the <em>CAPM</em> <span class="red">fails</span> to account for some market anomalies, it must be that the markets are <span class="blue">not efficient</span> as the model would predict</p></li>
<li><p>Note, however, that this discussion is more nuanced than simply rejecting the <em>Efficient Market Hypothesis</em> altogether</p></li>
</ol>
<ul>
<li><p>All in all, testing the <em>CAPM</em> is inherently a <span class="blue">joint test</span> of:</p>
<ol type="1">
<li><strong>Market Efficiency</strong> - if the model is correctly specified, there should be no systematic <span class="math inline">\(\alpha&gt;0\)</span></li>
<li><strong>Model Specification</strong> - there is an omitted factor other than the systematic risk that explains excess returns</li>
</ol></li>
<li><p>Therefore, if the <em>CAPM</em> fails empirical tests, it is unclear whether it is because <strong>I)</strong>markets are <span class="blue">inefficient</span>; or <strong>II)</strong> the model is simply <span class="blue">misspecified</span></p></li>
<li><p>Alternative models, such as the <em>Fama-French Three-Factor Model</em> <span class="citation" data-cites="fama1993">(<a href="#/references" role="doc-biblioref" onclick="">Fama and French 1993</a>)</span>, attempt to address these limitations</p></li>
</ul>
</section>
<section id="it-is-now-your-turn" class="slide level2">
<h2>It is now your turn…</h2>
<ul>
<li><p>In our <em>Manipulating Time Series Data</em> lecture, we recreated the at the <a href="https://finance.yahoo.com/news/deadlift-etf-world-latest-headscratcher-140000992.html"><em>Deadlift ETF</em></a> and compared it to the returns from the <em>S&amp;P 500</em> index</p></li>
<li><p>Now, assuming that the <em>CAPM</em> correctly prices all assets, you are equipped to use the model and evaluate whether such strategy yielded <em>true</em> skill returns, or <span class="math inline">\(\small \alpha\)</span></p></li>
</ul>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Hands-on Exercise</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Adapt the code we have used in the <em>Manipulating Time Series Data</em> to generate the <em>weekly</em> returns during 2024 for the <em>Deadlift ETF</em></li>
<li>Merge the dataset with the <em>Fama French</em> dataset you have just used. You can use the <code>left_join</code> function with the <code>by</code> argument to join two dataframes with different column names</li>
<li>Use <code>mutate</code> to create a column that calculates the weekly excess return of the <em>Deadlift ETF</em> relative to the risk-free rate</li>
<li>Estimate an OLS regression of the form:</li>
</ol>
<p><span class="math display">\[
R_{i,t}=\alpha+\beta \times(R_{m,t}-R_{f,t})+\varepsilon_{i,t}
\]</span></p>
<p>How do you interpret these findings? Does investing <em>Deadlift ETF</em> provide true skill returns? Explain your rationale.</p>
</div>
</div>
</div>
</section>
<section id="code-snippet-from-previous-classes" class="slide level2">
<h2>Code snippet from previous classes</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="co"># Set up the list of assets</span></span>
<span id="cb15-2"><a></a>deadlift<span class="ot">=</span><span class="fu">c</span>(<span class="st">'META'</span>,<span class="st">'AMZN'</span>,<span class="st">'GS'</span>,<span class="st">'UBER'</span>,<span class="st">'MSFT'</span>,<span class="st">'AAPL'</span>,<span class="st">'BLK'</span>,<span class="st">'NVDA'</span>)</span>
<span id="cb15-3"><a></a></span>
<span id="cb15-4"><a></a><span class="co">#Set up the starting date</span></span>
<span id="cb15-5"><a></a>start<span class="ot">=</span><span class="st">'2020-01-01'</span></span>
<span id="cb15-6"><a></a>end<span class="ot">=</span><span class="st">'2024-12-31'</span></span>
<span id="cb15-7"><a></a></span>
<span id="cb15-8"><a></a><span class="co">#Step 1: Read the Deadlift data using tidyquant</span></span>
<span id="cb15-9"><a></a>Deadlift_Performance<span class="ot">=</span>deadlift<span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a></a>  <span class="fu">tq_get</span>(<span class="at">from=</span>start,<span class="at">to=</span>end)<span class="sc">%&gt;%</span></span>
<span id="cb15-11"><a></a>  <span class="co">#Select only the columns of interest</span></span>
<span id="cb15-12"><a></a>  <span class="fu">select</span>(symbol,date,adjusted)<span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a></a>  <span class="co">#Group by symbol and date</span></span>
<span id="cb15-14"><a></a>  <span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a></a>  <span class="co">#Use tq_transmute to aggregate and calculate weekly returns</span></span>
<span id="cb15-16"><a></a>  <span class="fu">tq_transmute</span>(<span class="at">selected=</span>adjusted,</span>
<span id="cb15-17"><a></a>               <span class="at">mutate_fun=</span>yearlyReturn,</span>
<span id="cb15-18"><a></a>               <span class="at">col_rename =</span> <span class="st">'Deadlift'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb15-19"><a></a>  <span class="co">#Group by date</span></span>
<span id="cb15-20"><a></a>  <span class="fu">group_by</span>(date)<span class="sc">%&gt;%</span></span>
<span id="cb15-21"><a></a>  <span class="co">#Summarize average return (since it is an equally-weighted portfolio)</span></span>
<span id="cb15-22"><a></a>  <span class="fu">summarize</span>(<span class="at">Deadlift=</span><span class="fu">mean</span>(Deadlift,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb15-23"><a></a></span>
<span id="cb15-24"><a></a><span class="co">#Step 2: Read the S&amp;P 500 data using tidyquant</span></span>
<span id="cb15-25"><a></a>SP500_Performance<span class="ot">=</span><span class="fu">tq_get</span>(<span class="st">'^GSPC'</span>,<span class="at">from=</span>start,<span class="at">to=</span>end)<span class="sc">%&gt;%</span></span>
<span id="cb15-26"><a></a>  <span class="co">#Select only the columns of interest</span></span>
<span id="cb15-27"><a></a>  <span class="fu">select</span>(symbol,date,adjusted)<span class="sc">%&gt;%</span></span>
<span id="cb15-28"><a></a>  <span class="co">#Group by symbol and date</span></span>
<span id="cb15-29"><a></a>  <span class="fu">group_by</span>(symbol)<span class="sc">%&gt;%</span></span>
<span id="cb15-30"><a></a>  <span class="co">#Use tq_transmute to aggregate and calculate weekly returns</span></span>
<span id="cb15-31"><a></a>  <span class="fu">tq_transmute</span>(<span class="at">selected=</span>adjusted,</span>
<span id="cb15-32"><a></a>               <span class="at">mutate_fun=</span>yearlyReturn,</span>
<span id="cb15-33"><a></a>               <span class="at">col_rename =</span> <span class="st">'SP500'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb15-34"><a></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb15-35"><a></a>  <span class="fu">select</span>(<span class="sc">-</span>symbol)</span>
<span id="cb15-36"><a></a>    </span>
<span id="cb15-37"><a></a><span class="co">#Merge</span></span>
<span id="cb15-38"><a></a>SP500_Performance<span class="sc">%&gt;%</span></span>
<span id="cb15-39"><a></a>  <span class="fu">inner_join</span>(Deadlift_Performance)<span class="sc">%&gt;%</span></span>
<span id="cb15-40"><a></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),percent))<span class="sc">%&gt;%</span></span>
<span id="cb15-41"><a></a>  <span class="fu">mutate</span>(<span class="at">date=</span><span class="fu">year</span>(date))<span class="sc">%&gt;%</span></span>
<span id="cb15-42"><a></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'Year'</span>,<span class="st">'S&amp;P 500'</span>,<span class="st">'DeadLift ETF'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<p><img src="Images/logo.jpg" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://lsmacoris.github.io/">@ Website</a> | <a href="https://lsmacoris.github.io/lectures/quant-fin">@ Slides</a> | <a href="https://calendly.com/lucas-macoris-fgv/appointment-lsm">@ Office-hour appointments</a></p>
</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-fama1970" class="csl-entry" role="listitem">
Fama, Eugene F. 1970. <span>“Efficient Capital Markets: A Review of Theory and Empirical Work.”</span> <em>The Journal of Finance</em> 25 (2): 383–417. <a href="https://doi.org/10.2307/2325486">https://doi.org/10.2307/2325486</a>.
</div>
<div id="ref-fama1993" class="csl-entry" role="listitem">
Fama, Eugene F., and Kenneth R. French. 1993. <span>“Common Risk Factors in the Returns on Stocks and Bonds.”</span> <em>Journal of Financial Economics</em> 33 (1): 3–56.
</div>
<div id="ref-Markowitz" class="csl-entry" role="listitem">
Markowitz, Harry. 1952. <span>“Portfolio Selection.”</span> <em>The Journal of Finance</em> 7 (1): 77–91. <a href="http://www.jstor.org/stable/2975974">http://www.jstor.org/stable/2975974</a>.
</div>
<div id="ref-tidyfinance" class="csl-entry" role="listitem">
Scheuch, Christoph, Stefan Voigt, and Patrick Weiss. 2023. <em>Tidy Finance with <span>R</span></em>. Chapman &amp; Hall/CRC. <a href="https://www.tidy-finance.org/r/">https://www.tidy-finance.org/r/</a>.
</div>
<div id="ref-r4ds" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Cetinkaya-Rundel, and Garrett Grolemund. 2023. <em><span>R</span> for Data Science</em>. O’Reilly Media. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.
</div>
</div>
</section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/lsmacoris\.github\.io\/lectures");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>