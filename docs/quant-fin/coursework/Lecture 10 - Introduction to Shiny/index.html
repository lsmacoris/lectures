<!DOCTYPE html>
<html lang="en"><head>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.55">

  <meta name="author" content="Lucas S. Macoris (FGV-EAESP)">
  <title>Lucas S. Macoris – Introduction to Shiny</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="../../../site_libs/revealjs/dist/theme/quarto.css">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-87FLN5SXEJ"></script>

  <script type="text/javascript">

  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-87FLN5SXEJ', { 'anonymize_ip': true});
  </script>
  <link href="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Introduction to Shiny</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Lucas S. Macoris (FGV-EAESP) 
</div>
</div>
</div>

</section>
<section id="outline" class="slide level2">
<h2>Outline</h2>
<ul>
<li>This lecture is mainly based the following textbooks:
<ol type="1">
<li><em>Mastering Shiny</em> <span class="citation" data-cites="shiny">(<a href="#/references" role="doc-biblioref" onclick="">Wickham 2021</a>)</span></li>
<li><em>R for Data Science</em> <span class="citation" data-cites="r4ds">(<a href="#/references" role="doc-biblioref" onclick="">Wickham, Mine Cetinkaya-Rundel, and Grolemund 2023</a>)</span></li>
</ol></li>
</ul>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Coding Replications</strong></p>
</div>
<div class="callout-content">
<p>For coding replications, whenever applicable, please follow <a href="https://lsmacoris.github.io/lectures/quant-fin.html">this</a> page or hover on the specific slides with containing coding chunks.</p>
<ol type="1">
<li>Ensure that you have your <span class="blue"><i class="fa-brands fa-r-project" aria-label="r-project"></i></span> session properly set-up according to the instructions outlined in the course webpage</li>
<li>In the webpage, you can also find a detailed discussion of the examples covered in this lecture</li>
</ol>
</div>
</div>
</div>
</section>
<section id="disclaimer" class="slide level2">
<h2>Disclaimer</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Disclaimer</strong></p>
</div>
<div class="callout-content">
<p>The information presented in this lecture is for educational and informational purposes only and should not be construed as investment advice. Nothing discussed constitutes a recommendation to buy, sell, or hold any financial instrument or security. Investment decisions should be made based on individual research and consultation with a qualified financial professional. The presenter assumes no responsibility for any financial decisions made based on this content.</p>
<p>All code used in this lecture is publicly available and is also shared on my <a href="https://github.com/lsmacoris">GitHub</a> page. Participants are encouraged to review, modify, and use the code for their own learning and research purposes. However, no guarantees are made regarding the accuracy, completeness, or suitability of the code for any specific application.</p>
<p>For any questions or concerns, please feel free to reach out via email at <a href="mailto:lucas.macoris@fgv.br">lucas.macoris@fgv.br</a></p>
</div>
</div>
</div>
</section>
<section id="what-else" class="slide level2">
<h2>What else?</h2>
<ul>
<li>During this semester, you have been exposed to a series of practical applications in topics related to finance:
<ol type="1">
<li>Collecting and manipulating data</li>
<li>Backtesting Investment Strategies</li>
<li>Evaluating Mutual Fund performance</li>
<li>Stress-testing Equity Valuation Models</li>
<li>Analyzing M&amp;A announcements and marketing sentiment around news</li>
</ol></li>
</ul>
<p><strong>What’s left for us to do?</strong></p>
<p><em>It is time to ship your insights to a broader audience - I introduce you <span class="blue">Shiny</span>!</em></p>
</section>
<section id="introduction-to-shiny" class="slide level2">
<h2>Introduction to Shiny</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Definition</strong></p>
</div>
<div class="callout-content">
<p><a href="https://shiny.posit.co/">Shiny</a> is an <code>R</code> package that makes it easy to build interactive web applications directly from your session. It was developed by <a href="https://posit.co/">Posit</a> (previously <em>RStudio</em>) to bridge the gap between data analysis and web interfaces.</p>
</div>
</div>
</div>
<ul>
<li><p>It allows for real-time data visualization and analysis using a web browser, updating outputs <em>automatically</em> when inputs change</p></li>
<li><p>Recently, its usage has been extended to <code>Python</code> users, offering similar reactive programming</p></li>
</ul>
<div class="fragment">
<p><strong>Key Features</strong></p>
<ol type="1">
<li><p>Easy integration with <code>ggplot2</code>, <code>dplyr</code>, and other <code>tidyverse</code> tools, with customizable UI layouts using built-in layout functions, or plain <code>HTML</code> and <code>CSS</code></p></li>
<li><p>Supports user input through sliders, dropdowns, buttons, and more</p></li>
<li><p>Easy to <em>deploy</em>, <em>host</em>, and <em>ship</em> your application to the internet!</p></li>
</ol>
</div>
</section>
<section id="typical-use-cases" class="slide level2">
<h2>Typical Use Cases</h2>
<div class="fragment">
<p><span class="blue"><strong>Shiny</strong></span> <strong>can be used in a variety of contexts, including but not limited to:</strong></p>
</div>
<div class="fragment">
<ol type="1">
<li><p><span class="blue">Interactive Dashboards and Reports</span>: whether you have inputs that change over time, or need, <span class="blue">Shiny</span> can leverage user interaction by asking inputs and also providing interactivity, such as downloading results</p></li>
<li><p><span class="blue">Prototyping Data Science products</span>: creating a <em>minimum-viable-product</em> using Shiny is one way of testing an idea before allocating a substantial amount of resources into it. Shiny Apps are simple yet powerful, and can be customized using the best resources on <code>HTML</code>, <code>JavaScript</code>, and <code>CSS</code></p></li>
<li><p><span class="blue">Tools for non-technical stakeholders</span>: <span class="blue">Shiny</span> helps to bridge the gap between <code>R</code> and <code>Python</code> users with non-technical audiences, allowing different agents to draw insights from the data without the need for extensive coding</p></li>
</ol>
</div>
</section>
<section id="example-1-a-geographical-deep-dive-through-the-u.s" class="slide level2">
<h2>Example #1: a geographical deep-dive through the U.S</h2>
<iframe src="https://gallery.shinyapps.io/063-superzip-example/" width="100%" height="800" frameborder="0">
</iframe>
</section>
<section id="example-2-a-historical-movie-explorer" class="slide level2">
<h2>Example #2: a historical movie explorer</h2>
<iframe src="https://gallery.shinyapps.io/051-movie-explorer/" width="100%" height="800" frameborder="0">
</iframe>
</section>
<section id="example-3-a-momentum-based-backtester" class="slide level2">
<h2>Example #3: a momentum-based backtester</h2>
<iframe src="https://brindexes.shinyapps.io/backtester-app/" width="100%" height="800" frameborder="0">
</iframe>
</section>
<section id="shiny-app-structure-getting-started" class="slide level2">
<h2>Shiny App Structure (getting started)</h2>
<ul>
<li><p>A general purpose <span class="blue">Shiny</span> app has the following structure:</p>
<ol type="1">
<li>The <code>ui</code>: defines the layout and appearance of the app (<em>i.e</em>, the <em>frontend</em>)</li>
<li>The <code>server</code>: Defines the logic and behavior of the app (<em>i.e</em>, the <em>backend</em>)</li>
<li>Finally, the <code>shinyApp</code> function creates app objects from an explicit UI/server pair:</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>This function uses the <code>ui</code> and <code>server</code> definition and launches a local app in your browser for quick visualization and troubleshooting</li>
</ul>
<p><strong>How it works</strong></p>
<ul>
<li><p>Every <span class="blue">Shiny</span> app has the same structure: an <code>app.R</code> file that contains <code>ui</code> and <code>server</code></p></li>
<li><p>You can create a <span class="blue">Shiny</span> app by making a new directory and saving an <code>app.R</code> file inside it. It is recommended that each app will live in its own unique directory</p></li>
</ul>
</section>
<section id="my-very-first-app" class="slide level2">
<h2>My very first app</h2>
<iframe src="https://gallery.shinyapps.io/001-hello/" width="100%" height="800" frameborder="0">
</iframe>
</section>
<section id="a-minimal-working-example-in-finance" class="slide level2">
<h2>A minimal working example (in finance)</h2>
<ul>
<li>You boss got impressed with the analysis you did as a buy-side analyst at <em>Pierpoint Capital</em>. Unfortunately, he did not take the <em>Practical Applications in Quantitative Finance</em> course, so he really can’t replicate your findings. Your task is to help him ship your analysis to the whole organization</li>
</ul>
<ol type="1">
<li>Create stunning visuals that allow interactivity</li>
<li>Allow users to change parameters of your analysis</li>
<li>Finally, provide users with the ability to download their findings</li>
</ol>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Specific Instructions</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li><p>We will be extensively using several contents from <span class="citation" data-cites="shiny">(<a href="#/references" role="doc-biblioref" onclick="">Wickham 2021</a>)</span>. For the sake of brevity, we will not dive into the nitty-gritty details, but rather explore some functions that can be used within a <span class="blue">Shiny</span> context</p></li>
<li><p>We will leverage <a href="https://gallery.shinyapps.io/assistant/">ShinyAI</a>, an <em>LLM</em> specifically desined to help developing a web framework for data driven apps. You can ask questions about how to use Shiny, to explain how certain things work, or even ask to build a Shiny app for you.</p></li>
</ol>
</div>
</div>
</div>
</section>
<section id="my-first-shiny-app" class="slide level2">
<h2>My first Shiny app</h2>
<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Outline</a></li><li><a href="#tabset-1-2">Prompt</a></li><li><a href="#tabset-1-3">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<ul>
<li><p>In what follows, we will begin by creating a very simply app that provides a summary performance of selected stocks over time, constructed using the following <em>UI/UX</em> structure:</p>
<ol type="1">
<li><p>Users provide a <em>start</em> and <em>end</em> date for the analysis of the <em>Magnificent 7</em> stocks</p></li>
<li><p>The expected outcome should be a chart that compares the cumulative returns of all selected assets over time</p></li>
</ol></li>
<li><p>Each section will contain <span class="blue">three</span> tabs:</p>
<ol type="1">
<li><p>The <span class="blue">Outline</span> section will provide a very quick explanation of what we need to add to the app</p></li>
<li><p>The <span class="blue">Prompt</span> section describes what we will be asking <em>ShinyAI</em> to help us with - as expected, this should be a trial-and-error process between prompts</p></li>
<li><p>Finally, the <span class="blue">Code</span> section will contain the updated code generated by <em>ShinyAI</em>, which can be fed into your <code>R</code> section</p></li>
</ol></li>
</ul>
</div>
<div id="tabset-1-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a>Create a Shiny app that visualizes the cumulative returns of the <span class="st">'Magnificent 7'</span> tech <span class="fu">stocks</span> (Apple, Microsoft, Amazon, NVIDIA, Alphabet<span class="sc">/</span>Google, Meta<span class="sc">/</span>Facebook, and Tesla). The app should have the following features<span class="sc">:</span></span>
<span id="cb2-2"><a></a></span>
<span id="cb2-3"><a></a>The only user input should be a date range selector <span class="cf">in</span> the sidebar, with a default range of the past year and a minimum selectable date of January <span class="dv">1</span>, <span class="dv">2015</span></span>
<span id="cb2-4"><a></a></span>
<span id="cb2-5"><a></a>Display a line chart showing the cumulative returns of all Magnificent <span class="dv">7</span> stocks over the selected time period, with company names shown <span class="cf">in</span> the legend instead of ticker symbols</span>
<span id="cb2-6"><a></a></span>
<span id="cb2-7"><a></a>Include a data table below the chart that summarizes key performance metrics <span class="cf">for</span> each stock<span class="sc">:</span> company name, start date, end date, total return, annualized return, and volatility</span>
<span id="cb2-8"><a></a></span>
<span id="cb2-9"><a></a>Use the tidyquant package to download stock price data from Yahoo Finance and calculate the returns</span>
<span id="cb2-10"><a></a></span>
<span id="cb2-11"><a></a>Use the tidyverse <span class="cf">for</span> data manipulation and ggplot2 <span class="cf">for</span> visualization</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb3-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-3"><a></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb3-4"><a></a><span class="fu">library</span>(bslib)</span>
<span id="cb3-5"><a></a><span class="fu">library</span>(scales)</span>
<span id="cb3-6"><a></a></span>
<span id="cb3-7"><a></a><span class="co"># Define the Magnificent 7 stocks</span></span>
<span id="cb3-8"><a></a>magnificent_7 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-9"><a></a>  <span class="st">"AAPL"</span>, <span class="co"># Apple</span></span>
<span id="cb3-10"><a></a>  <span class="st">"MSFT"</span>, <span class="co"># Microsoft</span></span>
<span id="cb3-11"><a></a>  <span class="st">"AMZN"</span>, <span class="co"># Amazon</span></span>
<span id="cb3-12"><a></a>  <span class="st">"NVDA"</span>, <span class="co"># NVIDIA</span></span>
<span id="cb3-13"><a></a>  <span class="st">"GOOGL"</span>, <span class="co"># Alphabet (Google)</span></span>
<span id="cb3-14"><a></a>  <span class="st">"META"</span>, <span class="co"># Meta (Facebook)</span></span>
<span id="cb3-15"><a></a>  <span class="st">"TSLA"</span>  <span class="co"># Tesla</span></span>
<span id="cb3-16"><a></a>)</span>
<span id="cb3-17"><a></a></span>
<span id="cb3-18"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb3-19"><a></a>  <span class="at">title =</span> <span class="st">"Magnificent 7 Return Comparison"</span>,</span>
<span id="cb3-20"><a></a>  </span>
<span id="cb3-21"><a></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb3-22"><a></a>    <span class="at">title =</span> <span class="st">"Date Range"</span>,</span>
<span id="cb3-23"><a></a>    </span>
<span id="cb3-24"><a></a>    <span class="fu">dateRangeInput</span>(</span>
<span id="cb3-25"><a></a>      <span class="st">"date_range"</span>,</span>
<span id="cb3-26"><a></a>      <span class="st">"Select date range:"</span>,</span>
<span id="cb3-27"><a></a>      <span class="at">start =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">365</span>,</span>
<span id="cb3-28"><a></a>      <span class="at">end =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb3-29"><a></a>      <span class="at">min =</span> <span class="st">"2015-01-01"</span>,</span>
<span id="cb3-30"><a></a>      <span class="at">max =</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb3-31"><a></a>    )</span>
<span id="cb3-32"><a></a>  ),</span>
<span id="cb3-33"><a></a>  </span>
<span id="cb3-34"><a></a>  <span class="fu">card</span>(</span>
<span id="cb3-35"><a></a>    <span class="at">full_screen =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-36"><a></a>    <span class="fu">card_header</span>(<span class="st">"Cumulative Returns of Magnificent 7 Stocks"</span>),</span>
<span id="cb3-37"><a></a>    <span class="fu">plotOutput</span>(<span class="st">"returns_plot"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb3-38"><a></a>  ),</span>
<span id="cb3-39"><a></a>  </span>
<span id="cb3-40"><a></a>  <span class="fu">card</span>(</span>
<span id="cb3-41"><a></a>    <span class="fu">card_header</span>(<span class="st">"Performance Summary"</span>),</span>
<span id="cb3-42"><a></a>    <span class="fu">dataTableOutput</span>(<span class="st">"data_summary"</span>)</span>
<span id="cb3-43"><a></a>  )</span>
<span id="cb3-44"><a></a>)</span>
<span id="cb3-45"><a></a></span>
<span id="cb3-46"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb3-47"><a></a>  </span>
<span id="cb3-48"><a></a>  <span class="co"># Reactive expression to get and process stock data</span></span>
<span id="cb3-49"><a></a>  stock_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb3-50"><a></a>    <span class="co"># Validate that we have dates</span></span>
<span id="cb3-51"><a></a>    <span class="fu">req</span>(input<span class="sc">$</span>date_range)</span>
<span id="cb3-52"><a></a>    </span>
<span id="cb3-53"><a></a>      <span class="co"># Download data</span></span>
<span id="cb3-54"><a></a>      tq_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(</span>
<span id="cb3-55"><a></a>        magnificent_7,</span>
<span id="cb3-56"><a></a>        <span class="at">from =</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>],</span>
<span id="cb3-57"><a></a>        <span class="at">to =</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>],</span>
<span id="cb3-58"><a></a>        <span class="at">get =</span> <span class="st">"stock.prices"</span></span>
<span id="cb3-59"><a></a>      )</span>
<span id="cb3-60"><a></a>      </span>
<span id="cb3-61"><a></a>      <span class="co"># Check if we got data</span></span>
<span id="cb3-62"><a></a>      <span class="fu">req</span>(<span class="fu">nrow</span>(tq_data) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb3-63"><a></a>      </span>
<span id="cb3-64"><a></a>      <span class="co"># Calculate daily returns</span></span>
<span id="cb3-65"><a></a>      returns_data <span class="ot">&lt;-</span> tq_data <span class="sc">%&gt;%</span></span>
<span id="cb3-66"><a></a>        <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb3-67"><a></a>        <span class="fu">tq_transmute</span>(</span>
<span id="cb3-68"><a></a>          <span class="at">select =</span> adjusted,</span>
<span id="cb3-69"><a></a>          <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb3-70"><a></a>          <span class="at">period =</span> <span class="st">"daily"</span>,</span>
<span id="cb3-71"><a></a>          <span class="at">col_rename =</span> <span class="st">"daily_return"</span></span>
<span id="cb3-72"><a></a>        )</span>
<span id="cb3-73"><a></a>      </span>
<span id="cb3-74"><a></a>      <span class="co"># Calculate cumulative returns</span></span>
<span id="cb3-75"><a></a>      cum_returns <span class="ot">&lt;-</span> returns_data <span class="sc">%&gt;%</span></span>
<span id="cb3-76"><a></a>        <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb3-77"><a></a>        <span class="fu">mutate</span>(<span class="at">cumulative_return =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-78"><a></a>        <span class="fu">ungroup</span>()</span>
<span id="cb3-79"><a></a>      </span>
<span id="cb3-80"><a></a>      <span class="fu">list</span>(</span>
<span id="cb3-81"><a></a>        <span class="at">raw_data =</span> tq_data,</span>
<span id="cb3-82"><a></a>        <span class="at">cum_returns =</span> cum_returns</span>
<span id="cb3-83"><a></a>      )</span>
<span id="cb3-84"><a></a>    })</span>
<span id="cb3-85"><a></a></span>
<span id="cb3-86"><a></a>  <span class="co"># Generate returns plot</span></span>
<span id="cb3-87"><a></a>  output<span class="sc">$</span>returns_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb3-88"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb3-89"><a></a>    </span>
<span id="cb3-90"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb3-91"><a></a>    </span>
<span id="cb3-92"><a></a>    <span class="co"># Create a named vector for better labels</span></span>
<span id="cb3-93"><a></a>    stock_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-94"><a></a>      <span class="st">"AAPL"</span> <span class="ot">=</span> <span class="st">"Apple"</span>,</span>
<span id="cb3-95"><a></a>      <span class="st">"MSFT"</span> <span class="ot">=</span> <span class="st">"Microsoft"</span>,</span>
<span id="cb3-96"><a></a>      <span class="st">"AMZN"</span> <span class="ot">=</span> <span class="st">"Amazon"</span>,</span>
<span id="cb3-97"><a></a>      <span class="st">"NVDA"</span> <span class="ot">=</span> <span class="st">"NVIDIA"</span>,</span>
<span id="cb3-98"><a></a>      <span class="st">"GOOGL"</span> <span class="ot">=</span> <span class="st">"Alphabet"</span>,</span>
<span id="cb3-99"><a></a>      <span class="st">"META"</span> <span class="ot">=</span> <span class="st">"Meta"</span>,</span>
<span id="cb3-100"><a></a>      <span class="st">"TSLA"</span> <span class="ot">=</span> <span class="st">"Tesla"</span></span>
<span id="cb3-101"><a></a>    )</span>
<span id="cb3-102"><a></a>    </span>
<span id="cb3-103"><a></a>    <span class="fu">ggplot</span>(cum_returns, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> cumulative_return, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb3-104"><a></a>      <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-105"><a></a>      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent) <span class="sc">+</span></span>
<span id="cb3-106"><a></a>      <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> stock_names) <span class="sc">+</span></span>
<span id="cb3-107"><a></a>      <span class="fu">labs</span>(</span>
<span id="cb3-108"><a></a>        <span class="at">title =</span> <span class="st">"Cumulative Returns of Magnificent 7 Tech Stocks"</span>,</span>
<span id="cb3-109"><a></a>        <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb3-110"><a></a>        <span class="at">y =</span> <span class="st">"Cumulative Return"</span>,</span>
<span id="cb3-111"><a></a>        <span class="at">color =</span> <span class="st">"Company"</span></span>
<span id="cb3-112"><a></a>      ) <span class="sc">+</span></span>
<span id="cb3-113"><a></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-114"><a></a>      <span class="fu">theme</span>(</span>
<span id="cb3-115"><a></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb3-116"><a></a>        <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb3-117"><a></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb3-118"><a></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb3-119"><a></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb3-120"><a></a>      )</span>
<span id="cb3-121"><a></a>  })</span>
<span id="cb3-122"><a></a>  </span>
<span id="cb3-123"><a></a>  <span class="co"># Generate data summary</span></span>
<span id="cb3-124"><a></a>  output<span class="sc">$</span>data_summary <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb3-125"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb3-126"><a></a>    </span>
<span id="cb3-127"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb3-128"><a></a>    </span>
<span id="cb3-129"><a></a>    <span class="co"># Stock display names for the summary table</span></span>
<span id="cb3-130"><a></a>    stock_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-131"><a></a>      <span class="st">"AAPL"</span> <span class="ot">=</span> <span class="st">"Apple"</span>,</span>
<span id="cb3-132"><a></a>      <span class="st">"MSFT"</span> <span class="ot">=</span> <span class="st">"Microsoft"</span>,</span>
<span id="cb3-133"><a></a>      <span class="st">"AMZN"</span> <span class="ot">=</span> <span class="st">"Amazon"</span>,</span>
<span id="cb3-134"><a></a>      <span class="st">"NVDA"</span> <span class="ot">=</span> <span class="st">"NVIDIA"</span>,</span>
<span id="cb3-135"><a></a>      <span class="st">"GOOGL"</span> <span class="ot">=</span> <span class="st">"Alphabet"</span>,</span>
<span id="cb3-136"><a></a>      <span class="st">"META"</span> <span class="ot">=</span> <span class="st">"Meta"</span>,</span>
<span id="cb3-137"><a></a>      <span class="st">"TSLA"</span> <span class="ot">=</span> <span class="st">"Tesla"</span></span>
<span id="cb3-138"><a></a>    )</span>
<span id="cb3-139"><a></a>    </span>
<span id="cb3-140"><a></a>    <span class="co"># Summary statistics for each asset</span></span>
<span id="cb3-141"><a></a>    summary_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb3-142"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb3-143"><a></a>      <span class="fu">summarize</span>(</span>
<span id="cb3-144"><a></a>        <span class="at">Start_Date =</span> <span class="fu">min</span>(date),</span>
<span id="cb3-145"><a></a>        <span class="at">End_Date =</span> <span class="fu">max</span>(date),</span>
<span id="cb3-146"><a></a>        <span class="at">Total_Return =</span> <span class="fu">last</span>(cumulative_return) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb3-147"><a></a>        <span class="at">Annualized_Return =</span> ((<span class="dv">1</span> <span class="sc">+</span> <span class="fu">last</span>(cumulative_return))<span class="sc">^</span>(<span class="dv">252</span> <span class="sc">/</span> <span class="fu">n</span>())) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb3-148"><a></a>        <span class="at">Volatility =</span> <span class="fu">sd</span>(daily_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb3-149"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb3-150"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb3-151"><a></a>        <span class="at">Company =</span> stock_names[symbol],</span>
<span id="cb3-152"><a></a>        <span class="at">Total_Return =</span> <span class="fu">percent</span>(Total_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb3-153"><a></a>        <span class="at">Annualized_Return =</span> <span class="fu">percent</span>(Annualized_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb3-154"><a></a>        <span class="at">Volatility =</span> <span class="fu">percent</span>(Volatility, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb3-155"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb3-156"><a></a>      <span class="fu">select</span>(Company, Start_Date, End_Date, Total_Return, Annualized_Return, Volatility)</span>
<span id="cb3-157"><a></a>  })</span>
<span id="cb3-158"><a></a>}</span>
<span id="cb3-159"><a></a></span>
<span id="cb3-160"><a></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="adding-a-stock-selector" class="slide level2">
<h2>#1: Adding a stock selector</h2>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Outline</a></li><li><a href="#tabset-2-2">Prompt</a></li><li><a href="#tabset-2-3">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<ul>
<li>You are off to a good start - however, there are some important points to consider:</li>
</ul>
<ol type="1">
<li>Users may want to select stocks <em>other</em> than the <em>Magnificent Seven</em></li>
<li>Notwithstanding, asking users to write down the list of assets is too cumbersome, let alone the fact that this is highly prone to human error</li>
<li>Because of that, you could ask them to select from a predefined drop-down list that contains a list of valid tickers</li>
</ol>
<ul>
<li>In what follows, we will add a drop-down menu that contains all <em>S&amp;P</em> ticker constituents that can be retrieved from the <code>tq_index</code> function, allowing users to select the set of stocks that will be part of the analysis</li>
</ul>
</div>
<div id="tabset-2-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>This is great<span class="sc">!</span> Now, I need to add a stock selector. Use the <span class="fu">tq_index</span>() <span class="cf">function</span> to retrieve all tickers from S<span class="sc">&amp;</span>P500. Add the following structure to the app<span class="sc">:</span></span>
<span id="cb4-2"><a></a></span>
<span id="cb4-3"><a></a><span class="fl">1.</span> Remove the Magnificent Seven. The default selector should have zero stocks.</span>
<span id="cb4-4"><a></a><span class="fl">2.</span> Add a drop<span class="sc">-</span>down menu with all the stocks from the <span class="st">`</span><span class="at">tq_index('SP500')</span><span class="st">`</span> function. Allow <span class="cf">for</span> a <span class="st">"Select All"</span> button.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb5-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb5-4"><a></a><span class="fu">library</span>(bslib)</span>
<span id="cb5-5"><a></a><span class="fu">library</span>(scales)</span>
<span id="cb5-6"><a></a><span class="fu">library</span>(shinyWidgets) <span class="co"># Added for pickerInput</span></span>
<span id="cb5-7"><a></a></span>
<span id="cb5-8"><a></a><span class="co"># Get S&amp;P 500 tickers and industry information</span></span>
<span id="cb5-9"><a></a>sp500_stocks <span class="ot">&lt;-</span> <span class="fu">tq_index</span>(<span class="st">"SP500"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a></a>  <span class="fu">select</span>(symbol, company, sector) <span class="sc">%&gt;%</span></span>
<span id="cb5-11"><a></a>  <span class="fu">arrange</span>(sector, company)</span>
<span id="cb5-12"><a></a></span>
<span id="cb5-13"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb5-14"><a></a>  <span class="at">title =</span> <span class="st">"S&amp;P 500 Return Comparison"</span>,</span>
<span id="cb5-15"><a></a>  </span>
<span id="cb5-16"><a></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb5-17"><a></a>    <span class="at">title =</span> <span class="st">"Settings"</span>,</span>
<span id="cb5-18"><a></a>    </span>
<span id="cb5-19"><a></a>    <span class="fu">dateRangeInput</span>(</span>
<span id="cb5-20"><a></a>      <span class="st">"date_range"</span>,</span>
<span id="cb5-21"><a></a>      <span class="st">"Select date range:"</span>,</span>
<span id="cb5-22"><a></a>      <span class="at">start =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">365</span>,</span>
<span id="cb5-23"><a></a>      <span class="at">end =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb5-24"><a></a>      <span class="at">min =</span> <span class="st">"2015-01-01"</span>,</span>
<span id="cb5-25"><a></a>      <span class="at">max =</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb5-26"><a></a>    ),</span>
<span id="cb5-27"><a></a>    </span>
<span id="cb5-28"><a></a>    <span class="fu">hr</span>(),</span>
<span id="cb5-29"><a></a>    </span>
<span id="cb5-30"><a></a>    <span class="co"># Stock selector with search functionality</span></span>
<span id="cb5-31"><a></a>    <span class="fu">pickerInput</span>(</span>
<span id="cb5-32"><a></a>      <span class="at">inputId =</span> <span class="st">"stock_selector"</span>,</span>
<span id="cb5-33"><a></a>      <span class="at">label =</span> <span class="st">"Select Stocks:"</span>,</span>
<span id="cb5-34"><a></a>      <span class="at">choices =</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>symbol, <span class="fu">paste0</span>(sp500_stocks<span class="sc">$</span>symbol, <span class="st">" - "</span>, sp500_stocks<span class="sc">$</span>company)),</span>
<span id="cb5-35"><a></a>      <span class="at">selected =</span> <span class="cn">NULL</span>, <span class="co"># Default to no selection</span></span>
<span id="cb5-36"><a></a>      <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-37"><a></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb5-38"><a></a>        <span class="st">`</span><span class="at">actions-box</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-39"><a></a>        <span class="st">`</span><span class="at">live-search</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-40"><a></a>        <span class="st">`</span><span class="at">selected-text-format</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"count &gt; 3"</span>,</span>
<span id="cb5-41"><a></a>        <span class="st">`</span><span class="at">count-selected-text</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"{0} stocks selected"</span></span>
<span id="cb5-42"><a></a>      )</span>
<span id="cb5-43"><a></a>    )</span>
<span id="cb5-44"><a></a>  ),</span>
<span id="cb5-45"><a></a>  </span>
<span id="cb5-46"><a></a>  <span class="fu">card</span>(</span>
<span id="cb5-47"><a></a>    <span class="at">full_screen =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-48"><a></a>    <span class="fu">card_header</span>(<span class="st">"Cumulative Returns Comparison"</span>),</span>
<span id="cb5-49"><a></a>    <span class="fu">plotOutput</span>(<span class="st">"returns_plot"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb5-50"><a></a>  ),</span>
<span id="cb5-51"><a></a>  </span>
<span id="cb5-52"><a></a>  <span class="fu">card</span>(</span>
<span id="cb5-53"><a></a>    <span class="fu">card_header</span>(<span class="st">"Performance Summary"</span>),</span>
<span id="cb5-54"><a></a>    <span class="fu">dataTableOutput</span>(<span class="st">"data_summary"</span>)</span>
<span id="cb5-55"><a></a>  )</span>
<span id="cb5-56"><a></a>)</span>
<span id="cb5-57"><a></a></span>
<span id="cb5-58"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb5-59"><a></a>  </span>
<span id="cb5-60"><a></a>  <span class="co"># Reactive to store current stock selection</span></span>
<span id="cb5-61"><a></a>  selected_stocks <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="cn">NULL</span>) <span class="co"># Start with no stocks selected</span></span>
<span id="cb5-62"><a></a>  </span>
<span id="cb5-63"><a></a>  <span class="co"># Update selected_stocks when stock_selector changes</span></span>
<span id="cb5-64"><a></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>stock_selector, {</span>
<span id="cb5-65"><a></a>    <span class="fu">selected_stocks</span>(input<span class="sc">$</span>stock_selector)</span>
<span id="cb5-66"><a></a>  })</span>
<span id="cb5-67"><a></a>  </span>
<span id="cb5-68"><a></a>  <span class="co"># Get full list of stocks to retrieve</span></span>
<span id="cb5-69"><a></a>  stocks_to_get <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-70"><a></a>    stocks <span class="ot">&lt;-</span> <span class="fu">selected_stocks</span>()</span>
<span id="cb5-71"><a></a>    </span>
<span id="cb5-72"><a></a>    <span class="co"># Ensure we have at least one stock to display</span></span>
<span id="cb5-73"><a></a>    <span class="cf">if</span> (<span class="fu">length</span>(stocks) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-74"><a></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb5-75"><a></a>    }</span>
<span id="cb5-76"><a></a>    </span>
<span id="cb5-77"><a></a>    <span class="fu">return</span>(stocks)</span>
<span id="cb5-78"><a></a>  })</span>
<span id="cb5-79"><a></a>  </span>
<span id="cb5-80"><a></a>  <span class="co"># Reactive expression to get and process stock data</span></span>
<span id="cb5-81"><a></a>  stock_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-82"><a></a>    <span class="co"># Validate that we have dates and stocks</span></span>
<span id="cb5-83"><a></a>    <span class="fu">req</span>(input<span class="sc">$</span>date_range)</span>
<span id="cb5-84"><a></a>    <span class="fu">req</span>(<span class="fu">length</span>(<span class="fu">stocks_to_get</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-85"><a></a>    </span>
<span id="cb5-86"><a></a>    <span class="co"># Download data</span></span>
<span id="cb5-87"><a></a>    tq_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(</span>
<span id="cb5-88"><a></a>      <span class="fu">stocks_to_get</span>(),</span>
<span id="cb5-89"><a></a>      <span class="at">from =</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>],</span>
<span id="cb5-90"><a></a>      <span class="at">to =</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>],</span>
<span id="cb5-91"><a></a>      <span class="at">get =</span> <span class="st">"stock.prices"</span></span>
<span id="cb5-92"><a></a>    )</span>
<span id="cb5-93"><a></a>    </span>
<span id="cb5-94"><a></a>    <span class="co"># Check if we got data</span></span>
<span id="cb5-95"><a></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(tq_data) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-96"><a></a>    </span>
<span id="cb5-97"><a></a>    <span class="co"># Calculate daily returns</span></span>
<span id="cb5-98"><a></a>    returns_data <span class="ot">&lt;-</span> tq_data <span class="sc">%&gt;%</span></span>
<span id="cb5-99"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb5-100"><a></a>      <span class="fu">tq_transmute</span>(</span>
<span id="cb5-101"><a></a>        <span class="at">select =</span> adjusted,</span>
<span id="cb5-102"><a></a>        <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb5-103"><a></a>        <span class="at">period =</span> <span class="st">"daily"</span>,</span>
<span id="cb5-104"><a></a>        <span class="at">col_rename =</span> <span class="st">"daily_return"</span></span>
<span id="cb5-105"><a></a>      )</span>
<span id="cb5-106"><a></a>    </span>
<span id="cb5-107"><a></a>    <span class="co"># Calculate cumulative returns</span></span>
<span id="cb5-108"><a></a>    cum_returns <span class="ot">&lt;-</span> returns_data <span class="sc">%&gt;%</span></span>
<span id="cb5-109"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb5-110"><a></a>      <span class="fu">mutate</span>(<span class="at">cumulative_return =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-111"><a></a>      <span class="fu">ungroup</span>()</span>
<span id="cb5-112"><a></a>    </span>
<span id="cb5-113"><a></a>    <span class="fu">list</span>(</span>
<span id="cb5-114"><a></a>      <span class="at">raw_data =</span> tq_data,</span>
<span id="cb5-115"><a></a>      <span class="at">cum_returns =</span> cum_returns</span>
<span id="cb5-116"><a></a>    )</span>
<span id="cb5-117"><a></a>  })</span>
<span id="cb5-118"><a></a>  </span>
<span id="cb5-119"><a></a>  <span class="co"># Get company names for better labels</span></span>
<span id="cb5-120"><a></a>  stock_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb5-121"><a></a>    </span>
<span id="cb5-122"><a></a>    <span class="co"># Create lookup from sp500 stocks</span></span>
<span id="cb5-123"><a></a>    name_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>company, sp500_stocks<span class="sc">$</span>symbol)</span>
<span id="cb5-124"><a></a>    </span>
<span id="cb5-125"><a></a>  })</span>
<span id="cb5-126"><a></a>  </span>
<span id="cb5-127"><a></a>  <span class="co"># Generate returns plot</span></span>
<span id="cb5-128"><a></a>  output<span class="sc">$</span>returns_plot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb5-129"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb5-130"><a></a>    </span>
<span id="cb5-131"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb5-132"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb5-133"><a></a>    </span>
<span id="cb5-134"><a></a>    <span class="co"># Limit the number of stocks shown for better visualization</span></span>
<span id="cb5-135"><a></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(cum_returns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb5-136"><a></a>      <span class="fu">ggplot</span>(cum_returns, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> cumulative_return, <span class="at">color =</span> symbol)) <span class="sc">+</span></span>
<span id="cb5-137"><a></a>        <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-138"><a></a>        <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent) <span class="sc">+</span></span>
<span id="cb5-139"><a></a>        <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), names_lookup[x], x)) <span class="sc">+</span></span>
<span id="cb5-140"><a></a>        <span class="fu">labs</span>(</span>
<span id="cb5-141"><a></a>          <span class="at">title =</span> <span class="st">"Cumulative Returns Comparison"</span>,</span>
<span id="cb5-142"><a></a>          <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb5-143"><a></a>          <span class="at">y =</span> <span class="st">"Cumulative Return"</span>,</span>
<span id="cb5-144"><a></a>          <span class="at">color =</span> <span class="st">"Company"</span></span>
<span id="cb5-145"><a></a>        ) <span class="sc">+</span></span>
<span id="cb5-146"><a></a>        <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-147"><a></a>        <span class="fu">theme</span>(</span>
<span id="cb5-148"><a></a>          <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb5-149"><a></a>          <span class="at">legend.box =</span> <span class="st">"horizontal"</span>,</span>
<span id="cb5-150"><a></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb5-151"><a></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-152"><a></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb5-153"><a></a>        )</span>
<span id="cb5-154"><a></a>    }</span>
<span id="cb5-155"><a></a>  })</span>
<span id="cb5-156"><a></a>  </span>
<span id="cb5-157"><a></a>  <span class="co"># Generate data summary</span></span>
<span id="cb5-158"><a></a>  output<span class="sc">$</span>data_summary <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb5-159"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb5-160"><a></a>    </span>
<span id="cb5-161"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb5-162"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb5-163"><a></a>    </span>
<span id="cb5-164"><a></a>    <span class="co"># Summary statistics for each asset</span></span>
<span id="cb5-165"><a></a>    summary_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb5-166"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb5-167"><a></a>      <span class="fu">summarize</span>(</span>
<span id="cb5-168"><a></a>        <span class="at">Start_Date =</span> <span class="fu">min</span>(date),</span>
<span id="cb5-169"><a></a>        <span class="at">End_Date =</span> <span class="fu">max</span>(date),</span>
<span id="cb5-170"><a></a>        <span class="at">Total_Return =</span> <span class="fu">last</span>(cumulative_return) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb5-171"><a></a>        <span class="at">Annualized_Return =</span> ((<span class="dv">1</span> <span class="sc">+</span> <span class="fu">last</span>(cumulative_return))<span class="sc">^</span>(<span class="dv">252</span> <span class="sc">/</span> <span class="fu">n</span>())) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb5-172"><a></a>        <span class="at">Volatility =</span> <span class="fu">sd</span>(daily_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb5-173"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb5-174"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-175"><a></a>        <span class="at">Company =</span> <span class="fu">ifelse</span>(symbol <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), names_lookup[symbol], symbol),</span>
<span id="cb5-176"><a></a>        <span class="at">Total_Return =</span> <span class="fu">percent</span>(Total_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb5-177"><a></a>        <span class="at">Annualized_Return =</span> <span class="fu">percent</span>(Annualized_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb5-178"><a></a>        <span class="at">Volatility =</span> <span class="fu">percent</span>(Volatility, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb5-179"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb5-180"><a></a>      <span class="fu">select</span>(symbol, Company, Start_Date, End_Date, Total_Return, Annualized_Return, Volatility)</span>
<span id="cb5-181"><a></a>  })</span>
<span id="cb5-182"><a></a>}</span>
<span id="cb5-183"><a></a></span>
<span id="cb5-184"><a></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="adding-interactivity" class="slide level2">
<h2>#2: Adding Interactivity</h2>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Outline</a></li><li><a href="#tabset-3-2">Prompt</a></li><li><a href="#tabset-3-3">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<ul>
<li><p><em>Hooray</em>! You have a minimal working solution for all <em>S&amp;P 500</em> stocks covered in <em>Yahoo! Finance</em>. It is now time to look at the <em>aesthetics</em>:</p>
<ol type="1">
<li>As you increase the number of stocks, understanding the line chart becomes increasingly difficult</li>
<li>One way to enhance the user experience is to add <em>interactivity</em> to your chart, allowing users to hover on specific data points, filtering the date ranges directly in the chart, and zoom in/out on a specific region</li>
</ol></li>
<li><p>In what follows, we will change the charting engine from <code>ggplot2</code> to <code>highcharter</code>, a solution that allows for interactive time-series visualization</p></li>
</ul>
</div>
<div id="tabset-3-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>This is great<span class="sc">!</span> Now, I need to change the way that the chart aesthetics are looking. Please considers the instructions below<span class="sc">:</span></span>
<span id="cb6-2"><a></a></span>
<span id="cb6-3"><a></a>  <span class="fl">1.</span> Change the plotting engine from ggplot2 to highcharter, using the <span class="st">`</span><span class="at">hchart</span><span class="st">`</span> <span class="cf">function</span> to create a line chart</span>
<span id="cb6-4"><a></a>  <span class="fl">2.</span> Allow <span class="cf">for</span> time range selectors and, when users hover on a specific data point, use the tooltip to show the cumulative return up to that point, and the stock name. The tooltip and the y<span class="sc">-</span>axis must show the cumulative returns with the following format<span class="sc">:</span> <span class="st">'0.X%"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb7-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-3"><a></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb7-4"><a></a><span class="fu">library</span>(bslib)</span>
<span id="cb7-5"><a></a><span class="fu">library</span>(scales)</span>
<span id="cb7-6"><a></a><span class="fu">library</span>(shinyWidgets) <span class="co"># For pickerInput</span></span>
<span id="cb7-7"><a></a><span class="fu">library</span>(highcharter) <span class="co"># For interactive charts</span></span>
<span id="cb7-8"><a></a></span>
<span id="cb7-9"><a></a><span class="co"># Get S&amp;P 500 tickers and industry information</span></span>
<span id="cb7-10"><a></a>sp500_stocks <span class="ot">&lt;-</span> <span class="fu">tq_index</span>(<span class="st">"SP500"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a></a>  <span class="fu">select</span>(symbol, company, sector) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a></a>  <span class="fu">arrange</span>(sector, company)</span>
<span id="cb7-13"><a></a></span>
<span id="cb7-14"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb7-15"><a></a>  <span class="at">title =</span> <span class="st">"S&amp;P 500 Return Comparison"</span>,</span>
<span id="cb7-16"><a></a>  </span>
<span id="cb7-17"><a></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb7-18"><a></a>    <span class="at">title =</span> <span class="st">"Settings"</span>,</span>
<span id="cb7-19"><a></a>    </span>
<span id="cb7-20"><a></a>    <span class="fu">dateRangeInput</span>(</span>
<span id="cb7-21"><a></a>      <span class="st">"date_range"</span>,</span>
<span id="cb7-22"><a></a>      <span class="st">"Select date range:"</span>,</span>
<span id="cb7-23"><a></a>      <span class="at">start =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">365</span>,</span>
<span id="cb7-24"><a></a>      <span class="at">end =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb7-25"><a></a>      <span class="at">min =</span> <span class="st">"2015-01-01"</span>,</span>
<span id="cb7-26"><a></a>      <span class="at">max =</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb7-27"><a></a>    ),</span>
<span id="cb7-28"><a></a>    </span>
<span id="cb7-29"><a></a>    <span class="fu">hr</span>(),</span>
<span id="cb7-30"><a></a>    </span>
<span id="cb7-31"><a></a>    <span class="co"># Stock selector with search functionality</span></span>
<span id="cb7-32"><a></a>    <span class="fu">pickerInput</span>(</span>
<span id="cb7-33"><a></a>      <span class="at">inputId =</span> <span class="st">"stock_selector"</span>,</span>
<span id="cb7-34"><a></a>      <span class="at">label =</span> <span class="st">"Select Stocks:"</span>,</span>
<span id="cb7-35"><a></a>      <span class="at">choices =</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>symbol, <span class="fu">paste0</span>(sp500_stocks<span class="sc">$</span>symbol, <span class="st">" - "</span>, sp500_stocks<span class="sc">$</span>company)),</span>
<span id="cb7-36"><a></a>      <span class="at">selected =</span> <span class="cn">NULL</span>, <span class="co"># Default to no selection</span></span>
<span id="cb7-37"><a></a>      <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-38"><a></a>      <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb7-39"><a></a>        <span class="st">`</span><span class="at">actions-box</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-40"><a></a>        <span class="st">`</span><span class="at">live-search</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-41"><a></a>        <span class="st">`</span><span class="at">selected-text-format</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"count &gt; 3"</span>,</span>
<span id="cb7-42"><a></a>        <span class="st">`</span><span class="at">count-selected-text</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"{0} stocks selected"</span></span>
<span id="cb7-43"><a></a>      )</span>
<span id="cb7-44"><a></a>    )</span>
<span id="cb7-45"><a></a>  ),</span>
<span id="cb7-46"><a></a>  </span>
<span id="cb7-47"><a></a>  <span class="fu">card</span>(</span>
<span id="cb7-48"><a></a>    <span class="at">full_screen =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-49"><a></a>    <span class="fu">card_header</span>(<span class="st">"Cumulative Returns Comparison"</span>),</span>
<span id="cb7-50"><a></a>    <span class="fu">highchartOutput</span>(<span class="st">"returns_plot"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb7-51"><a></a>  ),</span>
<span id="cb7-52"><a></a>  </span>
<span id="cb7-53"><a></a>  <span class="fu">card</span>(</span>
<span id="cb7-54"><a></a>    <span class="fu">card_header</span>(<span class="st">"Performance Summary"</span>),</span>
<span id="cb7-55"><a></a>    <span class="fu">dataTableOutput</span>(<span class="st">"data_summary"</span>)</span>
<span id="cb7-56"><a></a>  )</span>
<span id="cb7-57"><a></a>)</span>
<span id="cb7-58"><a></a></span>
<span id="cb7-59"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb7-60"><a></a>  </span>
<span id="cb7-61"><a></a>  <span class="co"># Reactive to store current stock selection</span></span>
<span id="cb7-62"><a></a>  selected_stocks <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="cn">NULL</span>) <span class="co"># Start with no stocks selected</span></span>
<span id="cb7-63"><a></a>  </span>
<span id="cb7-64"><a></a>  <span class="co"># Update selected_stocks when stock_selector changes</span></span>
<span id="cb7-65"><a></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>stock_selector, {</span>
<span id="cb7-66"><a></a>    <span class="fu">selected_stocks</span>(input<span class="sc">$</span>stock_selector)</span>
<span id="cb7-67"><a></a>  })</span>
<span id="cb7-68"><a></a>  </span>
<span id="cb7-69"><a></a>  <span class="co"># Get full list of stocks to retrieve</span></span>
<span id="cb7-70"><a></a>  stocks_to_get <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb7-71"><a></a>    stocks <span class="ot">&lt;-</span> <span class="fu">selected_stocks</span>()</span>
<span id="cb7-72"><a></a>    </span>
<span id="cb7-73"><a></a>    <span class="co"># Ensure we have at least one stock to display</span></span>
<span id="cb7-74"><a></a>    <span class="cf">if</span> (<span class="fu">length</span>(stocks) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb7-75"><a></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb7-76"><a></a>    }</span>
<span id="cb7-77"><a></a>    </span>
<span id="cb7-78"><a></a>    <span class="fu">return</span>(stocks)</span>
<span id="cb7-79"><a></a>  })</span>
<span id="cb7-80"><a></a>  </span>
<span id="cb7-81"><a></a>  <span class="co"># Reactive expression to get and process stock data</span></span>
<span id="cb7-82"><a></a>  stock_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb7-83"><a></a>    <span class="co"># Validate that we have dates and stocks</span></span>
<span id="cb7-84"><a></a>    <span class="fu">req</span>(input<span class="sc">$</span>date_range)</span>
<span id="cb7-85"><a></a>    <span class="fu">req</span>(<span class="fu">length</span>(<span class="fu">stocks_to_get</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb7-86"><a></a>    </span>
<span id="cb7-87"><a></a>    <span class="co"># Download data</span></span>
<span id="cb7-88"><a></a>    tq_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(</span>
<span id="cb7-89"><a></a>      <span class="fu">stocks_to_get</span>(),</span>
<span id="cb7-90"><a></a>      <span class="at">from =</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>],</span>
<span id="cb7-91"><a></a>      <span class="at">to =</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>],</span>
<span id="cb7-92"><a></a>      <span class="at">get =</span> <span class="st">"stock.prices"</span></span>
<span id="cb7-93"><a></a>    )</span>
<span id="cb7-94"><a></a>    </span>
<span id="cb7-95"><a></a>    <span class="co"># Check if we got data</span></span>
<span id="cb7-96"><a></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(tq_data) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb7-97"><a></a>    </span>
<span id="cb7-98"><a></a>    <span class="co"># Calculate returns</span></span>
<span id="cb7-99"><a></a>    returns_data <span class="ot">&lt;-</span> tq_data <span class="sc">%&gt;%</span></span>
<span id="cb7-100"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb7-101"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb7-102"><a></a>      <span class="co"># Calculate daily returns</span></span>
<span id="cb7-103"><a></a>      <span class="fu">tq_transmute</span>(</span>
<span id="cb7-104"><a></a>        <span class="at">select =</span> adjusted,</span>
<span id="cb7-105"><a></a>        <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb7-106"><a></a>        <span class="at">period =</span> <span class="st">"daily"</span>,</span>
<span id="cb7-107"><a></a>        <span class="at">col_rename =</span> <span class="st">"daily_return"</span></span>
<span id="cb7-108"><a></a>      ) </span>
<span id="cb7-109"><a></a>    </span>
<span id="cb7-110"><a></a>    <span class="co"># Join the returns data with original price data</span></span>
<span id="cb7-111"><a></a>    returns_with_prices <span class="ot">&lt;-</span> returns_data <span class="sc">%&gt;%</span></span>
<span id="cb7-112"><a></a>      <span class="fu">left_join</span>(</span>
<span id="cb7-113"><a></a>        tq_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(symbol, date, adjusted),</span>
<span id="cb7-114"><a></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"symbol"</span>, <span class="st">"date"</span>)</span>
<span id="cb7-115"><a></a>      )</span>
<span id="cb7-116"><a></a>    </span>
<span id="cb7-117"><a></a>    <span class="co"># Calculate cumulative returns from the first date of the period</span></span>
<span id="cb7-118"><a></a>    cum_returns <span class="ot">&lt;-</span> returns_with_prices <span class="sc">%&gt;%</span></span>
<span id="cb7-119"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb7-120"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb7-121"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-122"><a></a>        <span class="co"># For each stock, calculate the cumulative return starting from the first date</span></span>
<span id="cb7-123"><a></a>        <span class="at">cumulative_return =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb7-124"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-125"><a></a>      <span class="fu">ungroup</span>()</span>
<span id="cb7-126"><a></a>    </span>
<span id="cb7-127"><a></a>    <span class="fu">list</span>(</span>
<span id="cb7-128"><a></a>      <span class="at">raw_data =</span> tq_data,</span>
<span id="cb7-129"><a></a>      <span class="at">cum_returns =</span> cum_returns</span>
<span id="cb7-130"><a></a>    )</span>
<span id="cb7-131"><a></a>  })</span>
<span id="cb7-132"><a></a>  </span>
<span id="cb7-133"><a></a>  <span class="co"># Get company names for better labels</span></span>
<span id="cb7-134"><a></a>  stock_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb7-135"><a></a>    <span class="co"># Create lookup from sp500 stocks</span></span>
<span id="cb7-136"><a></a>    name_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>company, sp500_stocks<span class="sc">$</span>symbol)</span>
<span id="cb7-137"><a></a>    </span>
<span id="cb7-138"><a></a>    <span class="co"># Return</span></span>
<span id="cb7-139"><a></a>    name_lookup</span>
<span id="cb7-140"><a></a>  })</span>
<span id="cb7-141"><a></a>  </span>
<span id="cb7-142"><a></a>  <span class="co"># Generate returns plot with highcharter</span></span>
<span id="cb7-143"><a></a>  output<span class="sc">$</span>returns_plot <span class="ot">&lt;-</span> <span class="fu">renderHighchart</span>({</span>
<span id="cb7-144"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb7-145"><a></a>    </span>
<span id="cb7-146"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb7-147"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb7-148"><a></a>    </span>
<span id="cb7-149"><a></a>    <span class="co"># Convert to format suitable for highcharter</span></span>
<span id="cb7-150"><a></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(cum_returns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-151"><a></a>      <span class="co"># Create highchart</span></span>
<span id="cb7-152"><a></a>      hc <span class="ot">&lt;-</span> <span class="fu">highchart</span>(<span class="at">type =</span> <span class="st">"stock"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-153"><a></a>        <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"Cumulative Returns Comparison"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-154"><a></a>        <span class="fu">hc_xAxis</span>(<span class="at">type =</span> <span class="st">"datetime"</span>, </span>
<span id="cb7-155"><a></a>                 <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Date"</span>),</span>
<span id="cb7-156"><a></a>                 <span class="at">dateTimeLabelFormats =</span> <span class="fu">list</span>(</span>
<span id="cb7-157"><a></a>                   <span class="at">day =</span> <span class="st">'%e of %b'</span>,</span>
<span id="cb7-158"><a></a>                   <span class="at">month =</span> <span class="st">'%b %Y'</span>,</span>
<span id="cb7-159"><a></a>                   <span class="at">year =</span> <span class="st">'%Y'</span></span>
<span id="cb7-160"><a></a>                 )) <span class="sc">%&gt;%</span></span>
<span id="cb7-161"><a></a>        <span class="fu">hc_yAxis</span>(</span>
<span id="cb7-162"><a></a>          <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Cumulative Return"</span>),</span>
<span id="cb7-163"><a></a>          <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">formatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return (this.value * 100).toFixed(2) + '%'; }"</span>))</span>
<span id="cb7-164"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb7-165"><a></a>        <span class="fu">hc_tooltip</span>(</span>
<span id="cb7-166"><a></a>          <span class="at">headerFormat =</span> <span class="st">'&lt;span style="font-size: 10px"&gt;{point.key}&lt;/span&gt;&lt;br/&gt;'</span>,</span>
<span id="cb7-167"><a></a>          <span class="at">pointFormatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return '&lt;span style=</span><span class="sc">\"</span><span class="st">color:' + this.color + '</span><span class="sc">\"</span><span class="st">&gt;●&lt;/span&gt; &lt;b&gt;' + this.series.name + '&lt;/b&gt;: &lt;b&gt;' + (this.y * 100).toFixed(2) + '%&lt;/b&gt;&lt;br/&gt;'; }"</span>),</span>
<span id="cb7-168"><a></a>          <span class="at">shared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-169"><a></a>          <span class="at">crosshairs =</span> <span class="cn">TRUE</span></span>
<span id="cb7-170"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb7-171"><a></a>        <span class="fu">hc_plotOptions</span>(<span class="at">series =</span> <span class="fu">list</span>(</span>
<span id="cb7-172"><a></a>          <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>),</span>
<span id="cb7-173"><a></a>          <span class="at">states =</span> <span class="fu">list</span>(<span class="at">hover =</span> <span class="fu">list</span>(<span class="at">lineWidthPlus =</span> <span class="dv">0</span>))</span>
<span id="cb7-174"><a></a>        )) <span class="sc">%&gt;%</span></span>
<span id="cb7-175"><a></a>        <span class="fu">hc_legend</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-176"><a></a>      </span>
<span id="cb7-177"><a></a>      <span class="co"># Add data for each stock</span></span>
<span id="cb7-178"><a></a>      <span class="cf">for</span>(stock <span class="cf">in</span> <span class="fu">unique</span>(cum_returns<span class="sc">$</span>symbol)) {</span>
<span id="cb7-179"><a></a>        stock_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb7-180"><a></a>          <span class="fu">filter</span>(symbol <span class="sc">==</span> stock) <span class="sc">%&gt;%</span></span>
<span id="cb7-181"><a></a>          <span class="fu">select</span>(date, cumulative_return)</span>
<span id="cb7-182"><a></a>        </span>
<span id="cb7-183"><a></a>        <span class="co"># Get proper company name</span></span>
<span id="cb7-184"><a></a>        company_name <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(stock <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), </span>
<span id="cb7-185"><a></a>                               names_lookup[stock], </span>
<span id="cb7-186"><a></a>                               stock)</span>
<span id="cb7-187"><a></a>        </span>
<span id="cb7-188"><a></a>        <span class="co"># Format data for highcharter - simplified approach</span></span>
<span id="cb7-189"><a></a>        hc_data <span class="ot">&lt;-</span> stock_data <span class="sc">%&gt;%</span></span>
<span id="cb7-190"><a></a>          <span class="fu">mutate</span>(</span>
<span id="cb7-191"><a></a>            <span class="at">x =</span> <span class="fu">datetime_to_timestamp</span>(date),</span>
<span id="cb7-192"><a></a>            <span class="at">y =</span> cumulative_return  <span class="co"># Keep as decimal for proper calculations</span></span>
<span id="cb7-193"><a></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb7-194"><a></a>          <span class="fu">select</span>(x, y) <span class="sc">%&gt;%</span></span>
<span id="cb7-195"><a></a>          <span class="fu">list_parse2</span>()</span>
<span id="cb7-196"><a></a>        </span>
<span id="cb7-197"><a></a>        <span class="co"># Add series to chart</span></span>
<span id="cb7-198"><a></a>        hc <span class="ot">&lt;-</span> hc <span class="sc">%&gt;%</span></span>
<span id="cb7-199"><a></a>          <span class="fu">hc_add_series</span>(</span>
<span id="cb7-200"><a></a>            <span class="at">data =</span> hc_data,</span>
<span id="cb7-201"><a></a>            <span class="at">name =</span> <span class="fu">paste0</span>(stock, <span class="st">" - "</span>, company_name),</span>
<span id="cb7-202"><a></a>            <span class="at">type =</span> <span class="st">"line"</span></span>
<span id="cb7-203"><a></a>          )</span>
<span id="cb7-204"><a></a>      }</span>
<span id="cb7-205"><a></a>      </span>
<span id="cb7-206"><a></a>      <span class="co"># Return the chart</span></span>
<span id="cb7-207"><a></a>      hc</span>
<span id="cb7-208"><a></a>    }</span>
<span id="cb7-209"><a></a>  })</span>
<span id="cb7-210"><a></a>  </span>
<span id="cb7-211"><a></a>  <span class="co"># Generate data summary</span></span>
<span id="cb7-212"><a></a>  output<span class="sc">$</span>data_summary <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb7-213"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb7-214"><a></a>    </span>
<span id="cb7-215"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb7-216"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb7-217"><a></a>    </span>
<span id="cb7-218"><a></a>    <span class="co"># Summary statistics for each asset</span></span>
<span id="cb7-219"><a></a>    summary_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb7-220"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb7-221"><a></a>      <span class="fu">summarize</span>(</span>
<span id="cb7-222"><a></a>        <span class="at">Start_Date =</span> <span class="fu">min</span>(date),</span>
<span id="cb7-223"><a></a>        <span class="at">End_Date =</span> <span class="fu">max</span>(date),</span>
<span id="cb7-224"><a></a>        <span class="at">Total_Return =</span> <span class="fu">last</span>(cumulative_return) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb7-225"><a></a>        <span class="at">Annualized_Return =</span> ((<span class="dv">1</span> <span class="sc">+</span> <span class="fu">last</span>(cumulative_return))<span class="sc">^</span>(<span class="dv">252</span> <span class="sc">/</span> <span class="fu">n</span>())) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb7-226"><a></a>        <span class="at">Volatility =</span> <span class="fu">sd</span>(daily_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb7-227"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-228"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb7-229"><a></a>        <span class="at">Company =</span> <span class="fu">ifelse</span>(symbol <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), names_lookup[symbol], symbol),</span>
<span id="cb7-230"><a></a>        <span class="at">Total_Return =</span> <span class="fu">percent</span>(Total_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb7-231"><a></a>        <span class="at">Annualized_Return =</span> <span class="fu">percent</span>(Annualized_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb7-232"><a></a>        <span class="at">Volatility =</span> <span class="fu">percent</span>(Volatility, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb7-233"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-234"><a></a>      <span class="fu">select</span>(symbol, Company, Start_Date, End_Date, Total_Return, Annualized_Return, Volatility)</span>
<span id="cb7-235"><a></a>  })</span>
<span id="cb7-236"><a></a>}</span>
<span id="cb7-237"><a></a></span>
<span id="cb7-238"><a></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="aesthetic-adjustments" class="slide level2">
<h2>#3: Aesthetic Adjustments</h2>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Outline</a></li><li><a href="#tabset-4-2">Prompt</a></li><li><a href="#tabset-4-3">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<ul>
<li><p><span class="blue">You’re on a streak!</span> You app is looking <em>neat</em>: you should consider showcasing that!</p></li>
<li><p>Before you do that, let’s make sure users can get the most of your app while interacting:</p>
<ol type="1">
<li>The <span class="blue">width</span> of the sidebar needs to be increased a little bit to allow for text to be displayed</li>
<li>The dropdown menu section needs to be more organized</li>
<li>Finally, you can also make the charts and the table to look nicer by changing the size of the line charts and renaming the column names to be displayed in <em>Title Format</em></li>
</ol></li>
<li><p>In what follows, we will ask for these changes with simple instructions to tweak the current code</p></li>
</ul>
</div>
<div id="tabset-4-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a>Ok, this is looking neat<span class="sc">!</span> Now, I need you to change a few points<span class="sc">:</span></span>
<span id="cb8-2"><a></a></span>
<span id="cb8-3"><a></a>  <span class="fl">1.</span> Increase the width of the sidebar by <span class="dv">25</span>%</span>
<span id="cb8-4"><a></a></span>
<span id="cb8-5"><a></a>  <span class="fl">2.</span> Use the <span class="fu">pickerInput</span>() from the shinyWidgets package to select the stocks. It should be a combination of the form <span class="st">"ticker (Company)"</span></span>
<span id="cb8-6"><a></a></span>
<span id="cb8-7"><a></a>  <span class="fl">3.</span> Increase the size of the lines <span class="cf">in</span> the <span class="fu">hchart</span>() call</span>
<span id="cb8-8"><a></a>  </span>
<span id="cb8-9"><a></a>  <span class="fl">4.</span> Rename the column names <span class="cf">in</span> the table and make it <span class="cf">in</span> proper <span class="fu">format</span> (e.g, remove underlines and ensure Title Format)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb9-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-3"><a></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb9-4"><a></a><span class="fu">library</span>(bslib)</span>
<span id="cb9-5"><a></a><span class="fu">library</span>(scales)</span>
<span id="cb9-6"><a></a><span class="fu">library</span>(shinyWidgets) <span class="co"># For pickerInput and dropdownButton</span></span>
<span id="cb9-7"><a></a><span class="fu">library</span>(highcharter) <span class="co"># For interactive charts</span></span>
<span id="cb9-8"><a></a></span>
<span id="cb9-9"><a></a><span class="co"># Get S&amp;P 500 tickers and industry information</span></span>
<span id="cb9-10"><a></a>sp500_stocks <span class="ot">&lt;-</span> <span class="fu">tq_index</span>(<span class="st">"SP500"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a></a>  <span class="fu">select</span>(symbol, company, sector) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a></a>  <span class="fu">arrange</span>(sector, company)</span>
<span id="cb9-13"><a></a></span>
<span id="cb9-14"><a></a><span class="co"># Create choices with company name as supplementary info in front of ticker</span></span>
<span id="cb9-15"><a></a><span class="co"># Format: "Company Name (TICKER)"</span></span>
<span id="cb9-16"><a></a>ticker_labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(sp500_stocks<span class="sc">$</span>company, <span class="st">" ("</span>, sp500_stocks<span class="sc">$</span>symbol, <span class="st">")"</span>)</span>
<span id="cb9-17"><a></a>ticker_choices <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>symbol, ticker_labels)</span>
<span id="cb9-18"><a></a></span>
<span id="cb9-19"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb9-20"><a></a>  <span class="at">title =</span> <span class="st">"S&amp;P 500 Return Comparison"</span>,</span>
<span id="cb9-21"><a></a>  </span>
<span id="cb9-22"><a></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb9-23"><a></a>    <span class="at">title =</span> <span class="st">"Settings"</span>,</span>
<span id="cb9-24"><a></a>    <span class="at">width =</span> <span class="dv">440</span>, <span class="co"># Increased width </span></span>
<span id="cb9-25"><a></a>    </span>
<span id="cb9-26"><a></a>    <span class="fu">dateRangeInput</span>(</span>
<span id="cb9-27"><a></a>      <span class="st">"date_range"</span>,</span>
<span id="cb9-28"><a></a>      <span class="st">"Select date range:"</span>,</span>
<span id="cb9-29"><a></a>      <span class="at">start =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">365</span>,</span>
<span id="cb9-30"><a></a>      <span class="at">end =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb9-31"><a></a>      <span class="at">min =</span> <span class="st">"2015-01-01"</span>,</span>
<span id="cb9-32"><a></a>      <span class="at">max =</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb9-33"><a></a>    ),</span>
<span id="cb9-34"><a></a>    </span>
<span id="cb9-35"><a></a>    <span class="fu">hr</span>(),</span>
<span id="cb9-36"><a></a>    </span>
<span id="cb9-37"><a></a>    <span class="co"># Use dropdownButton for stock selection</span></span>
<span id="cb9-38"><a></a>    <span class="fu">dropdownButton</span>(</span>
<span id="cb9-39"><a></a>      <span class="at">inputId =</span> <span class="st">"dropdown_stocks"</span>,</span>
<span id="cb9-40"><a></a>      <span class="at">label =</span> <span class="st">"Select Stocks"</span>, </span>
<span id="cb9-41"><a></a>      <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"filter"</span>),</span>
<span id="cb9-42"><a></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb9-43"><a></a>      <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb9-44"><a></a>      <span class="at">circle =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-45"><a></a>      </span>
<span id="cb9-46"><a></a>      <span class="co"># Stock selector with search functionality</span></span>
<span id="cb9-47"><a></a>      <span class="fu">pickerInput</span>(</span>
<span id="cb9-48"><a></a>        <span class="at">inputId =</span> <span class="st">"stock_selector"</span>,</span>
<span id="cb9-49"><a></a>        <span class="at">label =</span> <span class="st">"Select Stocks:"</span>,</span>
<span id="cb9-50"><a></a>        <span class="at">choices =</span> ticker_choices,</span>
<span id="cb9-51"><a></a>        <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb9-52"><a></a>          <span class="st">`</span><span class="at">actions-box</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-53"><a></a>          <span class="st">`</span><span class="at">live-search</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-54"><a></a>          <span class="st">`</span><span class="at">selected-text-format</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"count &gt; 3"</span>,</span>
<span id="cb9-55"><a></a>          <span class="st">`</span><span class="at">count-selected-text</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"{0} stocks selected"</span></span>
<span id="cb9-56"><a></a>        ),</span>
<span id="cb9-57"><a></a>        <span class="at">selected =</span> <span class="cn">NULL</span>, <span class="co"># Default to no selection</span></span>
<span id="cb9-58"><a></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-59"><a></a>        <span class="at">width =</span> <span class="st">"100%"</span></span>
<span id="cb9-60"><a></a>      )</span>
<span id="cb9-61"><a></a>    )</span>
<span id="cb9-62"><a></a>  ),</span>
<span id="cb9-63"><a></a>  </span>
<span id="cb9-64"><a></a>  <span class="fu">card</span>(</span>
<span id="cb9-65"><a></a>    <span class="at">full_screen =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-66"><a></a>    <span class="fu">card_header</span>(<span class="st">"Cumulative Returns Comparison"</span>),</span>
<span id="cb9-67"><a></a>    <span class="fu">highchartOutput</span>(<span class="st">"returns_plot"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb9-68"><a></a>  ),</span>
<span id="cb9-69"><a></a>  </span>
<span id="cb9-70"><a></a>  <span class="fu">card</span>(</span>
<span id="cb9-71"><a></a>    <span class="fu">card_header</span>(<span class="st">"Performance Summary"</span>),</span>
<span id="cb9-72"><a></a>    <span class="fu">dataTableOutput</span>(<span class="st">"data_summary"</span>)</span>
<span id="cb9-73"><a></a>  )</span>
<span id="cb9-74"><a></a>)</span>
<span id="cb9-75"><a></a></span>
<span id="cb9-76"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb9-77"><a></a>  </span>
<span id="cb9-78"><a></a>  <span class="co"># Reactive to store current stock selection</span></span>
<span id="cb9-79"><a></a>  selected_stocks <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="cn">NULL</span>) <span class="co"># Start with no stocks selected</span></span>
<span id="cb9-80"><a></a>  </span>
<span id="cb9-81"><a></a>  <span class="co"># Update selected_stocks when stock_selector changes</span></span>
<span id="cb9-82"><a></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>stock_selector, {</span>
<span id="cb9-83"><a></a>    <span class="fu">selected_stocks</span>(input<span class="sc">$</span>stock_selector)</span>
<span id="cb9-84"><a></a>  })</span>
<span id="cb9-85"><a></a>  </span>
<span id="cb9-86"><a></a>  <span class="co"># Get full list of stocks to retrieve</span></span>
<span id="cb9-87"><a></a>  stocks_to_get <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-88"><a></a>    stocks <span class="ot">&lt;-</span> <span class="fu">selected_stocks</span>()</span>
<span id="cb9-89"><a></a>    </span>
<span id="cb9-90"><a></a>    <span class="co"># Ensure we have at least one stock to display</span></span>
<span id="cb9-91"><a></a>    <span class="cf">if</span> (<span class="fu">length</span>(stocks) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-92"><a></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb9-93"><a></a>    }</span>
<span id="cb9-94"><a></a>    </span>
<span id="cb9-95"><a></a>    <span class="fu">return</span>(stocks)</span>
<span id="cb9-96"><a></a>  })</span>
<span id="cb9-97"><a></a>  </span>
<span id="cb9-98"><a></a>  <span class="co"># Reactive expression to get and process stock data</span></span>
<span id="cb9-99"><a></a>  stock_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-100"><a></a>    <span class="co"># Validate that we have dates and stocks</span></span>
<span id="cb9-101"><a></a>    <span class="fu">req</span>(input<span class="sc">$</span>date_range)</span>
<span id="cb9-102"><a></a>    <span class="fu">req</span>(<span class="fu">length</span>(<span class="fu">stocks_to_get</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb9-103"><a></a>    </span>
<span id="cb9-104"><a></a>    <span class="co"># Download data</span></span>
<span id="cb9-105"><a></a>    tq_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(</span>
<span id="cb9-106"><a></a>      <span class="fu">stocks_to_get</span>(),</span>
<span id="cb9-107"><a></a>      <span class="at">from =</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>],</span>
<span id="cb9-108"><a></a>      <span class="at">to =</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>],</span>
<span id="cb9-109"><a></a>      <span class="at">get =</span> <span class="st">"stock.prices"</span></span>
<span id="cb9-110"><a></a>    )</span>
<span id="cb9-111"><a></a>    </span>
<span id="cb9-112"><a></a>    <span class="co"># Check if we got data</span></span>
<span id="cb9-113"><a></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(tq_data) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb9-114"><a></a>    </span>
<span id="cb9-115"><a></a>    <span class="co"># Calculate returns</span></span>
<span id="cb9-116"><a></a>    returns_data <span class="ot">&lt;-</span> tq_data <span class="sc">%&gt;%</span></span>
<span id="cb9-117"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb9-118"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb9-119"><a></a>      <span class="co"># Calculate daily returns</span></span>
<span id="cb9-120"><a></a>      <span class="fu">tq_transmute</span>(</span>
<span id="cb9-121"><a></a>        <span class="at">select =</span> adjusted,</span>
<span id="cb9-122"><a></a>        <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb9-123"><a></a>        <span class="at">period =</span> <span class="st">"daily"</span>,</span>
<span id="cb9-124"><a></a>        <span class="at">col_rename =</span> <span class="st">"daily_return"</span></span>
<span id="cb9-125"><a></a>      ) </span>
<span id="cb9-126"><a></a>    </span>
<span id="cb9-127"><a></a>    <span class="co"># Join the returns data with original price data</span></span>
<span id="cb9-128"><a></a>    returns_with_prices <span class="ot">&lt;-</span> returns_data <span class="sc">%&gt;%</span></span>
<span id="cb9-129"><a></a>      <span class="fu">left_join</span>(</span>
<span id="cb9-130"><a></a>        tq_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(symbol, date, adjusted),</span>
<span id="cb9-131"><a></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"symbol"</span>, <span class="st">"date"</span>)</span>
<span id="cb9-132"><a></a>      )</span>
<span id="cb9-133"><a></a>    </span>
<span id="cb9-134"><a></a>    <span class="co"># Calculate cumulative returns from the first date of the period</span></span>
<span id="cb9-135"><a></a>    cum_returns <span class="ot">&lt;-</span> returns_with_prices <span class="sc">%&gt;%</span></span>
<span id="cb9-136"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb9-137"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb9-138"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-139"><a></a>        <span class="co"># For each stock, calculate the cumulative return starting from the first date</span></span>
<span id="cb9-140"><a></a>        <span class="at">cumulative_return =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb9-141"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb9-142"><a></a>      <span class="fu">ungroup</span>()</span>
<span id="cb9-143"><a></a>    </span>
<span id="cb9-144"><a></a>    <span class="fu">list</span>(</span>
<span id="cb9-145"><a></a>      <span class="at">raw_data =</span> tq_data,</span>
<span id="cb9-146"><a></a>      <span class="at">cum_returns =</span> cum_returns</span>
<span id="cb9-147"><a></a>    )</span>
<span id="cb9-148"><a></a>  })</span>
<span id="cb9-149"><a></a>  </span>
<span id="cb9-150"><a></a>  <span class="co"># Get company names for better labels</span></span>
<span id="cb9-151"><a></a>  stock_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb9-152"><a></a>    <span class="co"># Create lookup from sp500 stocks</span></span>
<span id="cb9-153"><a></a>    name_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>company, sp500_stocks<span class="sc">$</span>symbol)</span>
<span id="cb9-154"><a></a>    </span>
<span id="cb9-155"><a></a>    <span class="co"># Return</span></span>
<span id="cb9-156"><a></a>    name_lookup</span>
<span id="cb9-157"><a></a>  })</span>
<span id="cb9-158"><a></a>  </span>
<span id="cb9-159"><a></a>  <span class="co"># Generate returns plot with highcharter</span></span>
<span id="cb9-160"><a></a>  output<span class="sc">$</span>returns_plot <span class="ot">&lt;-</span> <span class="fu">renderHighchart</span>({</span>
<span id="cb9-161"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb9-162"><a></a>    </span>
<span id="cb9-163"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb9-164"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb9-165"><a></a>    </span>
<span id="cb9-166"><a></a>    <span class="co"># Convert to format suitable for highcharter</span></span>
<span id="cb9-167"><a></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(cum_returns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb9-168"><a></a>      <span class="co"># Create highchart</span></span>
<span id="cb9-169"><a></a>      hc <span class="ot">&lt;-</span> <span class="fu">highchart</span>(<span class="at">type =</span> <span class="st">"stock"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-170"><a></a>        <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"Cumulative Returns Comparison"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-171"><a></a>        <span class="fu">hc_xAxis</span>(<span class="at">type =</span> <span class="st">"datetime"</span>, </span>
<span id="cb9-172"><a></a>                 <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Date"</span>),</span>
<span id="cb9-173"><a></a>                 <span class="at">dateTimeLabelFormats =</span> <span class="fu">list</span>(</span>
<span id="cb9-174"><a></a>                   <span class="at">day =</span> <span class="st">'%e of %b'</span>,</span>
<span id="cb9-175"><a></a>                   <span class="at">month =</span> <span class="st">'%b %Y'</span>,</span>
<span id="cb9-176"><a></a>                   <span class="at">year =</span> <span class="st">'%Y'</span></span>
<span id="cb9-177"><a></a>                 )) <span class="sc">%&gt;%</span></span>
<span id="cb9-178"><a></a>        <span class="fu">hc_yAxis</span>(</span>
<span id="cb9-179"><a></a>          <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Cumulative Return"</span>),</span>
<span id="cb9-180"><a></a>          <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">formatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return (this.value * 100).toFixed(2) + '%'; }"</span>))</span>
<span id="cb9-181"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb9-182"><a></a>        <span class="fu">hc_tooltip</span>(</span>
<span id="cb9-183"><a></a>          <span class="at">headerFormat =</span> <span class="st">'&lt;span style="font-size: 10px"&gt;{point.key}&lt;/span&gt;&lt;br/&gt;'</span>,</span>
<span id="cb9-184"><a></a>          <span class="at">pointFormatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return '&lt;span style=</span><span class="sc">\"</span><span class="st">color:' + this.color + '</span><span class="sc">\"</span><span class="st">&gt;●&lt;/span&gt; &lt;b&gt;' + this.series.name + '&lt;/b&gt;: &lt;b&gt;' + (this.y * 100).toFixed(2) + '%&lt;/b&gt;&lt;br/&gt;'; }"</span>),</span>
<span id="cb9-185"><a></a>          <span class="at">shared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-186"><a></a>          <span class="at">crosshairs =</span> <span class="cn">TRUE</span></span>
<span id="cb9-187"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb9-188"><a></a>        <span class="fu">hc_plotOptions</span>(<span class="at">series =</span> <span class="fu">list</span>(</span>
<span id="cb9-189"><a></a>          <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>),</span>
<span id="cb9-190"><a></a>          <span class="at">states =</span> <span class="fu">list</span>(<span class="at">hover =</span> <span class="fu">list</span>(<span class="at">lineWidthPlus =</span> <span class="dv">0</span>)),</span>
<span id="cb9-191"><a></a>          <span class="at">lineWidth =</span> <span class="dv">3</span>  <span class="co"># Increased line thickness</span></span>
<span id="cb9-192"><a></a>        )) <span class="sc">%&gt;%</span></span>
<span id="cb9-193"><a></a>        <span class="fu">hc_legend</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-194"><a></a>      </span>
<span id="cb9-195"><a></a>      <span class="co"># Add data for each stock</span></span>
<span id="cb9-196"><a></a>      <span class="cf">for</span>(stock <span class="cf">in</span> <span class="fu">unique</span>(cum_returns<span class="sc">$</span>symbol)) {</span>
<span id="cb9-197"><a></a>        stock_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb9-198"><a></a>          <span class="fu">filter</span>(symbol <span class="sc">==</span> stock) <span class="sc">%&gt;%</span></span>
<span id="cb9-199"><a></a>          <span class="fu">select</span>(date, cumulative_return)</span>
<span id="cb9-200"><a></a>        </span>
<span id="cb9-201"><a></a>        <span class="co"># Format data for highcharter - simplified approach</span></span>
<span id="cb9-202"><a></a>        hc_data <span class="ot">&lt;-</span> stock_data <span class="sc">%&gt;%</span></span>
<span id="cb9-203"><a></a>          <span class="fu">mutate</span>(</span>
<span id="cb9-204"><a></a>            <span class="at">x =</span> <span class="fu">datetime_to_timestamp</span>(date),</span>
<span id="cb9-205"><a></a>            <span class="at">y =</span> cumulative_return  <span class="co"># Keep as decimal for proper calculations</span></span>
<span id="cb9-206"><a></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb9-207"><a></a>          <span class="fu">select</span>(x, y) <span class="sc">%&gt;%</span></span>
<span id="cb9-208"><a></a>          <span class="fu">list_parse2</span>()</span>
<span id="cb9-209"><a></a>        </span>
<span id="cb9-210"><a></a>        <span class="co"># Add series to chart - only use the ticker symbol in the name</span></span>
<span id="cb9-211"><a></a>        hc <span class="ot">&lt;-</span> hc <span class="sc">%&gt;%</span></span>
<span id="cb9-212"><a></a>          <span class="fu">hc_add_series</span>(</span>
<span id="cb9-213"><a></a>            <span class="at">data =</span> hc_data,</span>
<span id="cb9-214"><a></a>            <span class="at">name =</span> stock,</span>
<span id="cb9-215"><a></a>            <span class="at">type =</span> <span class="st">"line"</span></span>
<span id="cb9-216"><a></a>          )</span>
<span id="cb9-217"><a></a>      }</span>
<span id="cb9-218"><a></a>      </span>
<span id="cb9-219"><a></a>      <span class="co"># Return the chart</span></span>
<span id="cb9-220"><a></a>      hc</span>
<span id="cb9-221"><a></a>    }</span>
<span id="cb9-222"><a></a>  })</span>
<span id="cb9-223"><a></a>  </span>
<span id="cb9-224"><a></a>  <span class="co"># Generate data summary</span></span>
<span id="cb9-225"><a></a>  output<span class="sc">$</span>data_summary <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb9-226"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb9-227"><a></a>    </span>
<span id="cb9-228"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb9-229"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb9-230"><a></a>    </span>
<span id="cb9-231"><a></a>    <span class="co"># Summary statistics for each asset</span></span>
<span id="cb9-232"><a></a>    summary_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb9-233"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb9-234"><a></a>      <span class="fu">summarize</span>(</span>
<span id="cb9-235"><a></a>        <span class="at">Start_Date =</span> <span class="fu">min</span>(date),</span>
<span id="cb9-236"><a></a>        <span class="at">End_Date =</span> <span class="fu">max</span>(date),</span>
<span id="cb9-237"><a></a>        <span class="at">Total_Return =</span> <span class="fu">last</span>(cumulative_return) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb9-238"><a></a>        <span class="at">Annualized_Return =</span> ((<span class="dv">1</span> <span class="sc">+</span> <span class="fu">last</span>(cumulative_return))<span class="sc">^</span>(<span class="dv">252</span> <span class="sc">/</span> <span class="fu">n</span>())) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb9-239"><a></a>        <span class="at">Volatility =</span> <span class="fu">sd</span>(daily_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb9-240"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb9-241"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb9-242"><a></a>        <span class="at">Company =</span> <span class="fu">ifelse</span>(symbol <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), names_lookup[symbol], symbol),</span>
<span id="cb9-243"><a></a>        <span class="at">Total_Return =</span> <span class="fu">percent</span>(Total_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb9-244"><a></a>        <span class="at">Annualized_Return =</span> <span class="fu">percent</span>(Annualized_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb9-245"><a></a>        <span class="at">Volatility =</span> <span class="fu">percent</span>(Volatility, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb9-246"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb9-247"><a></a>      <span class="fu">select</span>(</span>
<span id="cb9-248"><a></a>        <span class="at">Symbol =</span> symbol, </span>
<span id="cb9-249"><a></a>        Company, </span>
<span id="cb9-250"><a></a>        <span class="st">`</span><span class="at">Start Date</span><span class="st">`</span> <span class="ot">=</span> Start_Date, </span>
<span id="cb9-251"><a></a>        <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> End_Date, </span>
<span id="cb9-252"><a></a>        <span class="st">`</span><span class="at">Total Return</span><span class="st">`</span> <span class="ot">=</span> Total_Return, </span>
<span id="cb9-253"><a></a>        <span class="st">`</span><span class="at">Annualized Return</span><span class="st">`</span> <span class="ot">=</span> Annualized_Return, </span>
<span id="cb9-254"><a></a>        Volatility</span>
<span id="cb9-255"><a></a>      )</span>
<span id="cb9-256"><a></a>  })</span>
<span id="cb9-257"><a></a>}</span>
<span id="cb9-258"><a></a></span>
<span id="cb9-259"><a></a><span class="fu">shinyApp</span>(ui, server) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="final-adjustments" class="slide level2">
<h2>#4: Final Adjustments</h2>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-5-1">Outline</a></li><li><a href="#tabset-5-2">Prompt</a></li><li><a href="#tabset-5-3">Code</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1">
<ul>
<li><p><span class="blue">Like a pro!</span> Your app is now looking like it’s something you would pay for!</p></li>
<li><p>Before you showcase that to our boss, remember: you should make sure the app is not crashing due to user interaction:</p>
<ol type="1">
<li><p>For example, if a user selects <em>“All Stocks”</em>, <code>tq_get()</code> will automatically start downloading a lot of data - which might break the server</p></li>
<li><p>Furthermore, users should have the ability to confirm their selections and, eventually, <em>download</em> a summary of their findings. The submit button should send an alert saying that the list has been submitted and results will appear soon.</p></li>
</ol></li>
<li><p>In what follows, we will create some selection handling procedures and insert a <em>Download Button</em> that creates a downloadable <code>.csv</code> file</p></li>
</ul>
</div>
<div id="tabset-5-2">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>Way to go<span class="sc">!</span> Now, here<span class="st">'s a list of final adjustments to be made:</span></span>
<span id="cb10-2"><a></a></span>
<span id="cb10-3"><a></a><span class="st">1. Create a "Submit List" button that, when triggered, will update the charts and tables. The app shouldn'</span>t update without that.</span>
<span id="cb10-4"><a></a></span>
<span id="cb10-5"><a></a><span class="fl">2.</span> Allow <span class="cf">for</span> dark mode using a <span class="cf">switch</span> button <span class="cf">in</span> the header</span>
<span id="cb10-6"><a></a></span>
<span id="cb10-7"><a></a><span class="fl">3.</span> Create a download button that, when triggered, saves a .csv file with the contents from the top <span class="fu">panel</span> (time series of cumulative returns <span class="cf">for</span> each stock). The submit button should send an alert saying that the list has been submitted and results will appear soon using the <span class="fu">sendSweetAlert</span>() function.</span>
<span id="cb10-8"><a></a></span>
<span id="cb10-9"><a></a><span class="fl">4.</span> Add icons <span class="cf">in</span> the title, Settings, and Submit configuration buttons  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">library</span>(shiny)</span>
<span id="cb11-2"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-3"><a></a><span class="fu">library</span>(tidyquant)</span>
<span id="cb11-4"><a></a><span class="fu">library</span>(bslib)</span>
<span id="cb11-5"><a></a><span class="fu">library</span>(scales)</span>
<span id="cb11-6"><a></a><span class="fu">library</span>(shinyWidgets) <span class="co"># For pickerInput, dropdownButton, and sweetAlert</span></span>
<span id="cb11-7"><a></a><span class="fu">library</span>(highcharter) <span class="co"># For interactive charts</span></span>
<span id="cb11-8"><a></a></span>
<span id="cb11-9"><a></a><span class="co"># Get S&amp;P 500 tickers and industry information</span></span>
<span id="cb11-10"><a></a>sp500_stocks <span class="ot">&lt;-</span> <span class="fu">tq_index</span>(<span class="st">"SP500"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-11"><a></a>  <span class="fu">select</span>(symbol, company, sector) <span class="sc">%&gt;%</span></span>
<span id="cb11-12"><a></a>  <span class="fu">arrange</span>(sector, company)</span>
<span id="cb11-13"><a></a></span>
<span id="cb11-14"><a></a><span class="co"># Create choices with company name as supplementary info in front of ticker</span></span>
<span id="cb11-15"><a></a><span class="co"># Format: "Company Name (TICKER)"</span></span>
<span id="cb11-16"><a></a>ticker_labels <span class="ot">&lt;-</span> <span class="fu">paste0</span>(sp500_stocks<span class="sc">$</span>company, <span class="st">" ("</span>, sp500_stocks<span class="sc">$</span>symbol, <span class="st">")"</span>)</span>
<span id="cb11-17"><a></a>ticker_choices <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>symbol, ticker_labels)</span>
<span id="cb11-18"><a></a></span>
<span id="cb11-19"><a></a>ui <span class="ot">&lt;-</span> <span class="fu">page_sidebar</span>(</span>
<span id="cb11-20"><a></a>  <span class="at">title =</span> <span class="fu">span</span>(<span class="fu">icon</span>(<span class="st">"chart-line"</span>), <span class="st">"S&amp;P 500 Return Comparison"</span>),</span>
<span id="cb11-21"><a></a>  <span class="at">theme =</span> <span class="fu">bs_theme</span>(<span class="at">version =</span> <span class="dv">5</span>, <span class="at">preset =</span> <span class="st">"default"</span>),</span>
<span id="cb11-22"><a></a>  </span>
<span id="cb11-23"><a></a>  <span class="at">header =</span> tags<span class="sc">$</span><span class="fu">div</span>(</span>
<span id="cb11-24"><a></a>    <span class="at">style =</span> <span class="st">"display: flex; justify-content: flex-end; padding: 5px;"</span>,</span>
<span id="cb11-25"><a></a>    <span class="fu">materialSwitch</span>(</span>
<span id="cb11-26"><a></a>      <span class="at">inputId =</span> <span class="st">"dark_mode"</span>,</span>
<span id="cb11-27"><a></a>      <span class="at">label =</span> <span class="fu">span</span>(<span class="fu">icon</span>(<span class="st">"moon"</span>), <span class="st">"Dark Mode"</span>),</span>
<span id="cb11-28"><a></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb11-29"><a></a>      <span class="at">right =</span> <span class="cn">TRUE</span></span>
<span id="cb11-30"><a></a>    )</span>
<span id="cb11-31"><a></a>  ),</span>
<span id="cb11-32"><a></a>  </span>
<span id="cb11-33"><a></a>  <span class="at">sidebar =</span> <span class="fu">sidebar</span>(</span>
<span id="cb11-34"><a></a>    <span class="at">title =</span> <span class="fu">span</span>(<span class="fu">icon</span>(<span class="st">"gear"</span>), <span class="st">"Settings"</span>),</span>
<span id="cb11-35"><a></a>    <span class="at">width =</span> <span class="dv">440</span>, <span class="co"># Increased width </span></span>
<span id="cb11-36"><a></a>    </span>
<span id="cb11-37"><a></a>    <span class="fu">dateRangeInput</span>(</span>
<span id="cb11-38"><a></a>      <span class="st">"date_range"</span>,</span>
<span id="cb11-39"><a></a>      <span class="st">"Select date range:"</span>,</span>
<span id="cb11-40"><a></a>      <span class="at">start =</span> <span class="fu">Sys.Date</span>() <span class="sc">-</span> <span class="dv">365</span>,</span>
<span id="cb11-41"><a></a>      <span class="at">end =</span> <span class="fu">Sys.Date</span>(),</span>
<span id="cb11-42"><a></a>      <span class="at">min =</span> <span class="st">"2015-01-01"</span>,</span>
<span id="cb11-43"><a></a>      <span class="at">max =</span> <span class="fu">Sys.Date</span>()</span>
<span id="cb11-44"><a></a>    ),</span>
<span id="cb11-45"><a></a>    </span>
<span id="cb11-46"><a></a>    <span class="fu">hr</span>(),</span>
<span id="cb11-47"><a></a>    </span>
<span id="cb11-48"><a></a>    <span class="co"># Use dropdownButton for stock selection</span></span>
<span id="cb11-49"><a></a>    <span class="fu">dropdownButton</span>(</span>
<span id="cb11-50"><a></a>      <span class="at">inputId =</span> <span class="st">"dropdown_stocks"</span>,</span>
<span id="cb11-51"><a></a>      <span class="at">label =</span> <span class="fu">span</span>(<span class="fu">icon</span>(<span class="st">"filter"</span>), <span class="st">"Select Stocks"</span>), </span>
<span id="cb11-52"><a></a>      <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb11-53"><a></a>      <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb11-54"><a></a>      <span class="at">circle =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-55"><a></a>      </span>
<span id="cb11-56"><a></a>      <span class="co"># Stock selector with search functionality</span></span>
<span id="cb11-57"><a></a>      <span class="fu">pickerInput</span>(</span>
<span id="cb11-58"><a></a>        <span class="at">inputId =</span> <span class="st">"stock_selector"</span>,</span>
<span id="cb11-59"><a></a>        <span class="at">label =</span> <span class="st">"Select Stocks:"</span>,</span>
<span id="cb11-60"><a></a>        <span class="at">choices =</span> ticker_choices,</span>
<span id="cb11-61"><a></a>        <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb11-62"><a></a>          <span class="st">`</span><span class="at">actions-box</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-63"><a></a>          <span class="st">`</span><span class="at">live-search</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-64"><a></a>          <span class="st">`</span><span class="at">selected-text-format</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"count &gt; 3"</span>,</span>
<span id="cb11-65"><a></a>          <span class="st">`</span><span class="at">count-selected-text</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"{0} stocks selected"</span></span>
<span id="cb11-66"><a></a>        ),</span>
<span id="cb11-67"><a></a>        <span class="at">selected =</span> <span class="cn">NULL</span>, <span class="co"># Default to no selection</span></span>
<span id="cb11-68"><a></a>        <span class="at">multiple =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-69"><a></a>        <span class="at">width =</span> <span class="st">"100%"</span></span>
<span id="cb11-70"><a></a>      )</span>
<span id="cb11-71"><a></a>    ),</span>
<span id="cb11-72"><a></a>    </span>
<span id="cb11-73"><a></a>    <span class="fu">hr</span>(),</span>
<span id="cb11-74"><a></a>    </span>
<span id="cb11-75"><a></a>    <span class="co"># Submit button that triggers the data update</span></span>
<span id="cb11-76"><a></a>    <span class="fu">actionButton</span>(</span>
<span id="cb11-77"><a></a>      <span class="st">"submit_btn"</span>, </span>
<span id="cb11-78"><a></a>      <span class="fu">span</span>(<span class="fu">icon</span>(<span class="st">"paper-plane"</span>), <span class="st">"Submit List"</span>),</span>
<span id="cb11-79"><a></a>      <span class="at">width =</span> <span class="st">"100%"</span>,</span>
<span id="cb11-80"><a></a>      <span class="at">class =</span> <span class="st">"btn-primary"</span></span>
<span id="cb11-81"><a></a>    )</span>
<span id="cb11-82"><a></a>  ),</span>
<span id="cb11-83"><a></a>  </span>
<span id="cb11-84"><a></a>  <span class="fu">card</span>(</span>
<span id="cb11-85"><a></a>    <span class="at">full_screen =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-86"><a></a>    <span class="fu">card_header</span>(</span>
<span id="cb11-87"><a></a>      <span class="fu">div</span>(</span>
<span id="cb11-88"><a></a>        <span class="at">style =</span> <span class="st">"display: flex; justify-content: space-between; align-items: center;"</span>,</span>
<span id="cb11-89"><a></a>        <span class="fu">span</span>(<span class="st">"Cumulative Returns Comparison"</span>),</span>
<span id="cb11-90"><a></a>        <span class="fu">downloadButton</span>(<span class="st">"download_data"</span>, <span class="st">"Download Data"</span>, <span class="at">class =</span> <span class="st">"btn-sm btn-outline-primary"</span>)</span>
<span id="cb11-91"><a></a>      )</span>
<span id="cb11-92"><a></a>    ),</span>
<span id="cb11-93"><a></a>    <span class="fu">highchartOutput</span>(<span class="st">"returns_plot"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb11-94"><a></a>  ),</span>
<span id="cb11-95"><a></a>  </span>
<span id="cb11-96"><a></a>  <span class="fu">card</span>(</span>
<span id="cb11-97"><a></a>    <span class="fu">card_header</span>(<span class="st">"Performance Summary"</span>),</span>
<span id="cb11-98"><a></a>    <span class="fu">dataTableOutput</span>(<span class="st">"data_summary"</span>)</span>
<span id="cb11-99"><a></a>  )</span>
<span id="cb11-100"><a></a>)</span>
<span id="cb11-101"><a></a></span>
<span id="cb11-102"><a></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb11-103"><a></a>  <span class="co"># Toggle dark mode when the switch is clicked</span></span>
<span id="cb11-104"><a></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>dark_mode, {</span>
<span id="cb11-105"><a></a>    <span class="cf">if</span> (input<span class="sc">$</span>dark_mode) {</span>
<span id="cb11-106"><a></a>      session<span class="sc">$</span><span class="fu">setCurrentTheme</span>(<span class="fu">bs_theme</span>(<span class="at">version =</span> <span class="dv">5</span>, <span class="at">preset =</span> <span class="st">"darkly"</span>))</span>
<span id="cb11-107"><a></a>    } <span class="cf">else</span> {</span>
<span id="cb11-108"><a></a>      session<span class="sc">$</span><span class="fu">setCurrentTheme</span>(<span class="fu">bs_theme</span>(<span class="at">version =</span> <span class="dv">5</span>, <span class="at">preset =</span> <span class="st">"default"</span>))</span>
<span id="cb11-109"><a></a>    }</span>
<span id="cb11-110"><a></a>  })</span>
<span id="cb11-111"><a></a>  </span>
<span id="cb11-112"><a></a>  <span class="co"># Reactive values to store selected stocks</span></span>
<span id="cb11-113"><a></a>  selected_stocks <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="cn">NULL</span>)</span>
<span id="cb11-114"><a></a>  </span>
<span id="cb11-115"><a></a>  <span class="co"># Only update the stocks to fetch when the submit button is clicked</span></span>
<span id="cb11-116"><a></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>submit_btn, {</span>
<span id="cb11-117"><a></a>    <span class="co"># Show a SweetAlert notification</span></span>
<span id="cb11-118"><a></a>    <span class="fu">sendSweetAlert</span>(</span>
<span id="cb11-119"><a></a>      <span class="at">session =</span> session,</span>
<span id="cb11-120"><a></a>      <span class="at">title =</span> <span class="st">"List Submitted"</span>, </span>
<span id="cb11-121"><a></a>      <span class="at">text =</span> <span class="st">"Your stock list has been submitted. Results will appear soon."</span>,</span>
<span id="cb11-122"><a></a>      <span class="at">type =</span> <span class="st">"success"</span>,</span>
<span id="cb11-123"><a></a>      <span class="at">timer =</span> <span class="dv">3000</span>,</span>
<span id="cb11-124"><a></a>      <span class="at">showConfirmButton =</span> <span class="cn">FALSE</span></span>
<span id="cb11-125"><a></a>    )</span>
<span id="cb11-126"><a></a>    </span>
<span id="cb11-127"><a></a>    <span class="co"># Update the selected stocks</span></span>
<span id="cb11-128"><a></a>    <span class="fu">selected_stocks</span>(input<span class="sc">$</span>stock_selector)</span>
<span id="cb11-129"><a></a>  })</span>
<span id="cb11-130"><a></a>  </span>
<span id="cb11-131"><a></a>  <span class="co"># Get full list of stocks to retrieve</span></span>
<span id="cb11-132"><a></a>  stocks_to_get <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-133"><a></a>    stocks <span class="ot">&lt;-</span> <span class="fu">selected_stocks</span>()</span>
<span id="cb11-134"><a></a>    </span>
<span id="cb11-135"><a></a>    <span class="co"># Ensure we have at least one stock to display</span></span>
<span id="cb11-136"><a></a>    <span class="cf">if</span> (<span class="fu">length</span>(stocks) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-137"><a></a>      <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb11-138"><a></a>    }</span>
<span id="cb11-139"><a></a>    </span>
<span id="cb11-140"><a></a>    <span class="fu">return</span>(stocks)</span>
<span id="cb11-141"><a></a>  })</span>
<span id="cb11-142"><a></a>  </span>
<span id="cb11-143"><a></a>  <span class="co"># Reactive expression to get and process stock data</span></span>
<span id="cb11-144"><a></a>  stock_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-145"><a></a>    <span class="co"># Validate that we have dates and stocks</span></span>
<span id="cb11-146"><a></a>    <span class="fu">req</span>(input<span class="sc">$</span>date_range)</span>
<span id="cb11-147"><a></a>    <span class="fu">req</span>(<span class="fu">length</span>(<span class="fu">stocks_to_get</span>()) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-148"><a></a>    </span>
<span id="cb11-149"><a></a>    <span class="co"># Download data</span></span>
<span id="cb11-150"><a></a>    tq_data <span class="ot">&lt;-</span> <span class="fu">tq_get</span>(</span>
<span id="cb11-151"><a></a>      <span class="fu">stocks_to_get</span>(),</span>
<span id="cb11-152"><a></a>      <span class="at">from =</span> input<span class="sc">$</span>date_range[<span class="dv">1</span>],</span>
<span id="cb11-153"><a></a>      <span class="at">to =</span> input<span class="sc">$</span>date_range[<span class="dv">2</span>],</span>
<span id="cb11-154"><a></a>      <span class="at">get =</span> <span class="st">"stock.prices"</span></span>
<span id="cb11-155"><a></a>    )</span>
<span id="cb11-156"><a></a>    </span>
<span id="cb11-157"><a></a>    <span class="co"># Check if we got data</span></span>
<span id="cb11-158"><a></a>    <span class="fu">req</span>(<span class="fu">nrow</span>(tq_data) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-159"><a></a>    </span>
<span id="cb11-160"><a></a>    <span class="co"># Calculate returns</span></span>
<span id="cb11-161"><a></a>    returns_data <span class="ot">&lt;-</span> tq_data <span class="sc">%&gt;%</span></span>
<span id="cb11-162"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb11-163"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb11-164"><a></a>      <span class="co"># Calculate daily returns</span></span>
<span id="cb11-165"><a></a>      <span class="fu">tq_transmute</span>(</span>
<span id="cb11-166"><a></a>        <span class="at">select =</span> adjusted,</span>
<span id="cb11-167"><a></a>        <span class="at">mutate_fun =</span> periodReturn,</span>
<span id="cb11-168"><a></a>        <span class="at">period =</span> <span class="st">"daily"</span>,</span>
<span id="cb11-169"><a></a>        <span class="at">col_rename =</span> <span class="st">"daily_return"</span></span>
<span id="cb11-170"><a></a>      ) </span>
<span id="cb11-171"><a></a>    </span>
<span id="cb11-172"><a></a>    <span class="co"># Join the returns data with original price data</span></span>
<span id="cb11-173"><a></a>    returns_with_prices <span class="ot">&lt;-</span> returns_data <span class="sc">%&gt;%</span></span>
<span id="cb11-174"><a></a>      <span class="fu">left_join</span>(</span>
<span id="cb11-175"><a></a>        tq_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(symbol, date, adjusted),</span>
<span id="cb11-176"><a></a>        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"symbol"</span>, <span class="st">"date"</span>)</span>
<span id="cb11-177"><a></a>      )</span>
<span id="cb11-178"><a></a>    </span>
<span id="cb11-179"><a></a>    <span class="co"># Calculate cumulative returns from the first date of the period</span></span>
<span id="cb11-180"><a></a>    cum_returns <span class="ot">&lt;-</span> returns_with_prices <span class="sc">%&gt;%</span></span>
<span id="cb11-181"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb11-182"><a></a>      <span class="fu">arrange</span>(date) <span class="sc">%&gt;%</span></span>
<span id="cb11-183"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb11-184"><a></a>        <span class="co"># For each stock, calculate the cumulative return starting from the first date</span></span>
<span id="cb11-185"><a></a>        <span class="at">cumulative_return =</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> daily_return) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb11-186"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb11-187"><a></a>      <span class="fu">ungroup</span>()</span>
<span id="cb11-188"><a></a>    </span>
<span id="cb11-189"><a></a>    <span class="fu">list</span>(</span>
<span id="cb11-190"><a></a>      <span class="at">raw_data =</span> tq_data,</span>
<span id="cb11-191"><a></a>      <span class="at">cum_returns =</span> cum_returns</span>
<span id="cb11-192"><a></a>    )</span>
<span id="cb11-193"><a></a>  })</span>
<span id="cb11-194"><a></a>  </span>
<span id="cb11-195"><a></a>  <span class="co"># Create downloadable data</span></span>
<span id="cb11-196"><a></a>  downloadable_data <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-197"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb11-198"><a></a>    </span>
<span id="cb11-199"><a></a>    <span class="co"># Format the cumulative returns data for download</span></span>
<span id="cb11-200"><a></a>    download_data <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb11-201"><a></a>      <span class="fu">select</span>(symbol, date, cumulative_return) <span class="sc">%&gt;%</span></span>
<span id="cb11-202"><a></a>      <span class="fu">pivot_wider</span>(</span>
<span id="cb11-203"><a></a>        <span class="at">names_from =</span> symbol,</span>
<span id="cb11-204"><a></a>        <span class="at">values_from =</span> cumulative_return,</span>
<span id="cb11-205"><a></a>        <span class="at">names_prefix =</span> <span class="st">"return_"</span></span>
<span id="cb11-206"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb11-207"><a></a>      <span class="fu">arrange</span>(date)</span>
<span id="cb11-208"><a></a>    </span>
<span id="cb11-209"><a></a>    <span class="fu">return</span>(download_data)</span>
<span id="cb11-210"><a></a>  })</span>
<span id="cb11-211"><a></a>  </span>
<span id="cb11-212"><a></a>  <span class="co"># Get company names for better labels</span></span>
<span id="cb11-213"><a></a>  stock_names <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb11-214"><a></a>    <span class="co"># Create lookup from sp500 stocks</span></span>
<span id="cb11-215"><a></a>    name_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(sp500_stocks<span class="sc">$</span>company, sp500_stocks<span class="sc">$</span>symbol)</span>
<span id="cb11-216"><a></a>    </span>
<span id="cb11-217"><a></a>    <span class="co"># Return</span></span>
<span id="cb11-218"><a></a>    name_lookup</span>
<span id="cb11-219"><a></a>  })</span>
<span id="cb11-220"><a></a>  </span>
<span id="cb11-221"><a></a>  <span class="co"># Generate returns plot with highcharter</span></span>
<span id="cb11-222"><a></a>  output<span class="sc">$</span>returns_plot <span class="ot">&lt;-</span> <span class="fu">renderHighchart</span>({</span>
<span id="cb11-223"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb11-224"><a></a>    </span>
<span id="cb11-225"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb11-226"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb11-227"><a></a>    </span>
<span id="cb11-228"><a></a>    <span class="co"># Convert to format suitable for highcharter</span></span>
<span id="cb11-229"><a></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(cum_returns) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb11-230"><a></a>      <span class="co"># Create highchart</span></span>
<span id="cb11-231"><a></a>      hc <span class="ot">&lt;-</span> <span class="fu">highchart</span>(<span class="at">type =</span> <span class="st">"stock"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-232"><a></a>        <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"Cumulative Returns Comparison"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-233"><a></a>        <span class="fu">hc_xAxis</span>(<span class="at">type =</span> <span class="st">"datetime"</span>, </span>
<span id="cb11-234"><a></a>                 <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Date"</span>),</span>
<span id="cb11-235"><a></a>                 <span class="at">dateTimeLabelFormats =</span> <span class="fu">list</span>(</span>
<span id="cb11-236"><a></a>                   <span class="at">day =</span> <span class="st">'%e of %b'</span>,</span>
<span id="cb11-237"><a></a>                   <span class="at">month =</span> <span class="st">'%b %Y'</span>,</span>
<span id="cb11-238"><a></a>                   <span class="at">year =</span> <span class="st">'%Y'</span></span>
<span id="cb11-239"><a></a>                 )) <span class="sc">%&gt;%</span></span>
<span id="cb11-240"><a></a>        <span class="fu">hc_yAxis</span>(</span>
<span id="cb11-241"><a></a>          <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Cumulative Return"</span>),</span>
<span id="cb11-242"><a></a>          <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">formatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return (this.value * 100).toFixed(2) + '%'; }"</span>))</span>
<span id="cb11-243"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb11-244"><a></a>        <span class="fu">hc_tooltip</span>(</span>
<span id="cb11-245"><a></a>          <span class="at">headerFormat =</span> <span class="st">'&lt;span style="font-size: 10px"&gt;{point.key}&lt;/span&gt;&lt;br/&gt;'</span>,</span>
<span id="cb11-246"><a></a>          <span class="at">pointFormatter =</span> <span class="fu">JS</span>(<span class="st">"function() { return '&lt;span style=</span><span class="sc">\"</span><span class="st">color:' + this.color + '</span><span class="sc">\"</span><span class="st">&gt;●&lt;/span&gt; &lt;b&gt;' + this.series.name + '&lt;/b&gt;: &lt;b&gt;' + (this.y * 100).toFixed(2) + '%&lt;/b&gt;&lt;br/&gt;'; }"</span>),</span>
<span id="cb11-247"><a></a>          <span class="at">shared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb11-248"><a></a>          <span class="at">crosshairs =</span> <span class="cn">TRUE</span></span>
<span id="cb11-249"><a></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb11-250"><a></a>        <span class="fu">hc_plotOptions</span>(<span class="at">series =</span> <span class="fu">list</span>(</span>
<span id="cb11-251"><a></a>          <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>),</span>
<span id="cb11-252"><a></a>          <span class="at">states =</span> <span class="fu">list</span>(<span class="at">hover =</span> <span class="fu">list</span>(<span class="at">lineWidthPlus =</span> <span class="dv">0</span>)),</span>
<span id="cb11-253"><a></a>          <span class="at">lineWidth =</span> <span class="dv">3</span>  <span class="co"># Increased line thickness</span></span>
<span id="cb11-254"><a></a>        )) <span class="sc">%&gt;%</span></span>
<span id="cb11-255"><a></a>        <span class="fu">hc_legend</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-256"><a></a>      </span>
<span id="cb11-257"><a></a>      <span class="co"># Add data for each stock</span></span>
<span id="cb11-258"><a></a>      <span class="cf">for</span>(stock <span class="cf">in</span> <span class="fu">unique</span>(cum_returns<span class="sc">$</span>symbol)) {</span>
<span id="cb11-259"><a></a>        stock_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb11-260"><a></a>          <span class="fu">filter</span>(symbol <span class="sc">==</span> stock) <span class="sc">%&gt;%</span></span>
<span id="cb11-261"><a></a>          <span class="fu">select</span>(date, cumulative_return)</span>
<span id="cb11-262"><a></a>        </span>
<span id="cb11-263"><a></a>        <span class="co"># Format data for highcharter - simplified approach</span></span>
<span id="cb11-264"><a></a>        hc_data <span class="ot">&lt;-</span> stock_data <span class="sc">%&gt;%</span></span>
<span id="cb11-265"><a></a>          <span class="fu">mutate</span>(</span>
<span id="cb11-266"><a></a>            <span class="at">x =</span> <span class="fu">datetime_to_timestamp</span>(date),</span>
<span id="cb11-267"><a></a>            <span class="at">y =</span> cumulative_return  <span class="co"># Keep as decimal for proper calculations</span></span>
<span id="cb11-268"><a></a>          ) <span class="sc">%&gt;%</span></span>
<span id="cb11-269"><a></a>          <span class="fu">select</span>(x, y) <span class="sc">%&gt;%</span></span>
<span id="cb11-270"><a></a>          <span class="fu">list_parse2</span>()</span>
<span id="cb11-271"><a></a>        </span>
<span id="cb11-272"><a></a>        <span class="co"># Add series to chart - only use the ticker symbol in the name</span></span>
<span id="cb11-273"><a></a>        hc <span class="ot">&lt;-</span> hc <span class="sc">%&gt;%</span></span>
<span id="cb11-274"><a></a>          <span class="fu">hc_add_series</span>(</span>
<span id="cb11-275"><a></a>            <span class="at">data =</span> hc_data,</span>
<span id="cb11-276"><a></a>            <span class="at">name =</span> stock,</span>
<span id="cb11-277"><a></a>            <span class="at">type =</span> <span class="st">"line"</span></span>
<span id="cb11-278"><a></a>          )</span>
<span id="cb11-279"><a></a>      }</span>
<span id="cb11-280"><a></a>      </span>
<span id="cb11-281"><a></a>      <span class="co"># Return the chart</span></span>
<span id="cb11-282"><a></a>      hc</span>
<span id="cb11-283"><a></a>    }</span>
<span id="cb11-284"><a></a>  })</span>
<span id="cb11-285"><a></a>  </span>
<span id="cb11-286"><a></a>  <span class="co"># Generate data summary</span></span>
<span id="cb11-287"><a></a>  output<span class="sc">$</span>data_summary <span class="ot">&lt;-</span> <span class="fu">renderDataTable</span>({</span>
<span id="cb11-288"><a></a>    <span class="fu">req</span>(<span class="fu">stock_data</span>())</span>
<span id="cb11-289"><a></a>    </span>
<span id="cb11-290"><a></a>    cum_returns <span class="ot">&lt;-</span> <span class="fu">stock_data</span>()<span class="sc">$</span>cum_returns</span>
<span id="cb11-291"><a></a>    names_lookup <span class="ot">&lt;-</span> <span class="fu">stock_names</span>()</span>
<span id="cb11-292"><a></a>    </span>
<span id="cb11-293"><a></a>    <span class="co"># Summary statistics for each asset</span></span>
<span id="cb11-294"><a></a>    summary_data <span class="ot">&lt;-</span> cum_returns <span class="sc">%&gt;%</span></span>
<span id="cb11-295"><a></a>      <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span></span>
<span id="cb11-296"><a></a>      <span class="fu">summarize</span>(</span>
<span id="cb11-297"><a></a>        <span class="at">Start_Date =</span> <span class="fu">min</span>(date),</span>
<span id="cb11-298"><a></a>        <span class="at">End_Date =</span> <span class="fu">max</span>(date),</span>
<span id="cb11-299"><a></a>        <span class="at">Total_Return =</span> <span class="fu">last</span>(cumulative_return) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb11-300"><a></a>        <span class="at">Annualized_Return =</span> ((<span class="dv">1</span> <span class="sc">+</span> <span class="fu">last</span>(cumulative_return))<span class="sc">^</span>(<span class="dv">252</span> <span class="sc">/</span> <span class="fu">n</span>())) <span class="sc">-</span> <span class="dv">1</span> <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>),</span>
<span id="cb11-301"><a></a>        <span class="at">Volatility =</span> <span class="fu">sd</span>(daily_return, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">252</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">4</span>)</span>
<span id="cb11-302"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb11-303"><a></a>      <span class="fu">mutate</span>(</span>
<span id="cb11-304"><a></a>        <span class="at">Company =</span> <span class="fu">ifelse</span>(symbol <span class="sc">%in%</span> <span class="fu">names</span>(names_lookup), names_lookup[symbol], symbol),</span>
<span id="cb11-305"><a></a>        <span class="at">Total_Return =</span> <span class="fu">percent</span>(Total_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb11-306"><a></a>        <span class="at">Annualized_Return =</span> <span class="fu">percent</span>(Annualized_Return, <span class="at">accuracy =</span> <span class="fl">0.01</span>),</span>
<span id="cb11-307"><a></a>        <span class="at">Volatility =</span> <span class="fu">percent</span>(Volatility, <span class="at">accuracy =</span> <span class="fl">0.01</span>)</span>
<span id="cb11-308"><a></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb11-309"><a></a>      <span class="fu">select</span>(</span>
<span id="cb11-310"><a></a>        <span class="at">Symbol =</span> symbol, </span>
<span id="cb11-311"><a></a>        Company, </span>
<span id="cb11-312"><a></a>        <span class="st">`</span><span class="at">Start Date</span><span class="st">`</span> <span class="ot">=</span> Start_Date, </span>
<span id="cb11-313"><a></a>        <span class="st">`</span><span class="at">End Date</span><span class="st">`</span> <span class="ot">=</span> End_Date, </span>
<span id="cb11-314"><a></a>        <span class="st">`</span><span class="at">Total Return</span><span class="st">`</span> <span class="ot">=</span> Total_Return, </span>
<span id="cb11-315"><a></a>        <span class="st">`</span><span class="at">Annualized Return</span><span class="st">`</span> <span class="ot">=</span> Annualized_Return, </span>
<span id="cb11-316"><a></a>        Volatility</span>
<span id="cb11-317"><a></a>      )</span>
<span id="cb11-318"><a></a>  })</span>
<span id="cb11-319"><a></a>  </span>
<span id="cb11-320"><a></a>  <span class="co"># Download handler for CSV export</span></span>
<span id="cb11-321"><a></a>  output<span class="sc">$</span>download_data <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb11-322"><a></a>    <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb11-323"><a></a>      <span class="fu">paste</span>(<span class="st">"sp500_returns_"</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">"%Y%m%d"</span>), <span class="st">".csv"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb11-324"><a></a>    },</span>
<span id="cb11-325"><a></a>    <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb11-326"><a></a>      <span class="fu">write.csv</span>(<span class="fu">downloadable_data</span>(), file, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-327"><a></a>    }</span>
<span id="cb11-328"><a></a>  )</span>
<span id="cb11-329"><a></a></span>
<span id="cb11-330"><a></a>}</span>
<span id="cb11-331"><a></a>  </span>
<span id="cb11-332"><a></a><span class="fu">shinyApp</span>(ui, server)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="hosting-shiny-applications" class="slide level2">
<h2>Hosting Shiny Applications</h2>
<ul>
<li><p><span class="blue"><strong>Way to go</strong></span><strong>: you just did your very first app!</strong></p></li>
<li><p>Now, the question is… <span class="blue">how can you share that with your audience?</span> Luckily, there are several ways in which you can host your application<sup>1</sup>:</p></li>
</ul>
<ol type="1">
<li><p><strong>shinyapps.io</strong> (by <em>Posit</em>): by and large, this is the easiest option for hosting Shiny apps for beginners. Fully managed, no server setup required</p></li>
<li><p><strong>Posit Connect</strong>: enterprise-grade publishing platform, supports Shiny (<code>R</code> and <code>Python</code>), Quarto, Dash, Flask, and more. It offers authentication, scheduled reports, and usage analytics. Suitable for internal tools and collaborative data products</p></li>
<li><p><strong>Docker</strong>: containerize Shiny apps for portability and reproducibility. Useful for deployment in Kubernetes or cloud-native environments. Can be combined with CI/CD workflows</p></li>
</ol>
<aside><ol class="aside-footnotes"><li id="fn1"><p>For detailed content, please refer to a discussion regarding hosting options <a href="https://shiny.posit.co/r/deploy.html">here</a>.</p></li></ol></aside></section>
<section id="hosting-our-application" class="slide level2">
<h2>Hosting our application</h2>
<ul>
<li><p>Using the <span class="blue">first</span> option for deployment, inside your <em>RStudio</em> session, hit <span class="blue">Publish</span> and then select <em>shinyapps.io</em>. This option prompts a screen where you can log into your account. You can create a free account and host a limited number of applications in a free-tier option</p></li>
<li><p>After following the instructions, you should see your app going live on the internet straight from <em>RStudio</em>’s command line:</p></li>
</ul>
<div class="fragment">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="Images/F1.png" class="quarto-figure quarto-figure-center" style="width:35.0%"></p>
</figure>
</div>
<ul>
<li><strong>Curious to see the outcome?</strong> Check the live app <a href="https://lsmacoris.shinyapps.io/my_test_app/">here</a></li>
</ul>
</div>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>

<div class="quarto-auto-generated-content">
<p><img src="Images/logo.jpg" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://lsmacoris.github.io/">@ Website</a> | <a href="https://lsmacoris.github.io/lectures/quant-fin">@ Slides</a> | <a href="https://calendly.com/lucas-macoris-fgv/appointment-lsm">@ Office-hour appointments</a></p>
</div>
</div>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-shiny" class="csl-entry" role="listitem">
Wickham, Hadley. 2021. <em>Mastering Shiny</em>. O’Reilly Media. <a href="https://mastering-shiny.org/">https://mastering-shiny.org/</a>.
</div>
<div id="ref-r4ds" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Cetinkaya-Rundel, and Garrett Grolemund. 2023. <em><span>R</span> for Data Science</em>. O’Reilly Media. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.
</div>
</div>
</section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp("https:\/\/lsmacoris\.github\.io\/lectures");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>