<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lucas S. Macoris">

<title>index â€“ Lucas S. Macoris</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-87FLN5SXEJ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-87FLN5SXEJ', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Lucas S. Macoris</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://lsmacoris.github.io/"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Overview</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../fin-mgmt.html"> 
<span class="menu-text">Financial Management</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../fin-strat.html"> 
<span class="menu-text">Financial Strategy</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../quant-fin.html"> 
<span class="menu-text">Quantitative Finance</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../quant-mkt.html"> 
<span class="menu-text">Quantitative Methods</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lsmacoris"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:lucasmacoris@gmail.com"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/lucas-macoris-390a47160/"> <i class="bi bi-linkedin" role="img" aria-label="LinkedIn">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://drive.google.com/file/d/184m-BDeB-31SSyEuzqINco2UzqRFXhma/view?usp=drive_link"> <i class="bi bi-file-pdf" role="img" aria-label="CV">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lucas S. Macoris </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="welcome-to-the-course" class="level1">
<h1>Welcome to the course!</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Use knitr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="how-to-use-these-slides" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-these-slides">How to use these slides</h2>
<ul>
<li><p>These slides leverage <a href="quarto.org">Quarto</a>, an open-source scientific and technical publishing system from Posit (formerly RStudio):</p>
<ol type="1">
<li>Create dynamic content with <span class="focus">Python, R, Julia</span>, and <span class="focus">Observable</span></li>
<li>Publish reproducible, production quality articles, presentations, dashboards, websites, blogs, and books in HTML, PDF, MS Word, ePub, and more</li>
<li>Write using Pandoc markdown, including equations, citations, crossrefs, figure panels, callouts, advanced layout, and more.</li>
</ol></li>
<li><p>For our course, weâ€™ll use the following notation:</p></li>
</ul>
<ol type="1">
<li>Link will be colored in <a href="https://google.com">dark-orange</a></li>
<li>Inline equations and variables will be rendered in <code>gray</code></li>
<li>Code chunks will be provided along with outputs (in <code>Python</code>)</li>
</ol>
</section>
<section id="an-example-of-a-code-chunk" class="level2">
<h2 class="anchored" data-anchor-id="an-example-of-a-code-chunk">An example of a code chunk</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Results</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generating data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> pd.DataFrame({</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cond'</span>: np.repeat([<span class="st">'A'</span>, <span class="st">'B'</span>], <span class="dv">10</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xvar'</span>: np.arange(<span class="dv">1</span>, <span class="dv">21</span>) <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">20</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'yvar'</span>: np.arange(<span class="dv">1</span>, <span class="dv">21</span>) <span class="op">+</span> np.random.normal(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">20</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>theme_plots<span class="op">=</span> theme(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  legend_position<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  axis_title<span class="op">=</span>element_text(face<span class="op">=</span><span class="st">'bold'</span>,size<span class="op">=</span><span class="dv">10</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  plot_title<span class="op">=</span>element_text(face<span class="op">=</span><span class="st">'bold'</span>,size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>Plot<span class="op">=</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  ggplot(dat,aes(x<span class="op">=</span><span class="st">'xvar'</span>,y<span class="op">=</span><span class="st">'yvar'</span>,fill<span class="op">=</span><span class="st">'cond'</span>,color<span class="op">=</span><span class="st">'cond'</span>))<span class="op">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>              geom_point()<span class="op">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>              labs(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>              title <span class="op">=</span> <span class="st">'An example of charting using the plotnine package'</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>              subtitle <span class="op">=</span> <span class="st">'Randomly generated data'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>              x <span class="op">=</span> <span class="st">'X Variable'</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>              y <span class="op">=</span> <span class="st">'Y Variable'</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> scale_y_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">5</span>))</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> scale_x_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="op">-</span><span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">5</span>))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> theme_minimal()</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">+</span> theme_plots</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="course-outline" class="level2">
<h2 class="anchored" data-anchor-id="course-outline">Course Outline</h2>
<ul>
<li><p>Weâ€™ll cover the <span class="focus">first section</span> of course, which contemplates <span class="focus">choice models</span>:</p>
<ol type="1">
<li>Binary Response Models: <em>Logit</em>/<em>Probit</em></li>
<li>Multi-choice Models: <em>Multinomial Logit</em></li>
<li>Economic Implications of multi-choice models</li>
<li>Market-basket Analysis</li>
</ol></li>
<li><p>Weâ€™ll keep a <span class="focus">hands-on</span> approach to be best of our capabilities, with handout exercises (code + analysis) and focus on practical applications</p></li>
<li><p>Evaluation (first section) will consist of:</p>
<ol type="1">
<li>Code coursework (<a href="https://datacamp.com">DataCamp</a>)</li>
<li>Handout Exercise (deadline TBD)</li>
</ol></li>
<li><p>You can download a notebook covering this first lecture using <a href="https://drive.google.com/file/d/1czHPRZ6t5_jBcLKHJrv5eO8F4CjT4oVY/view?usp=drive_link">this</a> link and the dataset using <a href="https://drive.google.com/file/d/12pKTORubx5win6TCGw7sww2tr9XLdUj0/view?usp=drive_link">here</a></p></li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Our first section of the <em>Marketing Analytics</em> course will focus on the main applications from a practical standpoint</li>
</ul>
<ol type="1">
<li>For a detailed discussion on the methodological approaches undertaken throughout the lectures, weâ€™ll follow:</li>
</ol>
<ol type="a">
<li><em>Discrete Choice Methods with Simulation</em> - <span class="citation" data-cites="Train">@Train</span></li>
<li><em>Econometric Analysis</em> - <span class="citation" data-cites="Greene">@Greene</span></li>
<li><em>Econometrics</em> - <span class="citation" data-cites="Hayashi">@Hayashi</span></li>
</ol>
<ol start="2" type="1">
<li>For a broader discussion around the practical applications on Marketing, weâ€™ll follow <span class="citation" data-cites="Chapman">@Chapman</span></li>
</ol>
</section>
<section id="discrete-choice-models" class="level2">
<h2 class="anchored" data-anchor-id="discrete-choice-models">Discrete Choice Models</h2>
<ul>
<li><p>Marketing practitioners are often concerned about consumers decisions around a <em>defined</em> set of choices:</p>
<ol type="1">
<li><p>Consumers choose between a binary decision of <span class="green">buy</span>/<span class="red">not buy</span>, given product, consumer, and environmental characteristics</p></li>
<li><p>Faced with a defined set of products, make a decision around <span class="focus">which</span> products to buy</p></li>
<li><p>After experiencing a flow of consumption from a product or service up to time <span class="math inline">\(t\)</span>, decide whether to <span class="green">continue</span> consumption at <span class="math inline">\(t+1\)</span> or <span class="red">churn</span></p></li>
</ol></li>
<li><p>Eliciting knowledge about individual choices shed light on consumer preferences and help marketers to understand how consumers value certain product attributes</p></li>
<li><p>Aggregating individual choices helps marketers understand how the <span class="focus">demand</span> curve for a given product or industry works</p></li>
</ul>
</section>
<section id="binary-choice-models" class="level2">
<h2 class="anchored" data-anchor-id="binary-choice-models">Binary Choice Models</h2>
<ul>
<li>Motivation: among a <em>defined</em> set of <em>two</em> mutually exclusive alternatives, consumers make a decision by <span class="focus">choosing</span> one alternative in spite of the other:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small
Y_i=\begin{cases}
            1, &amp; \text{if $Y_i$ = a predefined alternative}\\
            0, &amp; \text{otherwise}
         \end{cases}
\]</span></p>
<ul>
<li>These models implicitly tell about consumerâ€™s preferences regarding several consumption decisions. Say that we know that a set <span class="math inline">\(X\)</span> of characteristics (which may be consumer-specific, environmental, or product) affect <span class="math inline">\(i\)</span>â€™s decision. We can then model such decision by:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small Y_i=f(X_i)
\]</span></p>
<ul>
<li>Our starting point will be to define what <span class="math inline">\(f(X)\)</span> should look like. Depending on the shape of this function, the interpretation becomes a <em>probabilistic</em> measurement</li>
</ul>
</section>
<section id="binary-choice-models---application" class="level2">
<h2 class="anchored" data-anchor-id="binary-choice-models---application">Binary Choice Models - Application</h2>
<ul>
<li><p>One of the most widely applicable areas of binary choice modeling refers to <span class="focus">churn</span> modeling: the the percentage of customers who <span class="red">discontinue</span> their use of a businessâ€™s products or services over a certain time period</p></li>
<li><p>This concept is important for businesses because it affects their revenue and offers insights into customer satisfaction and loyalty:</p>
<ol type="1">
<li><p>A high churn rate may suggest there are issues with the product, service, or overall customer experience</p></li>
<li><p>A low churn rate may suggest the existence of customer loyalty, high switching costs, or valuable attributes from the offer</p></li>
</ol></li>
<li><p>Churn modeling offers valuable insights to marketers as it is possible to derive actions <em>ex-ante</em> its occurrence and <span class="green">prevent</span> customers from churning</p></li>
<li><p>This issue becomes more relevant when customer acquisition costs increase</p></li>
</ul>
</section>
<section id="practical-application-outline" class="level2">
<h2 class="anchored" data-anchor-id="practical-application-outline">Practical Application Outline</h2>
<ul>
<li><p>You will use a bank Customer Relationship Manager (CRM) data set comprising of 10,000 bank customers and its actual engagement status (whether or not he/she has <span class="red">churned</span>)</p></li>
<li><p>This data set will be primarily based on <a href="https://www.kaggle.com/code/fekihmea/customer-churn-analysis-pace-strategy/notebook">this</a> <em>Kaggle</em> notebook, although some adaptations have been made for teaching purposes</p></li>
</ul>
</section>
<section id="before-we-start-tech-setup" class="level2">
<h2 class="anchored" data-anchor-id="before-we-start-tech-setup">Before we start: tech-setup</h2>
<ul>
<li><p>Weâ€™ll be running code both using <code>Python</code> All outputs will be shown in the first tabset, with their corresponding code in the subsequent tabsets.</p></li>
<li><p>Before you start, ensure you have installed all the necessary packages: to install all necessary <code>Python</code> libraries, use the terminal to install and then <code>import</code> all packages inside a notebook:</p></li>
</ul>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pip install requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variable-descriptives" class="level2">
<h2 class="anchored" data-anchor-id="variable-descriptives">Variable Descriptives</h2>
<ul>
<li>To begin our investigation, letâ€™s do a simple variable description of the variables that we have in our dataset:</li>
</ul>
<p>. . .</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Summary <span class="op">=</span> Data.drop(<span class="st">'customer_id'</span>,axis<span class="op">=</span><span class="dv">1</span>).describe().reset_index()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the structure of the DataFrame</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Table <span class="op">=</span> (</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  GT(Summary)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  .cols_align(<span class="st">'center'</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"**Summary Statistics**"</span>))</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  .tab_stub(<span class="st">'index'</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns<span class="op">=</span>[<span class="st">'credit_score'</span>,<span class="st">'age'</span>,<span class="st">'tenure'</span>],decimals <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns<span class="op">=</span>[<span class="st">'products_number'</span>,<span class="st">'credit_card'</span>,<span class="st">'active_member'</span>,<span class="st">'churn'</span>],decimals <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  .fmt_currency(columns<span class="op">=</span>[<span class="st">'balance'</span>,<span class="st">'estimated_salary'</span>],decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Output</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>Table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="esauljnznm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#esauljnznm table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#esauljnznm thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#esauljnznm p { margin: 0; padding: 0; }
 #esauljnznm .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A81600; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A81600; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #esauljnznm .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #esauljnznm .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #esauljnznm .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #esauljnznm .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #esauljnznm .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #esauljnznm .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #esauljnznm .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #esauljnznm .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #esauljnznm .gt_column_spanner_outer:first-child { padding-left: 0; }
 #esauljnznm .gt_column_spanner_outer:last-child { padding-right: 0; }
 #esauljnznm .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #esauljnznm .gt_spanner_row { border-bottom-style: hidden; }
 #esauljnznm .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #esauljnznm .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: middle; }
 #esauljnznm .gt_from_md> :first-child { margin-top: 0; }
 #esauljnznm .gt_from_md> :last-child { margin-bottom: 0; }
 #esauljnznm .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #FFCCC7; border-left-style: none; border-left-width: 1px; border-left-color: #FFCCC7; border-right-style: none; border-right-width: 1px; border-right-color: #FFCCC7; vertical-align: middle; overflow-x: hidden; }
 #esauljnznm .gt_stub { color: #FFFFFF; background-color: #E4220C; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #E4220C; padding-left: 5px; padding-right: 5px; }
 #esauljnznm .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #esauljnznm .gt_row_group_first td { border-top-width: 2px; }
 #esauljnznm .gt_row_group_first th { border-top-width: 2px; }
 #esauljnznm .gt_striped { background-color: #F4F4F4; }
 #esauljnznm .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #esauljnznm .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #esauljnznm .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #esauljnznm .gt_left { text-align: left; }
 #esauljnznm .gt_center { text-align: center; }
 #esauljnznm .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #esauljnznm .gt_font_normal { font-weight: normal; }
 #esauljnznm .gt_font_bold { font-weight: bold; }
 #esauljnznm .gt_font_italic { font-style: italic; }
 #esauljnznm .gt_super { font-size: 65%; }
 #esauljnznm .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #esauljnznm .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal"><strong>Summary Statistics</strong></th>
</tr>
<tr class="odd gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="credit_score" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">credit_score</th>
<th id="age" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">age</th>
<th id="tenure" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">tenure</th>
<th id="balance" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">balance</th>
<th id="products_number" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">products_number</th>
<th id="credit_card" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">credit_card</th>
<th id="active_member" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">active_member</th>
<th id="estimated_salary" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">estimated_salary</th>
<th id="churn" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">churn</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">count</td>
<td class="gt_row gt_center">10,000</td>
<td class="gt_row gt_center">10,000</td>
<td class="gt_row gt_center">10,000</td>
<td class="gt_row gt_center">$10,000</td>
<td class="gt_row gt_center">10,000.00</td>
<td class="gt_row gt_center">10,000.00</td>
<td class="gt_row gt_center">10,000.00</td>
<td class="gt_row gt_center">$10,000</td>
<td class="gt_row gt_center">10,000.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">mean</td>
<td class="gt_row gt_center gt_striped">651</td>
<td class="gt_row gt_center gt_striped">39</td>
<td class="gt_row gt_center gt_striped">5</td>
<td class="gt_row gt_center gt_striped">$76</td>
<td class="gt_row gt_center gt_striped">1.53</td>
<td class="gt_row gt_center gt_striped">0.71</td>
<td class="gt_row gt_center gt_striped">0.52</td>
<td class="gt_row gt_center gt_striped">$100</td>
<td class="gt_row gt_center gt_striped">0.20</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">std</td>
<td class="gt_row gt_center">97</td>
<td class="gt_row gt_center">10</td>
<td class="gt_row gt_center">3</td>
<td class="gt_row gt_center">$62</td>
<td class="gt_row gt_center">0.58</td>
<td class="gt_row gt_center">0.46</td>
<td class="gt_row gt_center">0.50</td>
<td class="gt_row gt_center">$58</td>
<td class="gt_row gt_center">0.40</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">min</td>
<td class="gt_row gt_center gt_striped">350</td>
<td class="gt_row gt_center gt_striped">18</td>
<td class="gt_row gt_center gt_striped">0</td>
<td class="gt_row gt_center gt_striped">$0</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">0.00</td>
<td class="gt_row gt_center gt_striped">0.00</td>
<td class="gt_row gt_center gt_striped">$0</td>
<td class="gt_row gt_center gt_striped">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">25%</td>
<td class="gt_row gt_center">584</td>
<td class="gt_row gt_center">32</td>
<td class="gt_row gt_center">3</td>
<td class="gt_row gt_center">$0</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">0.00</td>
<td class="gt_row gt_center">0.00</td>
<td class="gt_row gt_center">$51</td>
<td class="gt_row gt_center">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">50%</td>
<td class="gt_row gt_center gt_striped">652</td>
<td class="gt_row gt_center gt_striped">37</td>
<td class="gt_row gt_center gt_striped">5</td>
<td class="gt_row gt_center gt_striped">$97</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">$100</td>
<td class="gt_row gt_center gt_striped">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">75%</td>
<td class="gt_row gt_center">718</td>
<td class="gt_row gt_center">44</td>
<td class="gt_row gt_center">7</td>
<td class="gt_row gt_center">$128</td>
<td class="gt_row gt_center">2.00</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">1.00</td>
<td class="gt_row gt_center">$149</td>
<td class="gt_row gt_center">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">max</td>
<td class="gt_row gt_center gt_striped">850</td>
<td class="gt_row gt_center gt_striped">92</td>
<td class="gt_row gt_center gt_striped">10</td>
<td class="gt_row gt_center gt_striped">$251</td>
<td class="gt_row gt_center gt_striped">4.00</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">1.00</td>
<td class="gt_row gt_center gt_striped">$200</td>
<td class="gt_row gt_center gt_striped">1.00</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Summary <span class="op">=</span> Data.drop(<span class="st">'customer_id'</span>,axis<span class="op">=</span><span class="dv">1</span>).describe().reset_index()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the structure of the DataFrame</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>Table <span class="op">=</span> (</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  GT(Summary)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  .cols_align(<span class="st">'center'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"**Summary Statistics**"</span>))</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  .tab_stub(<span class="st">'index'</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns<span class="op">=</span>[<span class="st">'credit_score'</span>,<span class="st">'age'</span>,<span class="st">'tenure'</span>],decimals <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns<span class="op">=</span>[<span class="st">'products_number'</span>,<span class="st">'credit_card'</span>,<span class="st">'active_member'</span>,<span class="st">'churn'</span>],decimals <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  .fmt_currency(columns<span class="op">=</span>[<span class="st">'balance'</span>,<span class="st">'estimated_salary'</span>],decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Output</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>Table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="analyzing-churn-distribution" class="level2">
<h2 class="anchored" data-anchor-id="analyzing-churn-distribution">Analyzing churn distribution</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select numeric columns and calculate correlation with churn</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="op">=</span> (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  Data</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  .select_dtypes(include<span class="op">=</span><span class="st">'number'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  .corr()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  .iloc[:<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  .reset_index()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>correlation_df.columns <span class="op">=</span> [<span class="st">'Variable'</span>, <span class="st">'Correlation'</span>]</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 'Sign' column based on correlation values</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>correlation_df[<span class="st">'Sign'</span>] <span class="op">=</span> correlation_df[<span class="st">'Correlation'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Positive'</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Negative'</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Chart</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  ggplot(correlation_df, aes(x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Correlation'</span>, fill<span class="op">=</span><span class="st">'Sign'</span>))<span class="op">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  geom_col()<span class="op">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  geom_text(aes(label<span class="op">=</span>correlation_df[<span class="st">'Correlation'</span>].<span class="bu">round</span>(<span class="dv">2</span>)),size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'black'</span>,position<span class="op">=</span>position_stack(vjust<span class="op">=</span><span class="fl">0.5</span>))<span class="op">+</span>  <span class="co"># Add annotations</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  scale_fill_manual(values<span class="op">=</span>[<span class="st">'red'</span>,<span class="st">'green'</span>])<span class="op">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  coord_flip()<span class="op">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Churn correlation across numeric variables'</span>)<span class="op">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  theme_plots <span class="op">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  theme(</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      axis_title_x<span class="op">=</span>element_blank(),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      axis_title_y<span class="op">=</span>element_blank())</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Display Output</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select numeric columns and calculate correlation with churn</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="op">=</span> (</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  Data</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  .select_dtypes(include<span class="op">=</span><span class="st">'number'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  .corr()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  .iloc[:<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  .reset_index()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>correlation_df.columns <span class="op">=</span> [<span class="st">'Variable'</span>, <span class="st">'Correlation'</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 'Sign' column based on correlation values</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>correlation_df[<span class="st">'Sign'</span>] <span class="op">=</span> correlation_df[<span class="st">'Correlation'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Positive'</span> <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Negative'</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Chart</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  ggplot(correlation_df, aes(x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Correlation'</span>, fill<span class="op">=</span><span class="st">'Sign'</span>))<span class="op">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  geom_col()<span class="op">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  geom_text(aes(label<span class="op">=</span>correlation_df[<span class="st">'Correlation'</span>].<span class="bu">round</span>(<span class="dv">2</span>)),size<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'black'</span>,position<span class="op">=</span>position_stack(vjust<span class="op">=</span><span class="fl">0.5</span>))<span class="op">+</span>  <span class="co"># Add annotations</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  scale_fill_manual(values<span class="op">=</span>[<span class="st">'red'</span>,<span class="st">'green'</span>])<span class="op">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  coord_flip()<span class="op">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Churn correlation across numeric variables'</span>)<span class="op">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  theme_plots <span class="op">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  theme(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      axis_title_x<span class="op">=</span>element_blank(),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      axis_title_y<span class="op">=</span>element_blank())</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Display Output</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="modeling-discrete-choice-models" class="level2">
<h2 class="anchored" data-anchor-id="modeling-discrete-choice-models">Modeling Discrete Choice Models</h2>
<ul>
<li>Say that we are interested in modeling the <em>occurrence</em> of <code>churn</code>, which is a discrete variable for each customer <span class="math inline">\(i\)</span>:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
Y_i=
\begin{cases}
1, \text{if the customer has churned}\\
0,  \text{if the customer is still an active client}
\end{cases}
\]</span></p>
<ul>
<li>If we have a set of covariates, <span class="math inline">\(X_i\)</span>, then we can define the relationship:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
Y_i=f(X_i)
\]</span></p>
<ol type="1">
<li>How our <span class="math inline">\(f(X_i)\)</span> should look like?</li>
<li>What is the interpretation of the estimates that weâ€™ll find?</li>
</ol>
</section>
<section id="linear-probability-models-lpm" class="level2">
<h2 class="anchored" data-anchor-id="linear-probability-models-lpm">Linear Probability Models (LPM)</h2>
<ul>
<li>The simplest approach that we can take is to assume that <span class="math inline">\(Y\)</span> is linear on the set of characteristics <span class="math inline">\(X\)</span>. In other words, <span class="math inline">\(f(X)\)</span> is a <span class="focus">linear</span> model:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
Y_i= P(Y_i=1|X_i)=\alpha + \beta_1x_1+\beta_2x_2+...+\beta_nx_n+\varepsilon_i
\]</span></p>
<ul>
<li><p>We can then use <em>Ordinary Least Squares (OLS)</em> to model such relationship. Because the functional form of <span class="math inline">\(f(X)\)</span> is assumed to be linear, we call this a <em>linear probability model (LPM)</em>:</p></li>
<li><p>Because the relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> is assumed to be linear, the changes in the probability (or likelihood) of <code>churn</code> are linear on the parameters <span class="math inline">\(\beta\)</span>. For example, for <span class="math inline">\(x_1\)</span>:</p></li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\dfrac{\partial Y}{\partial x_1}=\beta_1
\]</span></p>
</section>
<section id="is-the-lpm-a-biased-estimator" class="level2">
<h2 class="anchored" data-anchor-id="is-the-lpm-a-biased-estimator">Is the LPM a <em>biased</em> estimator?</h2>
<ul>
<li>If we believe that the <em>OLS</em> assumptions are valid, <span class="math inline">\(\beta\)</span> is still a consistent estimator of the population average relationship between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>, regardless of the type of dependent:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\begin{align}
&amp; \beta_{OLS}=(X'X)^{-1}X'Y\\
&amp; \beta_{OLS}=(X'X)^{-1}X'(X\beta+\epsilon)=\underbrace{(X'X)^{-1}(X'X)}_{I}\beta+(X'X)^{-1}X'\epsilon\\
&amp; \beta_{OLS}=\beta + (X'X)^{-1}X'\epsilon
\end{align}
\]</span></p>
<ul>
<li>If we assume that <span class="math inline">\(X\perp\epsilon\)</span> - i.e, no <em>ommited variables</em>-, we see that <span class="math inline">\(\beta_{OLS}\)</span> is an unbiased estimator of the <em>average</em> effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\text{if } X\perp\epsilon \rightarrow \beta_{OLS}=\beta + (X'X)^{-1}\underbrace{X'\epsilon}_{=0}\rightarrow \beta_{OLS}=\beta
\]</span></p>
</section>
<section id="modeling-churn-via-lpm" class="level2">
<h2 class="anchored" data-anchor-id="modeling-churn-via-lpm">Modeling churn via LPM</h2>
<ul>
<li>Suppose we want to understand the determinants of customerâ€™s churn over time. For that, weâ€™ll consider the following variables:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\text{if } X=\begin{bmatrix} CreditScore \\ D(Gender) \\ Age \\ Tenure \\ Balance \\ \#Products \\ D(CreditCard) \\ D(Active) \\ Salary \end{bmatrix} \rightarrow Y \sim X'\beta+\epsilon
\]</span></p>
</section>
<section id="lpm-estimation" class="level2">
<h2 class="anchored" data-anchor-id="lpm-estimation">LPM Estimation</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Results</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                  churn   R-squared:                       0.136
Model:                            OLS   Adj. R-squared:                  0.135
Method:                 Least Squares   F-statistic:                     174.6
Date:                Thu, 27 Mar 2025   Prob (F-statistic):          8.76e-309
Time:                        19:20:45   Log-Likelihood:                -4364.5
No. Observations:               10000   AIC:                             8749.
Df Residuals:                    9990   BIC:                             8821.
Df Model:                           9                                         
Covariance Type:            nonrobust                                         
====================================================================================
                       coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------------
const               -0.1025      0.034     -3.027      0.002      -0.169      -0.036
credit_score     -9.264e-05   3.88e-05     -2.389      0.017      -0.000   -1.66e-05
gender_Male         -0.0773      0.008    -10.267      0.000      -0.092      -0.063
age                  0.0113      0.000     31.505      0.000       0.011       0.012
tenure              -0.0018      0.001     -1.426      0.154      -0.004       0.001
balance              0.0007   6.31e-05     11.003      0.000       0.001       0.001
products_number     -0.0043      0.007     -0.630      0.529      -0.018       0.009
credit_card         -0.0030      0.008     -0.360      0.719      -0.019       0.013
active_member       -0.1432      0.008    -19.016      0.000      -0.158      -0.128
estimated_salary  7.118e-05   6.52e-05      1.092      0.275   -5.66e-05       0.000
==============================================================================
Omnibus:                     1513.285   Durbin-Watson:                   1.994
Prob(Omnibus):                  0.000   Jarque-Bera (JB):             2319.357
Skew:                           1.176   Prob(JB):                         0.00
Kurtosis:                       3.176   Cond. No.                     6.09e+03
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 6.09e+03. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'gender' into dummy variables</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.get_dummies(Data, columns<span class="op">=</span>[<span class="st">'gender'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Data[[<span class="st">'credit_score'</span>, <span class="st">'gender_Male'</span>, <span class="st">'age'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>]]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Data[<span class="st">'churn'</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables matrix for the intercept</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(y, X.astype(<span class="bu">float</span>)).fit()</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the regression summary</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="overall-analysis" class="level2">
<h2 class="anchored" data-anchor-id="overall-analysis">Overall analysis</h2>
<ol type="1">
<li>All else equal, an additional year increases the likelihood of churning by:</li>
</ol>
<p>. . .</p>
<p><span class="math display">\[
\partial Y/\partial Age=\beta_{Age}\approx 0.0113
\]</span></p>
<ul>
<li>Moving from the <span class="math inline">\(25^{th}\)</span> to the <span class="math inline">\(75^{th}\)</span> percentile of <code>age</code> increases the likelihood by <span class="math inline">\(\beta_{Age}\times IQR(Age)=(44-32)\times 0.0113 \approx 14\)</span> or 14%</li>
</ul>
<ol start="2" type="1">
<li><em>Male</em> customers tend to churn, on average, <span class="math inline">\(7.7\%\)</span> <em>less</em> than <em>Female</em> customers:</li>
</ol>
<p>. . .</p>
<p><span class="math display">\[
\partial Y/\partial D(genderMale)=\beta_{genderMale}\approx =-0.078
\]</span></p>
<ol start="3" type="1">
<li>Similar analyses can be made for the following continuous variables (see Code in next slide)</li>
</ol>
</section>
<section id="analyses" class="level2">
<h2 class="anchored" data-anchor-id="analyses">Analyses</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="cell-output-display">
<div id="nirdlmkxng" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#nirdlmkxng table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#nirdlmkxng thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#nirdlmkxng p { margin: 0; padding: 0; }
 #nirdlmkxng .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A81600; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A81600; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #nirdlmkxng .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #nirdlmkxng .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #nirdlmkxng .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #nirdlmkxng .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nirdlmkxng .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #nirdlmkxng .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #nirdlmkxng .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #nirdlmkxng .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #nirdlmkxng .gt_column_spanner_outer:first-child { padding-left: 0; }
 #nirdlmkxng .gt_column_spanner_outer:last-child { padding-right: 0; }
 #nirdlmkxng .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #nirdlmkxng .gt_spanner_row { border-bottom-style: hidden; }
 #nirdlmkxng .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #nirdlmkxng .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: middle; }
 #nirdlmkxng .gt_from_md> :first-child { margin-top: 0; }
 #nirdlmkxng .gt_from_md> :last-child { margin-bottom: 0; }
 #nirdlmkxng .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #FFCCC7; border-left-style: none; border-left-width: 1px; border-left-color: #FFCCC7; border-right-style: none; border-right-width: 1px; border-right-color: #FFCCC7; vertical-align: middle; overflow-x: hidden; }
 #nirdlmkxng .gt_stub { color: #FFFFFF; background-color: #E4220C; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #E4220C; padding-left: 5px; padding-right: 5px; }
 #nirdlmkxng .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #nirdlmkxng .gt_row_group_first td { border-top-width: 2px; }
 #nirdlmkxng .gt_row_group_first th { border-top-width: 2px; }
 #nirdlmkxng .gt_striped { background-color: #F4F4F4; }
 #nirdlmkxng .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #nirdlmkxng .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #nirdlmkxng .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #nirdlmkxng .gt_left { text-align: left; }
 #nirdlmkxng .gt_center { text-align: center; }
 #nirdlmkxng .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #nirdlmkxng .gt_font_normal { font-weight: normal; }
 #nirdlmkxng .gt_font_bold { font-weight: bold; }
 #nirdlmkxng .gt_font_italic { font-style: italic; }
 #nirdlmkxng .gt_super { font-size: 65%; }
 #nirdlmkxng .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #nirdlmkxng .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal"><strong>Summary Statistics</strong></th>
</tr>
<tr class="odd gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Change" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Change in Covariate</th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Coefficient from OLS</th>
<th id="partial_change" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Change on Outcome (in %)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">credit_score</td>
<td class="gt_row gt_center">134</td>
<td class="gt_row gt_center">âˆ’0.0001</td>
<td class="gt_row gt_center">âˆ’1.24%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">age</td>
<td class="gt_row gt_center gt_striped">12</td>
<td class="gt_row gt_center gt_striped">0.0113</td>
<td class="gt_row gt_center gt_striped">13.57%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">tenure</td>
<td class="gt_row gt_center">4</td>
<td class="gt_row gt_center">âˆ’0.0018</td>
<td class="gt_row gt_center">âˆ’0.74%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">balance</td>
<td class="gt_row gt_center gt_striped">128</td>
<td class="gt_row gt_center gt_striped">0.0007</td>
<td class="gt_row gt_center gt_striped">8.86%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">products_number</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’0.0043</td>
<td class="gt_row gt_center">âˆ’0.43%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">estimated_salary</td>
<td class="gt_row gt_center gt_striped">98</td>
<td class="gt_row gt_center gt_striped">0.0001</td>
<td class="gt_row gt_center gt_striped">0.70%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">gender_Male</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’0.0773</td>
<td class="gt_row gt_center">âˆ’7.73%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">credit_card</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">âˆ’0.0030</td>
<td class="gt_row gt_center gt_striped">âˆ’0.30%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">active_member</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’0.1432</td>
<td class="gt_row gt_center">âˆ’14.32%</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define continuous and dummy variables</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>continuous_vars <span class="op">=</span> [<span class="st">'credit_score'</span>, <span class="st">'age'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'estimated_salary'</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>dummy_vars <span class="op">=</span> [<span class="st">'gender_Male'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coefficient estimates from the model</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>estimates <span class="op">=</span> model.params.reset_index()</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>estimates.columns <span class="op">=</span> [<span class="st">'Variable'</span>, <span class="st">'estimate'</span>]</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate IQR for continuous variables</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>iqr_df <span class="op">=</span> Data[continuous_vars].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.quantile(<span class="fl">0.75</span>) <span class="op">-</span> x.quantile(<span class="fl">0.25</span>), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>iqr_df <span class="op">=</span> pd.DataFrame({<span class="st">'Variable'</span>: iqr_df.index, <span class="st">'Change'</span>: iqr_df.values})</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a DataFrame for dummy variables</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>dummy_df <span class="op">=</span> pd.DataFrame({<span class="st">'Variable'</span>: dummy_vars, <span class="st">'Change'</span>: <span class="dv">1</span>})</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine continuous and dummy variable dataframes</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> pd.concat([iqr_df, dummy_df])</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with coefficient estimates</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> pd.merge(combined_df, estimates, on<span class="op">=</span><span class="st">'Variable'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate partial changes</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>result_df[<span class="st">'partial_change'</span>] <span class="op">=</span> (result_df[<span class="st">'Change'</span>] <span class="op">*</span> result_df[<span class="st">'estimate'</span>])</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Table</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>Table<span class="op">=</span> (</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  GT(result_df)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>  .cols_align(<span class="st">'center'</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  .tab_stub(rowname_col<span class="op">=</span><span class="st">'Variable'</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  .cols_label(</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    Change <span class="op">=</span> <span class="st">'Change in Covariate'</span>,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    estimate <span class="op">=</span> <span class="st">'Coefficient from OLS'</span>,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    partial_change <span class="op">=</span> <span class="st">'Change on Outcome (in %)'</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns <span class="op">=</span> <span class="st">'Change'</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns <span class="op">=</span> <span class="st">'estimate'</span>,decimals<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>  .fmt_percent(columns<span class="op">=</span><span class="st">'partial_change'</span>,decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"**Summary Statistics**"</span>))</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>Table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="limitations-of-the-lpm" class="level2">
<h2 class="anchored" data-anchor-id="limitations-of-the-lpm">Limitations of the <em>LPM</em></h2>
<ul>
<li>Although a consistent estimator of the average effect, the <em>LPM</em> has limitations when it comes to its practical implications to <em>binary</em> outcomes:</li>
</ul>
<ol type="1">
<li><p>Churn probabilities should lie within <span class="math inline">\([0,1]\)</span>, but the <em>predicted</em> probabilities, <span class="math inline">\(\hat{Y}\)</span>, have <em>continuous</em> support <span class="math inline">\((-\infty,+\infty)\)</span>. When the goal is to <span class="focus">predict</span> outcomes, this creates probabilities that are outside of the ranges</p></li>
<li><p>There is an implicit assumption that the effects are <em>linear</em>, which may not hold true. Example, an increase of $1,000 in customerâ€™s income may have significant impacts on churn likelihood when customers are from the bottom of the income distribution, but the effects should dampen as we move towards the top of the income distribution</p></li>
<li><p>Heteroskedasticity</p></li>
<li><p><span class="math inline">\(R^2\)</span> is not well-defined</p></li>
</ol>
</section>
<section id="limitations-of-the-lpm-1" class="level2">
<h2 class="anchored" data-anchor-id="limitations-of-the-lpm-1">Limitations of the <em>LPM</em></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">Heteroskedasticity</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Poor Fit</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false"><span class="math inline">\(R^2\)</span></a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="nonincremental">
<ul>
<li>Even though we can achieve consistent estimators, weâ€™ll have <span class="focus">heteroskedasticity</span> in our estimates by construction. To see that, recall that the conditional expectation of Y given X is given by:</li>
</ul>
<p><span class="math display">\[
\small E(Y|X)=\underbrace{[P(Y=1|X]}_{X\beta\times 1} + \underbrace{[1-P(Y=1|X)]\times 0}_{=0} = X\beta
\]</span></p>
<ul>
<li>Given that the variance of a Bernoulli Distribution is given by <span class="math inline">\(p \times (1-p)\)</span>, then:</li>
</ul>
<p><span class="math display">\[
V(Y|X)=P(Y|X)\times[1-P(Y|X)]=X\beta\times(1-X\beta) \text{, which clearly depends on } X
\]</span></p>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\lucas\DOCUME~1\VIRTUA~1\R-RETI~1\Lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 57'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-13-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="nonincremental">
<ul>
<li><p>In most linear probability models, <span class="math inline">\(R^2\)</span> has no meaningful interpretation</p></li>
<li><p>Since the regression line can never fit the data perfectly if the dependent variable is binary and the regressors are continuous</p></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="introducing-non-linear-binary-models" class="level2">
<h2 class="anchored" data-anchor-id="introducing-non-linear-binary-models">Introducing non-linear binary models</h2>
<ul>
<li><p>Recall that the limitations of the <em>LPM</em> stem from the fact that <span class="math inline">\(f(X)=X'\beta\)</span>. It might be that a <span class="focus">linear</span> relationship does not capture all aspects that a churn analysis should have!</p></li>
<li><p>To that point, we need to think about a new relationship, <span class="math inline">\(Y=f(X)\)</span>, that fulfills the following points:</p></li>
</ul>
<ol type="1">
<li>The predicted outcomes, <span class="math inline">\(\hat{Y}\)</span>, lie between 0 and 1</li>
<li>The effects do not need to be linear on the parameters</li>
<li>Ideally, weâ€™d want to apply a non-linear transformation in such a way that the relationship between Y and X is <em>sigmoid</em> (or S-shaped) curve: the changes in the predicted probability tend to go to zero as we approach the lower and upper bounds of the distribution of X</li>
</ol>
<ul>
<li>The most known cases are <em>logistic regression</em> (<span class="math inline">\(f(x)=\Lambda (x)\)</span>) and Probit (<span class="math inline">\(f(x)=\Phi(X)\)</span>)</li>
</ul>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<ul>
<li><p>Like any other transformation function, the idea behind using <span class="math inline">\(\Lambda(X)\)</span> lies on the <span class="focus">latent</span> variable approach: think about an unobserved component, <span class="math inline">\(Y^\star\)</span>, which is a continuous variable, such as how much a consumer values a product.</p></li>
<li><p>Although we do not observe <span class="math inline">\(Y^\star\)</span>, we do observe the consumerâ€™s decision of buying or not buying the product, depending on a given threshold:</p></li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
Y=
\begin{cases}
1, \text{ if }Y^\star&gt;0\\
0, \text{ if }Y^\star\leq0\\
\end{cases}
\]</span></p>
<ul>
<li>Therefore, we can see that the probability of buying depends on a latent variable, which is not observed by the econometrician:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
P(Y=1|X)=P(Y^\star&gt;0|X)=P(\underbrace{X\beta+\varepsilon}_{Y^{\star}}&gt;0|X)
\]</span></p>
</section>
<section id="logistic-regression-continued" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-continued">Logistic Regression, continued</h2>
<ul>
<li>We can rearrange terms and find that:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
P(Y=1|X)=P(\underbrace{X\beta+\varepsilon}_{Y^{\star}}&gt;0|X)\rightarrow \underbrace{P(\varepsilon&gt;-X\beta|X)\equiv P(\varepsilon&lt;X\beta|X)}_{\text{Under Simmetry}}
\]</span></p>
<ul>
<li>Therefore, this framework can be used to think about any cumulative density function which has the simmetry property. For the case of Logistic Regression, our transformation function that maps <span class="math inline">\(Y^\star\)</span> (how much consumer values a good) to <span class="math inline">\(Y\)</span> (decision to buy or not buy) is:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
f(Y^\star)=\Lambda(Y^\star)=\dfrac{\exp(X\beta)}{1+\exp(X\beta)}
\]</span></p>
<ul>
<li>Estimation is made using <em>Maximum Likelihood</em> estimators.</li>
</ul>
</section>
<section id="applying-logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="applying-logistic-regression">Applying Logistic Regression</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.435323
         Iterations 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                           Logit Regression Results                           
==============================================================================
Dep. Variable:                  churn   No. Observations:                10000
Model:                          Logit   Df Residuals:                     9990
Method:                           MLE   Df Model:                            9
Date:                Thu, 27 Mar 2025   Pseudo R-squ.:                  0.1388
Time:                        19:20:46   Log-Likelihood:                -4353.2
converged:                       True   LL-Null:                       -5054.9
Covariance Type:            nonrobust   LLR p-value:                1.475e-296
====================================================================================
                       coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------
const               -3.4761      0.241    -14.397      0.000      -3.949      -3.003
credit_score        -0.0007      0.000     -2.349      0.019      -0.001      -0.000
gender_Male         -0.5429      0.054    -10.060      0.000      -0.649      -0.437
age                  0.0729      0.003     28.561      0.000       0.068       0.078
tenure              -0.0147      0.009     -1.585      0.113      -0.033       0.003
balance              0.0050      0.000     10.964      0.000       0.004       0.006
products_number     -0.0362      0.046     -0.780      0.436      -0.127       0.055
credit_card         -0.0290      0.059     -0.493      0.622      -0.144       0.086
active_member       -1.0793      0.057    -18.860      0.000      -1.191      -0.967
estimated_salary     0.0005      0.000      1.060      0.289      -0.000       0.001
====================================================================================</code></pre>
</div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'gender' into dummy variables</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.get_dummies(Data, columns<span class="op">=</span>[<span class="st">'gender'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Data[[<span class="st">'credit_score'</span>, <span class="st">'gender_Male'</span>, <span class="st">'age'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>]]</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Data[<span class="st">'churn'</span>]</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables matrix for the intercept</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X.astype(<span class="bu">float</span>)).fit()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the regression summary</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="logit-properties-1-probabilities-within-the-01-interval" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-1-probabilities-within-the-01-interval">Logit Properties #1: probabilities within the [0,1] interval</h2>
<ul>
<li>One interesting thing to note is that, due to the properties of <span class="math inline">\(\Lambda(\cdot)\)</span>, our estimated probabilities will fall within <span class="math inline">\([0,1]\)</span> depending on <span class="math inline">\(X\)</span>:</li>
</ul>
<ol type="1">
<li>When <span class="math inline">\(X\rightarrow\infty\)</span>, the probability of buying in our example tends to 1:</li>
</ol>
<p>. . .</p>
<p><span class="math display">\[
\Lambda(Y)=\dfrac{\exp(Y)}{1+\exp(Y)}=\dfrac{\exp(X\beta)}{1+\exp(X\beta)}\rightarrow1
\]</span></p>
<ol start="2" type="1">
<li>On the other hand, when <span class="math inline">\(X\rightarrow -\infty\)</span>, the probability of buying in our example tends to 0:</li>
</ol>
<p>. . .</p>
<p><span class="math display">\[
\Lambda(Y)=\dfrac{\exp(Y)}{1+\exp(Y)}=\dfrac{\exp(X\beta)}{1+\exp(X\beta)}\rightarrow \dfrac{0}{1}=0
\]</span></p>
</section>
<section id="logit-properties-2-the-odds-ratio" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-2-the-odds-ratio">Logit Properties #2: the <em>odds-ratio</em></h2>
<ul>
<li>Recall that the <em>logit</em> estimation for <span class="math inline">\(\small P(Y|X)\)</span> is given by:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small
P(Y)=\dfrac{\exp(X\beta)}{1+\exp(X\beta)},\text{ which we will call by } p
\]</span></p>
<ul>
<li>Looking at the inverse, <span class="math inline">\(1/p\)</span>, we can see that:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small
\dfrac{1}{p}=\dfrac{1+\exp(X\beta)}{\exp(X\beta)}=1+\dfrac{1}{\exp{X\beta}}\rightarrow \dfrac{1-p}{p}=\dfrac{1}{\exp{X\beta}}
\]</span></p>
<ul>
<li>Inverting and taking logs on both sides, weâ€™ll have:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small \log{\bigg(\dfrac{p}{1-p}}\bigg)=X\beta=\alpha+\beta_1x_1+\beta_2x_2+...\beta_kx_k
\]</span></p>
</section>
<section id="logit-properties-2-the-odds-ratio-continued" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-2-the-odds-ratio-continued">Logit Properties #2: the <em>odds-ratio</em> (continued)</h2>
<ul>
<li>Therefore, whenever weâ€™re estimating a <em>logit</em> model, our transformation function, <span class="math inline">\(\Lambda(\cdot)\)</span> is actually estimating <span class="math inline">\(\small \dfrac{p}{1-p}\)</span>:</li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small logit(p)=\alpha+\beta_1x_1+\beta_2x_2+...\beta_kx_k
\]</span></p>
<ul>
<li><p>The term <span class="math inline">\(\small \dfrac{p}{1-p}\)</span> is called <em>odds-ratio</em>, and is simply the ratio of the probability of success over the probability of failure</p></li>
<li><p>Hence, if we want to recover the impacts of any change in the odds-ratio due to our covariates, we can exponentiate our coefficients:</p></li>
</ul>
<p>. . .</p>
<p><span class="math display">\[
\small \text{if } \log\bigg(\dfrac{p}{1-p}\bigg)=\alpha+\beta_1x_1+\beta_2x_2+...\beta_kx_k\rightarrow \dfrac{p}{1-p}=\exp(\alpha+\beta_1x_1+\beta_2x_2+...\beta_kx_k)
\]</span></p>
</section>
<section id="logit-properties-2-the-odds-ratio-continued-1" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-2-the-odds-ratio-continued-1">Logit Properties #2: the <em>odds-ratio</em> (continued)</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">Explanation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-3" role="tab" aria-controls="tabset-8-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="nonincremental">
<ul>
<li>In previous slides, we noted that the effect of <code>Gender</code> is <span class="math inline">\(\small\beta_2=-0.54\)</span>. Holding everything fixed, the <em>odds-ratio</em> between <code>Gender=1</code> (Male) versus <code>Gender=0</code> (Female) is given by:</li>
</ul>
<p><span class="math display">\[
\small \dfrac{p}{1-p}=\exp(\beta_2)=\exp(-0.54)\approx0.58
\]</span></p>
<ul>
<li><p>Put another way, the chances of being a churned client are <span class="math inline">\(\small 0.58-1=-0.42\)</span> or 42% less likely for men!</p></li>
<li><p>Similarly, if we look at <code>Age</code> (<span class="math inline">\(\beta_3=0.07\)</span>), an increase of 1 year increases the churn probability by:</p></li>
</ul>
<p><span class="math display">\[
\exp(\beta_1)=[\exp(0.0728688)-1]\approx 0.07 \text{ or } 7.55\%
\]</span></p>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="cell-output-display">
<div id="bwkvtbwdon" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#bwkvtbwdon table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#bwkvtbwdon thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#bwkvtbwdon p { margin: 0; padding: 0; }
 #bwkvtbwdon .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 2px; border-top-color: #A81600; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #A81600; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; }
 #bwkvtbwdon .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #bwkvtbwdon .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #bwkvtbwdon .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #bwkvtbwdon .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #bwkvtbwdon .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #bwkvtbwdon .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #bwkvtbwdon .gt_col_heading { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #bwkvtbwdon .gt_column_spanner_outer { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #bwkvtbwdon .gt_column_spanner_outer:first-child { padding-left: 0; }
 #bwkvtbwdon .gt_column_spanner_outer:last-child { padding-right: 0; }
 #bwkvtbwdon .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #bwkvtbwdon .gt_spanner_row { border-bottom-style: hidden; }
 #bwkvtbwdon .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #bwkvtbwdon .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; vertical-align: middle; }
 #bwkvtbwdon .gt_from_md> :first-child { margin-top: 0; }
 #bwkvtbwdon .gt_from_md> :last-child { margin-bottom: 0; }
 #bwkvtbwdon .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: none; border-top-width: 1px; border-top-color: #FFCCC7; border-left-style: none; border-left-width: 1px; border-left-color: #FFCCC7; border-right-style: none; border-right-width: 1px; border-right-color: #FFCCC7; vertical-align: middle; overflow-x: hidden; }
 #bwkvtbwdon .gt_stub { color: #FFFFFF; background-color: #E4220C; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #E4220C; padding-left: 5px; padding-right: 5px; }
 #bwkvtbwdon .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #bwkvtbwdon .gt_row_group_first td { border-top-width: 2px; }
 #bwkvtbwdon .gt_row_group_first th { border-top-width: 2px; }
 #bwkvtbwdon .gt_striped { background-color: #F4F4F4; }
 #bwkvtbwdon .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #E4220C; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #E4220C; }
 #bwkvtbwdon .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #bwkvtbwdon .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #bwkvtbwdon .gt_left { text-align: left; }
 #bwkvtbwdon .gt_center { text-align: center; }
 #bwkvtbwdon .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #bwkvtbwdon .gt_font_normal { font-weight: normal; }
 #bwkvtbwdon .gt_font_bold { font-weight: bold; }
 #bwkvtbwdon .gt_font_italic { font-style: italic; }
 #bwkvtbwdon .gt_super { font-size: 65%; }
 #bwkvtbwdon .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #bwkvtbwdon .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="4" class="gt_heading gt_title gt_font_normal"><strong>Summary Statistics</strong></th>
</tr>
<tr class="odd gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="OddsRatio" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">OddsRatio</th>
<th id="Multiplier" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Multiplier</th>
<th id="ChangeOdds" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">ChangeOdds</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">const</td>
<td class="gt_row gt_center">3.09%</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’96.91%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">credit_score</td>
<td class="gt_row gt_center gt_striped">99.93%</td>
<td class="gt_row gt_center gt_striped">100</td>
<td class="gt_row gt_center gt_striped">âˆ’7.00%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">gender_Male</td>
<td class="gt_row gt_center">58.10%</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’41.90%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">age</td>
<td class="gt_row gt_center gt_striped">107.56%</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">7.56%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">tenure</td>
<td class="gt_row gt_center">98.54%</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’1.46%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">balance</td>
<td class="gt_row gt_center gt_striped">100.51%</td>
<td class="gt_row gt_center gt_striped">10</td>
<td class="gt_row gt_center gt_striped">5.10%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">products_number</td>
<td class="gt_row gt_center">96.45%</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’3.55%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">credit_card</td>
<td class="gt_row gt_center gt_striped">97.14%</td>
<td class="gt_row gt_center gt_striped">1</td>
<td class="gt_row gt_center gt_striped">âˆ’2.86%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">active_member</td>
<td class="gt_row gt_center">33.98%</td>
<td class="gt_row gt_center">1</td>
<td class="gt_row gt_center">âˆ’66.02%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th">estimated_salary</td>
<td class="gt_row gt_center gt_striped">100.05%</td>
<td class="gt_row gt_center gt_striped">100</td>
<td class="gt_row gt_center gt_striped">5.00%</td>
</tr>
</tbody>
</table>


</div>
        
</div>
</div>
</div>
<div id="tabset-8-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Odds Ratio and Change in Odds</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>odds_ratio <span class="op">=</span> pd.DataFrame({</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'OddsRatio'</span>: model.params.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(np.exp(x), <span class="dv">4</span>)),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Multiplier'</span>: [<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">100</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>odds_ratio <span class="op">=</span> odds_ratio.reset_index()  </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>odds_ratio[<span class="st">'ChangeOdds'</span>] <span class="op">=</span> ((odds_ratio[<span class="st">'OddsRatio'</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> odds_ratio[<span class="st">'Multiplier'</span>]).<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Table</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>Table <span class="op">=</span> (</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  GT(odds_ratio)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  .cols_align(<span class="st">'center'</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  .tab_stub(rowname_col<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  .cols_label(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    OddsRatio <span class="op">=</span> <span class="st">'Odds Ratio'</span>,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    Multiplier <span class="op">=</span> <span class="st">'Multiplier'</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    ChangeOdds <span class="op">=</span> <span class="st">'Change in Probality (in p.p)'</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns <span class="op">=</span> <span class="st">'odds'</span>,decimals<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  .fmt_percent(columns<span class="op">=</span>[<span class="st">'OddsRatio'</span>,<span class="st">'ChangeOdds'</span>],decimals<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  .tab_header(title<span class="op">=</span>md(<span class="st">"**Summary Statistics**"</span>))</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  .opt_stylize(style<span class="op">=</span><span class="dv">1</span>,color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>Table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="logit-properties-3-different-marginal-effects" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-3-different-marginal-effects">Logit Properties #3: different marginal effects</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">Explanation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-3" role="tab" aria-controls="tabset-9-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="nonincremental">
<ul>
<li><p>One of the caveats of LPM was that the marginal effect was <span class="focus">constant</span>, which does not make a lot of sense from a probabilistic sense</p></li>
<li><p>With <em>Logit</em>, the marginal effects are not equal to <span class="math inline">\(\beta\)</span> anymore. To see that, take the derivative of <span class="math inline">\(P(Y|X)\)</span> with respect to <span class="math inline">\(x_1\)</span>:</p></li>
</ul>
<p><span class="math display">\[
\dfrac{\partial\Lambda(X\beta)}{\partial x_1}=\beta_1 \times\dfrac{\partial\Lambda(X\beta)}{\partial X\beta}
\]</span></p>
<ul>
<li><p>As we can see, the effects are not going to be linear anymore!</p></li>
<li><p>Put another way, given different levels of X, we may have different marginal effects on the probabilities - in what follows, weâ€™ll analyze the case of <code>age</code></p></li>
</ul>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'gender'</span>] <span class="op">=</span> np.where(data[<span class="st">'gender'</span>] <span class="op">==</span> <span class="st">'Male'</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression model</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[[<span class="st">'credit_score'</span>, <span class="st">'gender'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>,<span class="st">'age'</span>]]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add constant term for intercept</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'churn'</span>]</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.435323
         Iterations 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all other variables to the mean</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'age'</span>]).mean(numeric_only<span class="op">=</span><span class="va">True</span>).to_frame().transpose()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame(np.repeat(new_data.values, <span class="dv">100</span>, axis<span class="op">=</span><span class="dv">0</span>),columns<span class="op">=</span>new_data.columns)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>age_df <span class="op">=</span> pd.DataFrame(pd.Series(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>)), columns<span class="op">=</span>[<span class="st">'age'</span>])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate with your existing DataFrame</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([new_data, age_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>concatenated_df.columns<span class="op">=</span>[<span class="op">*</span>new_data.columns,<span class="st">'age'</span>]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the new data</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>predicted_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Age'</span>: age_df[<span class="st">'age'</span>],</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Predicted'</span>: model.predict(concatenated_df)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  ggplot(predicted_df,aes(x<span class="op">=</span><span class="st">'Age'</span>,y<span class="op">=</span><span class="st">'Predicted'</span>))<span class="op">+</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  geom_point(color<span class="op">=</span><span class="st">'blue'</span>)<span class="op">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  geom_hline(yintercept<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>],linetype<span class="op">=</span><span class="st">'dashed'</span>,color<span class="op">=</span><span class="st">'darkred'</span>)<span class="op">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> percent_format())<span class="op">+</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  labs(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span><span class="st">'Marginal effects of Age on Churn probabilities'</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> <span class="st">'Using the estimates from a Logit model.'</span>, </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'Age'</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Predicted Probabilities'</span>)<span class="op">+</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  theme_plots</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-18-7.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-9-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'gender'</span>] <span class="op">=</span> np.where(data[<span class="st">'gender'</span>] <span class="op">==</span> <span class="st">'Male'</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression model</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[[<span class="st">'credit_score'</span>, <span class="st">'gender'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>,<span class="st">'age'</span>]]</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add constant term for intercept</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'churn'</span>]</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all other variables to the mean</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'age'</span>]).mean(numeric_only<span class="op">=</span><span class="va">True</span>).to_frame().transpose()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame(np.repeat(new_data.values, <span class="dv">100</span>, axis<span class="op">=</span><span class="dv">0</span>),columns<span class="op">=</span>new_data.columns)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>age_df <span class="op">=</span> pd.DataFrame(pd.Series(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>)), columns<span class="op">=</span>[<span class="st">'age'</span>])</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate with your existing DataFrame</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([new_data, age_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>concatenated_df.columns<span class="op">=</span>[<span class="op">*</span>new_data.columns,<span class="st">'age'</span>]</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the new data</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>predicted_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Age'</span>: age_df[<span class="st">'age'</span>],</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Predicted'</span>: model.predict(concatenated_df)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  ggplot(predicted_df,aes(x<span class="op">=</span><span class="st">'Age'</span>,y<span class="op">=</span><span class="st">'Predicted'</span>))<span class="op">+</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  geom_point(color<span class="op">=</span><span class="st">'blue'</span>)<span class="op">+</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  geom_hline(yintercept<span class="op">=</span>[<span class="dv">0</span>,<span class="dv">1</span>],linetype<span class="op">=</span><span class="st">'dashed'</span>,color<span class="op">=</span><span class="st">'darkred'</span>)<span class="op">+</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> percent_format())<span class="op">+</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  labs(</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span><span class="st">'Marginal effects of Age on Churn probabilities'</span>,</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> <span class="st">'Using the estimates from a Logit model.'</span>, </span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'Age'</span>,</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Predicted Probabilities'</span>)<span class="op">+</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  theme_plots</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="logit-properties-4-different-effects-by-categorical-variables" class="level2">
<h2 class="anchored" data-anchor-id="logit-properties-4-different-effects-by-categorical-variables">Logit Properties #4: different effects by categorical variables</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">Explanation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-3" role="tab" aria-controls="tabset-10-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="nonincremental">
<ul>
<li><p>Another interesting use case is to re-do the same analysis before, but now varying also on categorical variables</p></li>
<li><p>For example, what is the difference in the probability of buying by men and women?</p></li>
<li><p>In order to do that, we can set all continous variables to their means and compare the estimated probabilities for <code>gender=1</code> (male) and <code>gender=0</code> (female)</p></li>
</ul>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.435323
         Iterations 6</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-20-9.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-10-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'gender'</span>] <span class="op">=</span> np.where(data[<span class="st">'gender'</span>] <span class="op">==</span> <span class="st">'Male'</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression model</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[[<span class="st">'credit_score'</span>, <span class="st">'age'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>,<span class="st">'gender'</span>]]</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add constant term for intercept</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'churn'</span>]</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all other variables to the mean</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'gender'</span>]).mean(numeric_only<span class="op">=</span><span class="va">True</span>).to_frame().transpose()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame(np.repeat(new_data.values, <span class="dv">2</span>, axis<span class="op">=</span><span class="dv">0</span>),columns<span class="op">=</span>new_data.columns)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>gender_df <span class="op">=</span> pd.DataFrame(pd.Series(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">2</span>)), columns<span class="op">=</span>[<span class="st">'gender'</span>])</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate with your existing DataFrame</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([new_data, gender_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>concatenated_df.columns<span class="op">=</span>[<span class="op">*</span>new_data.columns,<span class="st">'gender'</span>]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the new data</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>predicted_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Gender'</span>: gender_df[<span class="st">'gender'</span>],</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Predicted'</span>: model.predict(concatenated_df)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>predicted_df[<span class="st">'Gender'</span>] <span class="op">=</span> np.where(concatenated_df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">1</span>, <span class="st">'Male'</span>, <span class="st">'Female'</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  ggplot(predicted_df,aes(x<span class="op">=</span><span class="st">'Gender'</span>,y<span class="op">=</span><span class="st">'Predicted'</span>,fill<span class="op">=</span><span class="st">'Gender'</span>))<span class="op">+</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  geom_col()<span class="op">+</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  geom_text(aes(label<span class="op">=</span><span class="st">'Predicted'</span>),format_string<span class="op">=</span><span class="st">"</span><span class="sc">{:.2f}</span><span class="st">%"</span>)<span class="op">+</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> percent_format())<span class="op">+</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  labs(</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span><span class="st">'Marginal effects of Gender on Churn probabilities'</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> <span class="st">'Using the estimates from a Logit model.'</span>, </span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'Gender'</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Predicted Probabilities'</span>,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    fill <span class="op">=</span> <span class="st">''</span>)<span class="op">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  theme_plots</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="putting-all-together" class="level2">
<h2 class="anchored" data-anchor-id="putting-all-together">Putting all together</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">Explanation</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-3" role="tab" aria-controls="tabset-11-3" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="nonincremental">
<ul>
<li><p>We saw that women tend to churn, approximately, <span class="math inline">\(8\)</span> percentage points more than men</p></li>
<li><p>Is this true across <span class="focus">all</span> levels of age? As age levels increase, the gap between men and women may become wider due to personal traits. On the other hand, it may be that gender differences are invariant to age</p></li>
<li><p>In order to do that, we can do a mix of the two last exercises:</p></li>
</ul>
<ol type="1">
<li>Set all continuous variables, with the exception of <code>age</code>, to their means</li>
<li>Compare the estimated probabilities for <code>gender=1</code> (male) and <code>gender=0</code> (female)</li>
<li>You should have <span class="math inline">\(200\)</span> rows in your data frame</li>
</ol>
</div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.435323
         Iterations 6</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-22-11.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-11-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'gender'</span>] <span class="op">=</span> np.where(data[<span class="st">'gender'</span>] <span class="op">==</span> <span class="st">'Male'</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression model</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data[[<span class="st">'credit_score'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>,<span class="st">'gender'</span>,<span class="st">'age'</span>]]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)  <span class="co"># Add constant term for intercept</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'churn'</span>]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.Logit(y, X).fit()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all other variables to the mean</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'gender'</span>,<span class="st">'age'</span>]).mean(numeric_only<span class="op">=</span><span class="va">True</span>).to_frame().transpose()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame(np.repeat(new_data.values, <span class="dv">200</span>, axis<span class="op">=</span><span class="dv">0</span>),columns<span class="op">=</span>new_data.columns)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>gender_df <span class="op">=</span> pd.DataFrame([<span class="op">*</span>np.repeat(<span class="dv">1</span>,<span class="dv">100</span>,axis<span class="op">=</span><span class="dv">0</span>),<span class="op">*</span>np.repeat(<span class="dv">0</span>,<span class="dv">100</span>,axis<span class="op">=</span><span class="dv">0</span>)], columns<span class="op">=</span>[<span class="st">'gender'</span>])</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>age_df <span class="op">=</span> pd.DataFrame(pd.Series(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>)), columns<span class="op">=</span>[<span class="st">'age'</span>])</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>age_df <span class="op">=</span>pd.concat([age_df,age_df],ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate with your existing DataFrame</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([gender_df, age_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([new_data,concatenated_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>concatenated_df.columns<span class="op">=</span>[<span class="op">*</span>new_data.columns,<span class="st">'gender'</span>,<span class="st">'age'</span>]</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>predicted <span class="op">=</span> model.predict(concatenated_df)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>concatenated_df[<span class="st">'Predicted'</span>] <span class="op">=</span> predicted</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>concatenated_df[<span class="st">'Gender'</span>] <span class="op">=</span> np.where(concatenated_df[<span class="st">'gender'</span>] <span class="op">==</span> <span class="dv">1</span>, <span class="st">'Male'</span>, <span class="st">'Female'</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  ggplot(concatenated_df,aes(x<span class="op">=</span><span class="st">'age'</span>,y<span class="op">=</span><span class="st">'Predicted'</span>,fill<span class="op">=</span><span class="st">'Gender'</span>))<span class="op">+</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  geom_point(stroke<span class="op">=</span><span class="dv">0</span>,size<span class="op">=</span><span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> percent_format())<span class="op">+</span></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>  labs(</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span><span class="st">'Marginal effects of gender and age on Churn probabilities'</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> <span class="st">'Using the estimates from a Logit model.'</span>, </span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'Age'</span>,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Predicted Probabilities'</span>,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>    fill <span class="op">=</span> <span class="st">'Gender'</span>)<span class="op">+</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>  theme_plots</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="comparison-across-lpm-and-logit-estimations" class="level2">
<h2 class="anchored" data-anchor-id="comparison-across-lpm-and-logit-estimations">Comparison across LPM and Logit estimations</h2>
<ul>
<li><p>We came across two estimators for binary choice models. Do they differ in terms of the responses?</p></li>
<li><p>Although the coefficients from the different models are not directly comparable, we can use them to understand what are the partial effects:</p></li>
<li><p>For both cases, weâ€™ll use all the other variables at their sample mean values:</p>
<ol type="1">
<li>For <em>LPM</em>, the effect will be a <span class="focus">slope</span>, <em>i.e.</em>, the marginal change depending on <code>Age</code> will be constant</li>
<li>For <em>Logit</em>, the change in the predicted probability will vary depending on the <code>Age</code> reference point</li>
</ol></li>
</ul>
</section>
<section id="comparing-across-lpm-and-logit-estimations---age" class="level2">
<h2 class="anchored" data-anchor-id="comparing-across-lpm-and-logit-estimations---age">Comparing across LPM and Logit estimations - <code>age</code></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">Result</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.435323
         Iterations 6</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-24-13.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="614"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file into a pandas DataFrame</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.read_csv(<span class="st">'Assets/bank-dataset.csv'</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'gender' into dummy variables</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>Data <span class="op">=</span> pd.get_dummies(Data, columns<span class="op">=</span>[<span class="st">'gender'</span>], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define independent and dependent variables</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Data[[<span class="st">'credit_score'</span>, <span class="st">'gender_Male'</span>, <span class="st">'tenure'</span>, <span class="st">'balance'</span>, <span class="st">'products_number'</span>, <span class="st">'credit_card'</span>, <span class="st">'active_member'</span>, <span class="st">'estimated_salary'</span>,<span class="st">'age'</span>]]</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Data[<span class="st">'churn'</span>]</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a constant to the independent variables matrix for the intercept</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> sm.add_constant(X)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the linear regression model and the logit model</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>lm_model <span class="op">=</span> sm.OLS(y, X.astype(<span class="bu">float</span>)).fit()</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>logit_model <span class="op">=</span> sm.Logit(y, X.astype(<span class="bu">float</span>)).fit()</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set all other variables to the mean</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> X.drop(columns<span class="op">=</span>[<span class="st">'age'</span>]).mean(numeric_only<span class="op">=</span><span class="va">True</span>).to_frame().transpose()</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>new_data <span class="op">=</span> pd.DataFrame(np.repeat(new_data.values, <span class="dv">100</span>, axis<span class="op">=</span><span class="dv">0</span>),columns<span class="op">=</span>new_data.columns)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>age_df <span class="op">=</span> pd.DataFrame(pd.Series(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">101</span>)), columns<span class="op">=</span>[<span class="st">'age'</span>])</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate with your existing DataFrame</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>concatenated_df <span class="op">=</span> pd.concat([new_data,age_df], ignore_index<span class="op">=</span><span class="va">True</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>concatenated_df.columns<span class="op">=</span>[<span class="op">*</span>new_data.columns,<span class="st">'age'</span>]</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>lm_predicted <span class="op">=</span> lm_model.predict(concatenated_df)</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>logit_predicted <span class="op">=</span> logit_model.predict(concatenated_df)</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>predicted_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">'LPM'</span>: lm_predicted,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Logit'</span>: logit_predicted,</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Age'</span>: age_df[<span class="st">'age'</span>]</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> (</span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>  ggplot(predicted_df,aes(x<span class="op">=</span><span class="st">'Age'</span>))<span class="op">+</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>  geom_line(aes(y<span class="op">=</span><span class="st">'LPM'</span>),color<span class="op">=</span><span class="st">'blue'</span>,size<span class="op">=</span><span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y<span class="op">=</span><span class="st">'Logit'</span>),color<span class="op">=</span><span class="st">'red'</span>,stroke<span class="op">=</span><span class="dv">0</span>,size<span class="op">=</span><span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels <span class="op">=</span> percent_format())<span class="op">+</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(breaks <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="dv">10</span>))<span class="op">+</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>  labs(</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span><span class="st">'Marginal effects of gender and age on Churn probabilities'</span>,</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> <span class="st">'Using the estimates from a Logit model and Linear Probability Model (LPM).'</span>, </span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'Age'</span>,</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'Predicted Probabilities'</span>,</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>    fill <span class="op">=</span> <span class="st">'Gender'</span>)<span class="op">+</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>  theme_minimal()<span class="op">+</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>  theme_plots</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>Plot.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="comparison-across-lpm-and-logit-estimations-continued" class="level2">
<h2 class="anchored" data-anchor-id="comparison-across-lpm-and-logit-estimations-continued">Comparison across LPM and Logit estimations (continued)</h2>
<ul>
<li><p>In the <em>LPM</em> model, the effect of <code>age</code> is always the same â€“ intuitively, <span class="math inline">\(\beta_{Age}\)</span>, the partial derivative of Y with respect to <code>Age</code>, is the same for all levels</p></li>
<li><p>On the other hand, the changes when looking at the <em>Logit</em> model vary depending on the reference point for <code>Age</code>:</p>
<ol type="1">
<li>For values $[0,20], it increases modestly</li>
<li>Around [21,60], the changes are exponential</li>
<li>Between [60,80], the changes start to become constant</li>
<li>After 80, we see diminishing effects</li>
</ol></li>
<li><p>Do these differences matter in practice? <span class="focus">It depends on what youâ€™re lookingâ€¦</span></p></li>
</ul>
</section>
<section id="comparison-across-lpm-and-logit-estimations-continued-1" class="level2">
<h2 class="anchored" data-anchor-id="comparison-across-lpm-and-logit-estimations-continued-1">Comparison across LPM and Logit estimations (continued)</h2>
<ul>
<li><p>On the one hand, we clearly the weaknesses of the <em>LPM</em> when estimating probabilities for ages between <span class="math inline">\([0,20]\)</span>.</p></li>
<li><p>On the other hand, <em>LPM</em> and <em>Logit</em> will be almost identical between <span class="math inline">\([30,60]\)</span></p></li>
</ul>
<ol type="1">
<li><p>If you tabulate the distribution of <code>Age</code> in your dataset, youâ€™ll see that although <em>LPM</em> does a poor job in predicting probabilities for cases &lt;20, the sample proportion of these cases is less than 1%</p></li>
<li><p>On the other hand, its results are approximately the same as of <em>Logit</em> between <span class="math inline">\([30,60]\)</span>, which constitutes approximately 80% of the sample</p></li>
</ol>
<ul>
<li>Ok, do does it matter or not? Again, <span class="focus">it dependsâ€¦</span></li>
</ul>
</section>
<section id="comparison-across-lpm-and-logit-estimations-continued-2" class="level2">
<h2 class="anchored" data-anchor-id="comparison-across-lpm-and-logit-estimations-continued-2">Comparison across LPM and Logit estimations (continued)</h2>
<ul>
<li>Logit or LPM?</li>
</ul>
<ol type="1">
<li><p>If your interest is to use the model results to <span class="focus">predict</span> probabilities for different age brackets, then yes, you should use <em>Logit</em> (or any model with the similar properties)</p></li>
<li><p>If, on the other hand, youâ€™re just interest in knowing the effects for the average person in your sample, you can use <em>LPM</em></p></li>
</ol>
<ul>
<li><p><em>LPM</em> is simpler, and we know very well the properties to analyze cases potential issues such as <em>ommited variable bias</em></p></li>
<li><p>In the <em>Logit</em> world, there is no <span class="math inline">\(R^2\)</span>, but there are other ways to check the predictive ability and fit of models</p></li>
</ul>
</section>
<section id="references-1" class="level2">
<h2 class="anchored" data-anchor-id="references-1">References</h2>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/lsmacoris\.github\.io\/lectures");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2025, Lucas Macoris. Photography by <a href="https://www.jurizieri.com.br/">Juliana Rizieri</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/lsmacoris/lectures/edit/main/quant-mkt/coursework/Lecture 1 - Choice Models and Its Applications/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/lsmacoris/lectures/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>